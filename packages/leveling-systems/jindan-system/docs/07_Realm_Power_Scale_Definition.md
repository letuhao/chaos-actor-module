# 07 — Định nghĩa Cảnh Giới & Power Scale (Phong Thần Diễn Nghĩa)

**Generated:** 2025-01-27  
**Based on:** Phong Thần Diễn Nghĩa & Đạo Giáo Tu Luyện System

## Tổng quan

Hệ thống cảnh giới trong **Kim Đan System** được thiết kế dựa trên **Phong Thần Diễn Nghĩa** và truyền thống **Đạo Giáo Tu Luyện**, từ **Phàm Nhân** đến **Thánh Nhân** - cấp bậc cao nhất trong Đạo Giáo.

Hệ thống bao gồm **15 cảnh giới chính** với **7 cảnh giới phàm trần** và **8 cảnh giới tiên nhân**, tạo thành một hệ thống tu luyện hoàn chỉnh và chi tiết.

## 🏛️ **Hệ thống Cảnh Giới Chính**

### **📚 Phàm Trần Cảnh (7 cảnh giới)**
Từ Luyện Khí đến Đại Thừa - giai đoạn tu luyện trong thế giới phàm trần.

### **🌅 Tiên Nhân Cảnh (8 cảnh giới)**  
Từ Địa Tiên đến Thánh Nhân - giai đoạn tu luyện trong các cõi tiên giới.

### **1. Luyện Khí (Qi Condensation)**
- **Mô tả**: Giai đoạn đầu tiên, hấp thụ và tinh luyện linh khí
- **Tiểu cảnh giới**: 9 tầng (Tầng 1-9)
- **Tuổi thọ**: 100-150 năm
- **Power Level**: 1-10
- **Đặc điểm**: 
  - Bắt đầu cảm nhận linh khí
  - Tăng cường thể chất cơ bản
  - Có thể sử dụng pháp thuật đơn giản

### **2. Trúc Cơ (Foundation Establishment)**
- **Mô tả**: Xây dựng nền tảng vững chắc cho tu luyện
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
- **Tuổi thọ**: 150-300 năm
- **Power Level**: 10-100
- **Đặc điểm**:
  - Hình thành đan điền
  - Có thể bay ngắn hạn
  - Sử dụng pháp khí cơ bản

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 10-20, Tuổi thọ 150-180 năm
- **Trung kỳ**: Power Level 20-40, Tuổi thọ 180-220 năm
- **Hậu kỳ**: Power Level 40-80, Tuổi thọ 220-260 năm
- **Viên mãn**: Power Level 80-100, Tuổi thọ 260-300 năm

### **3. Kim Đan (Golden Core)**
- **Mô tả**: Kết tinh linh khí thành Kim Đan
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn) + 4 phẩm đan (Hạ/Trung/Thượng/Cực)
- **Tuổi thọ**: 300-800 năm
- **Power Level**: 100-1,000
- **Đặc điểm**:
  - Kim Đan trong đan điền
  - Bay xa, thần thông cơ bản
  - Sử dụng pháp bảo mạnh

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 100-200, Tuổi thọ 300-400 năm
- **Trung kỳ**: Power Level 200-400, Tuổi thọ 400-550 năm
- **Hậu kỳ**: Power Level 400-800, Tuổi thọ 550-700 năm
- **Viên mãn**: Power Level 800-1,000, Tuổi thọ 700-800 năm

### **4. Nguyên Anh (Nascent Soul)**
- **Mô tả**: Kim Đan phát triển thành Nguyên Anh
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
- **Tuổi thọ**: 800-2,000 năm
- **Power Level**: 1,000-10,000
- **Đặc điểm**:
  - Nguyên Anh có thể xuất thể
  - Thần thức mạnh mẽ
  - Điều khiển thiên địa linh khí

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 1,000-2,000, Tuổi thọ 800-1,100 năm
- **Trung kỳ**: Power Level 2,000-4,000, Tuổi thọ 1,100-1,400 năm
- **Hậu kỳ**: Power Level 4,000-8,000, Tuổi thọ 1,400-1,700 năm
- **Viên mãn**: Power Level 8,000-10,000, Tuổi thọ 1,700-2,000 năm

### **5. Hóa Thần (Spirit Transformation)**
- **Mô tả**: Nguyên Anh phát triển thành Thần Thức
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
- **Tuổi thọ**: 2,000-5,000 năm
- **Power Level**: 10,000-100,000
- **Đặc điểm**:
  - Hóa thân thành thần linh
  - Thần thông quảng đại
  - Ảnh hưởng đến thiên địa

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 10,000-20,000, Tuổi thọ 2,000-2,750 năm
- **Trung kỳ**: Power Level 20,000-40,000, Tuổi thọ 2,750-3,500 năm
- **Hậu kỳ**: Power Level 40,000-80,000, Tuổi thọ 3,500-4,250 năm
- **Viên mãn**: Power Level 80,000-100,000, Tuổi thọ 4,250-5,000 năm

### **6. Luyện Hư (Void Refining)**
- **Mô tả**: Luyện tập vượt qua hư ảo, tiến gần chân lý đạo
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
- **Tuổi thọ**: 5,000-10,000 năm
- **Power Level**: 100,000-1,000,000
- **Đặc điểm**:
  - Thấu hiểu bản chất hư ảo
  - Thần thông siêu việt
  - Chuẩn bị hợp nhất thiên địa

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 100,000-200,000, Tuổi thọ 5,000-6,250 năm
- **Trung kỳ**: Power Level 200,000-400,000, Tuổi thọ 6,250-7,500 năm
- **Hậu kỳ**: Power Level 400,000-800,000, Tuổi thọ 7,500-8,750 năm
- **Viên mãn**: Power Level 800,000-1,000,000, Tuổi thọ 8,750-10,000 năm

### **7. Hợp Thể (Integration)**
- **Mô tả**: Hợp nhất hoàn toàn với thiên địa
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
- **Tuổi thọ**: 10,000-50,000 năm
- **Power Level**: 1,000,000-10,000,000
- **Đặc điểm**:
  - Gần như bất tử
  - Điều khiển quy luật tự nhiên
  - Sáng tạo và hủy diệt thế giới

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 1,000,000-2,000,000, Tuổi thọ 10,000-20,000 năm
- **Trung kỳ**: Power Level 2,000,000-4,000,000, Tuổi thọ 20,000-30,000 năm
- **Hậu kỳ**: Power Level 4,000,000-8,000,000, Tuổi thọ 30,000-40,000 năm
- **Viên mãn**: Power Level 8,000,000-10,000,000, Tuổi thọ 40,000-50,000 năm

### **8. Đại Thừa (Great Ascension)**
- **Mô tả**: Hoàn thiện cuối cùng trước phi thăng
- **Tiểu cảnh giới**: 4 giai đoạn (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
- **Tuổi thọ**: 50,000-100,000 năm
- **Power Level**: 10,000,000-100,000,000
- **Đặc điểm**:
  - Đỉnh cao tu đạo
  - Sức mạnh gần vô hạn
  - Chuẩn bị phi thăng

**Chi tiết tiểu cảnh giới:**
- **Sơ kỳ**: Power Level 10,000,000-20,000,000, Tuổi thọ 50,000-62,500 năm
- **Trung kỳ**: Power Level 20,000,000-40,000,000, Tuổi thọ 62,500-75,000 năm
- **Hậu kỳ**: Power Level 40,000,000-80,000,000, Tuổi thọ 75,000-87,500 năm
- **Viên mãn**: Power Level 80,000,000-100,000,000, Tuổi thọ 87,500-100,000 năm

### **9. Địa Tiên (Earth Immortal)**
- **Mô tả**: Cấp bậc đầu tiên của Tiên Nhân, rời bỏ thế giới phàm trần
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 100,000-500,000 năm
- **Power Level**: 100,000,000-500,000,000
- **Đặc điểm**:
  - Sống trong Địa Tiên Giới
  - Thần thông cơ bản của tiên nhân
  - Điều khiển địa mạch và linh khí

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 100,000,000-110,000,000, Tuổi thọ 100,000-140,000 năm
- **Tầng 2**: Power Level 110,000,000-125,000,000, Tuổi thọ 140,000-180,000 năm
- **Tầng 3**: Power Level 125,000,000-150,000,000, Tuổi thọ 180,000-220,000 năm
- **Tầng 4**: Power Level 150,000,000-200,000,000, Tuổi thọ 220,000-260,000 năm
- **Tầng 5**: Power Level 200,000,000-250,000,000, Tuổi thọ 260,000-300,000 năm
- **Tầng 6**: Power Level 250,000,000-300,000,000, Tuổi thọ 300,000-340,000 năm
- **Tầng 7**: Power Level 300,000,000-350,000,000, Tuổi thọ 340,000-380,000 năm
- **Tầng 8**: Power Level 350,000,000-400,000,000, Tuổi thọ 380,000-420,000 năm
- **Tầng 9**: Power Level 400,000,000-450,000,000, Tuổi thọ 420,000-460,000 năm
- **Viên mãn**: Power Level 450,000,000-500,000,000, Tuổi thọ 460,000-500,000 năm

### **10. Thiên Tiên (Heaven Immortal)**
- **Mô tả**: Tiên nhân cấp cao, có thể bay lên Thiên Giới
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 500,000-1,000,000 năm
- **Power Level**: 500,000,000-1,000,000,000
- **Đặc điểm**:
  - Sống trong Thiên Tiên Giới
  - Thần thông mạnh mẽ hơn
  - Điều khiển thiên tượng

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 500,000,000-550,000,000, Tuổi thọ 500,000-550,000 năm
- **Tầng 2**: Power Level 550,000,000-600,000,000, Tuổi thọ 550,000-600,000 năm
- **Tầng 3**: Power Level 600,000,000-650,000,000, Tuổi thọ 600,000-650,000 năm
- **Tầng 4**: Power Level 650,000,000-700,000,000, Tuổi thọ 650,000-700,000 năm
- **Tầng 5**: Power Level 700,000,000-750,000,000, Tuổi thọ 700,000-750,000 năm
- **Tầng 6**: Power Level 750,000,000-800,000,000, Tuổi thọ 750,000-800,000 năm
- **Tầng 7**: Power Level 800,000,000-850,000,000, Tuổi thọ 800,000-850,000 năm
- **Tầng 8**: Power Level 850,000,000-900,000,000, Tuổi thọ 850,000-900,000 năm
- **Tầng 9**: Power Level 900,000,000-950,000,000, Tuổi thọ 900,000-950,000 năm
- **Viên mãn**: Power Level 950,000,000-1,000,000,000, Tuổi thọ 950,000-1,000,000 năm

### **11. Huyền Tiên (Mystic Immortal)**
- **Mô tả**: Tiên nhân huyền bí, thấu hiểu bí mật của đạo
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 1,000,000-2,000,000 năm
- **Power Level**: 1,000,000,000-2,000,000,000
- **Đặc điểm**:
  - Thấu hiểu huyền cơ của thiên địa
  - Thần thông huyền diệu
  - Có thể dự đoán tương lai

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 1,000,000,000-1,100,000,000, Tuổi thọ 1,000,000-1,100,000 năm
- **Tầng 2**: Power Level 1,100,000,000-1,200,000,000, Tuổi thọ 1,100,000-1,200,000 năm
- **Tầng 3**: Power Level 1,200,000,000-1,300,000,000, Tuổi thọ 1,200,000-1,300,000 năm
- **Tầng 4**: Power Level 1,300,000,000-1,400,000,000, Tuổi thọ 1,300,000-1,400,000 năm
- **Tầng 5**: Power Level 1,400,000,000-1,500,000,000, Tuổi thọ 1,400,000-1,500,000 năm
- **Tầng 6**: Power Level 1,500,000,000-1,600,000,000, Tuổi thọ 1,500,000-1,600,000 năm
- **Tầng 7**: Power Level 1,600,000,000-1,700,000,000, Tuổi thọ 1,600,000-1,700,000 năm
- **Tầng 8**: Power Level 1,700,000,000-1,800,000,000, Tuổi thọ 1,700,000-1,800,000 năm
- **Tầng 9**: Power Level 1,800,000,000-1,900,000,000, Tuổi thọ 1,800,000-1,900,000 năm
- **Viên mãn**: Power Level 1,900,000,000-2,000,000,000, Tuổi thọ 1,900,000-2,000,000 năm

### **12. Thái Ất Tán Tiên (Taiyi Scattered Immortal)**
- **Mô tả**: Tiên nhân tán tiên, đạt đến cảnh giới cao cấp
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 2,000,000-5,000,000 năm
- **Power Level**: 2,000,000,000-5,000,000,000
- **Đặc điểm**:
  - Thân thể tán tiên, gần như bất tử
  - Thần thông siêu việt
  - Có thể tạo ra tiểu thế giới

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 2,000,000,000-2,300,000,000, Tuổi thọ 2,000,000-2,300,000 năm
- **Tầng 2**: Power Level 2,300,000,000-2,600,000,000, Tuổi thọ 2,300,000-2,600,000 năm
- **Tầng 3**: Power Level 2,600,000,000-2,900,000,000, Tuổi thọ 2,600,000-2,900,000 năm
- **Tầng 4**: Power Level 2,900,000,000-3,200,000,000, Tuổi thọ 2,900,000-3,200,000 năm
- **Tầng 5**: Power Level 3,200,000,000-3,500,000,000, Tuổi thọ 3,200,000-3,500,000 năm
- **Tầng 6**: Power Level 3,500,000,000-3,800,000,000, Tuổi thọ 3,500,000-3,800,000 năm
- **Tầng 7**: Power Level 3,800,000,000-4,100,000,000, Tuổi thọ 3,800,000-4,100,000 năm
- **Tầng 8**: Power Level 4,100,000,000-4,400,000,000, Tuổi thọ 4,100,000-4,400,000 năm
- **Tầng 9**: Power Level 4,400,000,000-4,700,000,000, Tuổi thọ 4,400,000-4,700,000 năm
- **Viên mãn**: Power Level 4,700,000,000-5,000,000,000, Tuổi thọ 4,700,000-5,000,000 năm

### **13. Kim Tiên (Golden Immortal)**
- **Mô tả**: Tiên nhân kim sắc, đạt đến đỉnh cao của tiên đạo
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 5,000,000-10,000,000 năm
- **Power Level**: 5,000,000,000-10,000,000,000
- **Đặc điểm**:
  - Thân thể kim sắc bất diệt
  - Thần thông vô biên
  - Có thể sáng tạo và hủy diệt thế giới

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 5,000,000,000-5,500,000,000, Tuổi thọ 5,000,000-5,500,000 năm
- **Tầng 2**: Power Level 5,500,000,000-6,000,000,000, Tuổi thọ 5,500,000-6,000,000 năm
- **Tầng 3**: Power Level 6,000,000,000-6,500,000,000, Tuổi thọ 6,000,000-6,500,000 năm
- **Tầng 4**: Power Level 6,500,000,000-7,000,000,000, Tuổi thọ 6,500,000-7,000,000 năm
- **Tầng 5**: Power Level 7,000,000,000-7,500,000,000, Tuổi thọ 7,000,000-7,500,000 năm
- **Tầng 6**: Power Level 7,500,000,000-8,000,000,000, Tuổi thọ 7,500,000-8,000,000 năm
- **Tầng 7**: Power Level 8,000,000,000-8,500,000,000, Tuổi thọ 8,000,000-8,500,000 năm
- **Tầng 8**: Power Level 8,500,000,000-9,000,000,000, Tuổi thọ 8,500,000-9,000,000 năm
- **Tầng 9**: Power Level 9,000,000,000-9,500,000,000, Tuổi thọ 9,000,000-9,500,000 năm
- **Viên mãn**: Power Level 9,500,000,000-10,000,000,000, Tuổi thọ 9,500,000-10,000,000 năm

### **14. Đại La Kim Tiên (Great Luo Golden Immortal)**
- **Mô tả**: Kim Tiên cấp cao nhất, đạt đến đỉnh cao của tiên đạo
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 10,000,000-50,000,000 năm
- **Power Level**: 10,000,000,000-50,000,000,000
- **Đặc điểm**:
  - Thân thể Đại La bất diệt
  - Thần thông siêu việt
  - Có thể điều khiển quy luật vũ trụ

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 10,000,000,000-14,000,000,000, Tuổi thọ 10,000,000-14,000,000 năm
- **Tầng 2**: Power Level 14,000,000,000-18,000,000,000, Tuổi thọ 14,000,000-18,000,000 năm
- **Tầng 3**: Power Level 18,000,000,000-22,000,000,000, Tuổi thọ 18,000,000-22,000,000 năm
- **Tầng 4**: Power Level 22,000,000,000-26,000,000,000, Tuổi thọ 22,000,000-26,000,000 năm
- **Tầng 5**: Power Level 26,000,000,000-30,000,000,000, Tuổi thọ 26,000,000-30,000,000 năm
- **Tầng 6**: Power Level 30,000,000,000-34,000,000,000, Tuổi thọ 30,000,000-34,000,000 năm
- **Tầng 7**: Power Level 34,000,000,000-38,000,000,000, Tuổi thọ 34,000,000-38,000,000 năm
- **Tầng 8**: Power Level 38,000,000,000-42,000,000,000, Tuổi thọ 38,000,000-42,000,000 năm
- **Tầng 9**: Power Level 42,000,000,000-46,000,000,000, Tuổi thọ 42,000,000-46,000,000 năm
- **Viên mãn**: Power Level 46,000,000,000-50,000,000,000, Tuổi thọ 46,000,000-50,000,000 năm

### **15. Chuẩn Thánh (Quasi-Saint)**
- **Mô tả**: Cấp bậc chuẩn bị trở thành Thánh Nhân
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: 50,000,000-100,000,000 năm
- **Power Level**: 50,000,000,000-100,000,000,000
- **Đặc điểm**:
  - Gần như bất tử hoàn toàn
  - Thần thông tối thượng
  - Chuẩn bị cho Thánh Kiếp

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 50,000,000,000-55,000,000,000, Tuổi thọ 50,000,000-55,000,000 năm
- **Tầng 2**: Power Level 55,000,000,000-60,000,000,000, Tuổi thọ 55,000,000-60,000,000 năm
- **Tầng 3**: Power Level 60,000,000,000-65,000,000,000, Tuổi thọ 60,000,000-65,000,000 năm
- **Tầng 4**: Power Level 65,000,000,000-70,000,000,000, Tuổi thọ 65,000,000-70,000,000 năm
- **Tầng 5**: Power Level 70,000,000,000-75,000,000,000, Tuổi thọ 70,000,000-75,000,000 năm
- **Tầng 6**: Power Level 75,000,000,000-80,000,000,000, Tuổi thọ 75,000,000-80,000,000 năm
- **Tầng 7**: Power Level 80,000,000,000-85,000,000,000, Tuổi thọ 80,000,000-85,000,000 năm
- **Tầng 8**: Power Level 85,000,000,000-90,000,000,000, Tuổi thọ 85,000,000-90,000,000 năm
- **Tầng 9**: Power Level 90,000,000,000-95,000,000,000, Tuổi thọ 90,000,000-95,000,000 năm
- **Viên mãn**: Power Level 95,000,000,000-100,000,000,000, Tuổi thọ 95,000,000-100,000,000 năm

### **16. Thánh Nhân (Saint)**
- **Mô tả**: Cấp bậc cao nhất trong Đạo Giáo, đạt đến sự giác ngộ hoàn toàn
- **Tiểu cảnh giới**: 10 giai đoạn (Tầng 1-9 + Viên mãn)
- **Tuổi thọ**: Bất tử vĩnh viễn
- **Power Level**: 100,000,000,000+
- **Đặc điểm**:
  - Giác ngộ hoàn toàn
  - Quyền năng tối thượng
  - Sáng tạo và hủy diệt vũ trụ
  - Vượt qua mọi giới hạn của thiên địa

**Chi tiết tiểu cảnh giới:**
- **Tầng 1**: Power Level 100,000,000,000-110,000,000,000
- **Tầng 2**: Power Level 110,000,000,000-120,000,000,000
- **Tầng 3**: Power Level 120,000,000,000-130,000,000,000
- **Tầng 4**: Power Level 130,000,000,000-140,000,000,000
- **Tầng 5**: Power Level 140,000,000,000-150,000,000,000
- **Tầng 6**: Power Level 150,000,000,000-160,000,000,000
- **Tầng 7**: Power Level 160,000,000,000-170,000,000,000
- **Tầng 8**: Power Level 170,000,000,000-180,000,000,000
- **Tầng 9**: Power Level 180,000,000,000-190,000,000,000
- **Viên mãn**: Power Level 190,000,000,000-200,000,000,000+

## 📊 **Power Scale Chi Tiết**

### **Công thức Power Level**
```
Power Level = Base_Power × Realm_Multiplier × Substage_Multiplier × Quality_Multiplier
```

### **Công thức Tu Vi**
```
Tu Vi = Power_Level × 1000 (đơn vị: năm tu luyện)
```

> **⚠️ LƯU Ý QUAN TRỌNG VỀ IMPLEMENTATION:**
> - **Tu Vi (XP) phải sử dụng `float64`** để lưu trữ do giá trị rất lớn
> - **Power Level sử dụng `int64`** (đã được phân tích đủ khả năng)
> - **Công thức chuyển đổi**: `float64(tu_vi) = float64(power_level) * 1000.0`
> - **Lý do**: Tu vi có thể lên đến 39+ nghìn tỷ năm, vượt quá khả năng của `int64`

### **Phân Tích Chi Tiết Về Data Types**

#### **Power Level - `int64` (Đủ khả năng)**
- **Giá trị max**: ~9.22 × 10^18
- **Thánh Nhân max**: ~2 × 10^17
- **Safety margin**: ~99.89% (rất an toàn)

#### **Tu Vi - `float64` (Bắt buộc)**
- **Giá trị max**: ~1.8 × 10^308
- **Thánh Nhân max**: ~3.9 × 10^16 năm
- **Safety margin**: ~99.999...% (cực kỳ an toàn)
- **Lý do**: Giá trị quá lớn cho `int64` (max ~9.22 × 10^18)

#### **Công Thức Chuyển Đổi An Toàn**
```go
// Power Level (int64) -> Tu Vi (float64)
func PowerLevelToTuVi(powerLevel int64) float64 {
    return float64(powerLevel) * 1000.0
}

// Tu Vi (float64) -> Power Level (int64) - với làm tròn
func TuViToPowerLevel(tuVi float64) int64 {
    return int64(tuVi / 1000.0)
}
```

### **Ví Dụ Cụ Thể Về Giá Trị Tu Vi**

#### **Phàm Trần Cảnh**
- **Luyện Khí**: 1,000 - 10,000 năm (1.0e3 - 1.0e4)
- **Trúc Cơ**: 10,000 - 100,000 năm (1.0e4 - 1.0e5)
- **Kim Đan**: 100,000 - 1,000,000 năm (1.0e5 - 1.0e6)
- **Nguyên Anh**: 1,000,000 - 10,000,000 năm (1.0e6 - 1.0e7)
- **Hóa Thần**: 10,000,000 - 100,000,000 năm (1.0e7 - 1.0e8)
- **Luyện Hư**: 100,000,000 - 1,000,000,000 năm (1.0e8 - 1.0e9)
- **Hợp Thể**: 1,000,000,000 - 10,000,000,000 năm (1.0e9 - 1.0e10)
- **Đại Thừa**: 10,000,000,000 - 100,000,000,000 năm (1.0e10 - 1.0e11)

#### **Tiên Nhân Cảnh**
- **Địa Tiên**: 100,000,000,000 - 500,000,000,000 năm (1.0e11 - 5.0e11)
- **Thiên Tiên**: 500,000,000,000 - 2,500,000,000,000 năm (5.0e11 - 2.5e12)
- **Huyền Tiên**: 2,500,000,000,000 - 12,500,000,000,000 năm (2.5e12 - 1.25e13)
- **Thái Ất Tán Tiên**: 12,500,000,000,000 - 62,500,000,000,000 năm (1.25e13 - 6.25e13)
- **Kim Tiên**: 62,500,000,000,000 - 312,500,000,000,000 năm (6.25e13 - 3.125e14)
- **Đại La Kim Tiên**: 312,500,000,000,000 - 1,562,500,000,000,000 năm (3.125e14 - 1.5625e15)
- **Chuẩn Thánh**: 1,562,500,000,000,000 - 7,812,500,000,000,000 năm (1.5625e15 - 7.8125e15)
- **Thánh Nhân**: 7,812,500,000,000,000 - 39,062,500,000,000,000+ năm (7.8125e15 - 3.90625e16+)

#### **So Sánh Với Giới Hạn `int64`**
- **`int64` max**: 9,223,372,036,854,775,807 (~9.22e18)
- **Thánh Nhân max**: 39,062,500,000,000,000+ (~3.91e16)
- **Kết luận**: Tu vi vượt quá khả năng của `int64`, **bắt buộc phải dùng `float64`**

## 🏺 **Thiết Kế Đan Điền (Dantian) Chứa Tu Vi**

### **Cấu Trúc Đan Điền**

#### **1. Dantian Core (Lõi Đan Điền)**
```go
type DantianCore struct {
    // Cultivation experience (修炼经验) - Tu vi chính (XP chính)
    CultivationExp float64 `json:"cultivation_exp"` // Years of cultivation (年修炼) - Năm tu luyện
    
    // Auxiliary cultivation experience (辅助修炼经验) - Tu vi phụ (XP phụ - từ các nguồn khác)
    AuxCultivationExp float64 `json:"aux_cultivation_exp"` // From elixirs, herbs, etc. (来自丹药、灵草等) - Tu vi từ linh thảo, đan dược, etc.
    
    // Total cultivation experience (总修炼经验) - Tu vi tổng hợp
    TotalCultivationExp float64 `json:"total_cultivation_exp"` // CultivationExp + AuxCultivationExp (修炼经验 + 辅助修炼经验) - TuVi + TuViPhu
    
    // Dantian level (丹田等级) - Cấp độ đan điền (dựa trên tu vi)
    DantianLevel int64 `json:"dantian_level"` // 1-16 (corresponding to 16 realms) (对应16个境界) - 1-16 (tương ứng 16 cảnh giới)
    
    // Current substage (当前小境界) - Tiểu cảnh giới hiện tại
    CurrentSubstage string `json:"current_substage"` // "Early", "Middle", "Late", "Perfect", "Tier 1-9" (初期、中期、后期、圆满、第1-9层) - "Sơ kỳ", "Trung kỳ", "Hậu kỳ", "Viên mãn", "Tầng 1-9"
}
```

#### **2. Dantian Storage (Kho Chứa Đan Điền)**
```go
type DantianStorage struct {
    // Dantian capacity (丹田容量) - Dung lượng đan điền (khả năng chứa tu vi)
    DantianCapacity float64 `json:"dantian_capacity"` // Maximum cultivation exp that can be stored (最大可存储修炼经验) - Tối đa tu vi có thể chứa
    
    // Used cultivation experience (已使用修炼经验) - Tu vi đã sử dụng
    UsedCultivationExp float64 `json:"used_cultivation_exp"` // Consumed cultivation experience (已消耗修炼经验) - Tu vi đã tiêu hao
    
    // Remaining cultivation experience (剩余修炼经验) - Tu vi còn lại
    RemainingCultivationExp float64 `json:"remaining_cultivation_exp"` // DantianCapacity - UsedCultivationExp (丹田容量 - 已使用修炼经验) - DungLuong - TuViDaSuDung
    
    // Dantian fullness ratio (丹田充盈率) - Tỷ lệ đầy đan điền
    DantianFullnessRatio float64 `json:"dantian_fullness_ratio"` // (CultivationExp / DantianCapacity) * 100 (修炼经验 / 丹田容量) * 100 - (TuVi / DungLuong) * 100
}
```

#### **3. Dantian Quality (Chất Lượng Đan Điền)**
```go
type DantianQuality struct {
    // Dantian purity (丹田纯度) - Độ tinh khiết đan điền
    DantianPurity float64 `json:"dantian_purity"` // 0.0 - 1.0 (purity level) (纯度等级) - 0.0 - 1.0
    
    // Dantian stability (丹田稳定性) - Độ ổn định đan điền
    DantianStability float64 `json:"dantian_stability"` // 0.0 - 1.0 (stability level) (稳定性等级) - 0.0 - 1.0
    
    // Dantian durability (丹田耐久性) - Độ bền vững đan điền
    DantianDurability float64 `json:"dantian_durability"` // 0.0 - 1.0 (durability level) (耐久性等级) - 0.0 - 1.0
    
    // Overall quality (整体质量) - Chất lượng tổng hợp
    OverallQuality float64 `json:"overall_quality"` // Average of the three above (上述三项平均值) - Trung bình 3 chỉ số trên
}
```

### **Công Thức Tính Toán Đan Điền**

#### **1. Dung Lượng Đan Điền**
```go
// Calculate dantian capacity (计算丹田容量) - Dung lượng = Power Level * 1000 * Hệ số mở rộng
func CalculateDantianCapacity(powerLevel int64, expansionFactor float64) float64 {
    return float64(powerLevel) * 1000.0 * expansionFactor
}

// Expansion factors by realm (境界扩展系数) - Hệ số mở rộng theo cảnh giới
var RealmExpansionFactors = map[string]float64{
    "Qi Refining": 1.0,        // 炼气 (Luyện Khí)
    "Foundation Building": 1.5, // 筑基 (Trúc Cơ)
    "Golden Core": 2.0,        // 金丹 (Kim Đan)
    "Nascent Soul": 3.0,       // 元婴 (Nguyên Anh)
    "Spirit Transformation": 5.0, // 化神 (Hóa Thần)
    "Void Refining": 8.0,      // 炼虚 (Luyện Hư)
    "Integration": 12.0,       // 合体 (Hợp Thể)
    "Great Ascension": 20.0,   // 大乘 (Đại Thừa)
    "Earth Immortal": 50.0,    // 地仙 (Địa Tiên)
    "Heaven Immortal": 100.0,  // 天仙 (Thiên Tiên)
    "Mystic Immortal": 200.0,  // 玄仙 (Huyền Tiên)
    "Taiyi Scattered Immortal": 500.0, // 太乙散仙 (Thái Ất Tán Tiên)
    "Golden Immortal": 1000.0, // 金仙 (Kim Tiên)
    "Great Luo Golden Immortal": 2000.0, // 大罗金仙 (Đại La Kim Tiên)
    "Quasi-Saint": 5000.0,     // 准圣 (Chuẩn Thánh)
    "Saint": 10000.0,          // 圣人 (Thánh Nhân)
}
```

#### **2. Cấp Độ Đan Điền**
```go
// Calculate dantian level based on cultivation experience (根据修炼经验计算丹田等级) - Cấp độ dựa trên tu vi
func CalculateDantianLevel(cultivationExp float64) int64 {
    if cultivationExp < 10000 {
        return 1 // Qi Refining (炼气) - Luyện Khí
    } else if cultivationExp < 100000 {
        return 2 // Foundation Building (筑基) - Trúc Cơ
    } else if cultivationExp < 1000000 {
        return 3 // Golden Core (金丹) - Kim Đan
    } else if cultivationExp < 10000000 {
        return 4 // Nascent Soul (元婴) - Nguyên Anh
    } else if cultivationExp < 100000000 {
        return 5 // Spirit Transformation (化神) - Hóa Thần
    } else if cultivationExp < 1000000000 {
        return 6 // Void Refining (炼虚) - Luyện Hư
    } else if cultivationExp < 10000000000 {
        return 7 // Integration (合体) - Hợp Thể
    } else if cultivationExp < 100000000000 {
        return 8 // Great Ascension (大乘) - Đại Thừa
    } else if cultivationExp < 500000000000 {
        return 9 // Earth Immortal (地仙) - Địa Tiên
    } else if cultivationExp < 2500000000000 {
        return 10 // Heaven Immortal (天仙) - Thiên Tiên
    } else if cultivationExp < 12500000000000 {
        return 11 // Mystic Immortal (玄仙) - Huyền Tiên
    } else if cultivationExp < 62500000000000 {
        return 12 // Taiyi Scattered Immortal (太乙散仙) - Thái Ất Tán Tiên
    } else if cultivationExp < 312500000000000 {
        return 13 // Golden Immortal (金仙) - Kim Tiên
    } else if cultivationExp < 1562500000000000 {
        return 14 // Great Luo Golden Immortal (大罗金仙) - Đại La Kim Tiên
    } else if cultivationExp < 7812500000000000 {
        return 15 // Quasi-Saint (准圣) - Chuẩn Thánh
    } else {
        return 16 // Saint (圣人) - Thánh Nhân
    }
}
```

#### **3. Tiểu Cảnh Giới**
```go
// Determine substage based on cultivation experience and level (根据修炼经验和等级确定小境界) - Xác định tiểu cảnh giới dựa trên tu vi và cấp độ
func DetermineSubstage(cultivationExp float64, dantianLevel int64) string {
    switch dantianLevel {
    case 1: // Qi Refining (炼气) - Luyện Khí
        return "Tier 1-10" // 第1-10层 (Tầng 1-10)
    case 2, 3, 4, 5, 6, 7, 8: // Mortal Realms (凡人境界) - Phàm Trần Cảnh
        if cultivationExp < float64(dantianLevel)*10000*0.1 {
            return "Early" // 初期 (Sơ kỳ)
        } else if cultivationExp < float64(dantianLevel)*10000*0.25 {
            return "Middle" // 中期 (Trung kỳ)
        } else if cultivationExp < float64(dantianLevel)*10000*0.5 {
            return "Late" // 后期 (Hậu kỳ)
        } else {
            return "Perfect" // 圆满 (Viên mãn)
        }
    case 9, 10, 11, 12, 13, 14, 15, 16: // Immortal Realms (仙人境界) - Tiên Nhân Cảnh
        // More complex logic for 10 tiers (10层的更复杂逻辑) - Logic phức tạp hơn cho 10 tầng
        return DetermineImmortalSubstage(cultivationExp, dantianLevel)
    default:
        return "Unknown" // 未知 (Không xác định)
    }
}
```

### **Ví Dụ Cụ Thể**

#### **Đan Điền Trúc Cơ Sơ kỳ (Foundation Building Early Stage)**
```json
{
    "cultivation_exp": 15000.0,
    "aux_cultivation_exp": 2000.0,
    "total_cultivation_exp": 17000.0,
    "dantian_level": 2,
    "current_substage": "Early",
    "dantian_capacity": 30000.0,
    "used_cultivation_exp": 5000.0,
    "remaining_cultivation_exp": 25000.0,
    "dantian_fullness_ratio": 56.67,
    "dantian_purity": 0.8,
    "dantian_stability": 0.7,
    "dantian_durability": 0.6,
    "overall_quality": 0.7
}
```

#### **Đan Điền Địa Tiên Tầng 5 (Earth Immortal Tier 5)**
```json
{
    "cultivation_exp": 250000000000.0,
    "aux_cultivation_exp": 50000000000.0,
    "total_cultivation_exp": 300000000000.0,
    "dantian_level": 9,
    "current_substage": "Tier 5",
    "dantian_capacity": 500000000000.0,
    "used_cultivation_exp": 100000000000.0,
    "remaining_cultivation_exp": 400000000000.0,
    "dantian_fullness_ratio": 60.0,
    "dantian_purity": 0.95,
    "dantian_stability": 0.9,
    "dantian_durability": 0.85,
    "overall_quality": 0.9
}
```

### **Tích Hợp Với Actor Core**

#### **1. Dantian trong SubsystemOutput**
```go
// Thêm vào SubsystemOutput
type SubsystemOutput struct {
    Primary []Contribution `json:"primary"`
    Derived []Contribution `json:"derived"`
    Caps []CapContribution `json:"caps"`
    Context map[string]ModifierPack `json:"context,omitempty"`
    Meta SubsystemMeta `json:"meta"`
    
    // Thêm đan điền
    Dantian DantianInfo `json:"dantian,omitempty"`
}

type DantianInfo struct {
    Core DantianCore `json:"core"`
    Storage DantianStorage `json:"storage"`
    Quality DantianQuality `json:"quality"`
}
```

## 🧠 **Hệ Thống 3 Thành Phần Chính (Tinh-Khí-Thần)**

Hệ thống kim đan được xây dựng trên nền tảng **Tinh-Khí-Thần** (Essence-Qi-Spirit), với 3 thành phần chính:

1. **Đan Điền (Dantian)** - Trung tâm lưu trữ và xử lý khí
2. **Kinh Mạch (Meridians)** - Hệ thống vận chuyển khí và tinh
3. **Thức Hải (Spirit Sea)** - Trung tâm ý thức và thần thức

## ⚔️ **Hệ Thống Đạo và Áo Nghĩa (Dao & Profound Meaning System)**

Từ **Tiên cảnh** trở lên, combat và tu luyện phụ thuộc rất nhiều vào **Đạo** (Dao) và **Áo Nghĩa** (Profound Meaning). Đây là hệ thống nâng cao cho turn-based combat:

### **1. Đạo (Dao) - The Way/Path**

**Đạo** là con đường tu luyện và chiến đấu, định hướng cách sử dụng năng lượng và kỹ thuật:

#### **Các Loại Đạo Chính:**
- **Kiếm Đạo (Sword Dao)** - Con đường kiếm thuật
- **Đao Đạo (Blade Dao)** - Con đường đao thuật  
- **Quyền Đạo (Fist Dao)** - Con đường quyền pháp
- **Pháp Đạo (Spell Dao)** - Con đường pháp thuật
- **Trận Đạo (Formation Dao)** - Con đường trận pháp
- **Luyện Đạo (Refinement Dao)** - Con đường luyện khí/luyện đan
- **Tâm Đạo (Heart Dao)** - Con đường tâm cảnh
- **Thiên Đạo (Heaven Dao)** - Con đường thiên đạo
- **Địa Đạo (Earth Dao)** - Con đường địa đạo
- **Nhân Đạo (Human Dao)** - Con đường nhân đạo

#### **Cấp Độ Đạo:**
1. **Sơ Ngộ (Initial Comprehension)** - 1-3 tầng
2. **Tiểu Thành (Minor Achievement)** - 4-6 tầng  
3. **Đại Thành (Major Achievement)** - 7-9 tầng
4. **Viên Mãn (Perfection)** - 10 tầng
5. **Siêu Thoát (Transcendence)** - 11+ tầng

### **2. Áo Nghĩa (Profound Meaning) - Deep Understanding**

**Áo Nghĩa** là sự hiểu biết sâu sắc về bản chất của Đạo, ảnh hưởng trực tiếp đến combat effectiveness:

#### **Các Loại Áo Nghĩa:**
- **Kiếm Ý (Sword Intent)** - Ý niệm kiếm thuật
- **Đao Ý (Blade Intent)** - Ý niệm đao thuật
- **Quyền Ý (Fist Intent)** - Ý niệm quyền pháp
- **Pháp Ý (Spell Intent)** - Ý niệm pháp thuật
- **Trận Ý (Formation Intent)** - Ý niệm trận pháp
- **Luyện Ý (Refinement Intent)** - Ý niệm luyện khí
- **Tâm Ý (Heart Intent)** - Ý niệm tâm cảnh
- **Thiên Ý (Heaven Intent)** - Ý niệm thiên đạo
- **Địa Ý (Earth Intent)** - Ý niệm địa đạo
- **Nhân Ý (Human Intent)** - Ý niệm nhân đạo

#### **Cấp Độ Áo Nghĩa:**
1. **Mơ Hồ (Vague)** - 1-2 tầng
2. **Rõ Ràng (Clear)** - 3-4 tầng
3. **Sâu Sắc (Profound)** - 5-6 tầng
4. **Tinh Thông (Mastery)** - 7-8 tầng
5. **Siêu Phàm (Transcendent)** - 9+ tầng

### **3. Tương Tác Đạo-Áo Nghĩa trong Combat:**

#### **Combat Multipliers:**
- **Dao Level × Profound Meaning Level = Combat Effectiveness**
- **Dao Compatibility** - Tương thích giữa các loại Đạo
- **Profound Resonance** - Cộng hưởng giữa các Áo Nghĩa
- **Dao Suppression** - Áp chế Đạo yếu hơn
- **Profound Overwhelm** - Áp đảo Áo Nghĩa yếu hơn

#### **Turn-Based Combat Effects:**
- **Action Points** - Số điểm hành động mỗi turn
- **Dao Techniques** - Kỹ thuật đặc biệt theo Đạo
- **Profound Abilities** - Khả năng đặc biệt theo Áo Nghĩa
- **Counter-Attacks** - Phản công dựa trên Đạo
- **Defensive Stances** - Tư thế phòng thủ theo Áo Nghĩa

### **4. Cấu Trúc Chi Tiết Hệ Thống Đạo và Áo Nghĩa:**

#### **A. Dao System (Hệ Thống Đạo):**

```go
// Dao System (道系统) - Hệ thống Đạo
type DaoSystem struct {
    // Dao Paths Map (道径映射) - Map các con đường Đạo
    // Key: DaoType string, Value: DaoPath
    DaoPaths map[string]DaoPath `json:"dao_paths"`
    
    // Primary Dao Type (主道类型) - Loại Đạo chính
    PrimaryDaoType string `json:"primary_dao_type"`
    
    // Dao Comprehension (道理解) - Sự hiểu biết về Đạo
    DaoComprehension DaoComprehension `json:"dao_comprehension"`
    
    // Dao Techniques Map (道术映射) - Map kỹ thuật Đạo
    // Key: DaoType string, Value: []DaoTechnique
    DaoTechniques map[string][]DaoTechnique `json:"dao_techniques"`
    
    // Dao Compatibility (道兼容性) - Tương thích Đạo
    DaoCompatibility DaoCompatibility `json:"dao_compatibility"`
}

// Dao Path (道径) - Con đường Đạo
type DaoPath struct {
    // Basic info (基本信息) - Thông tin cơ bản
    DaoType        string  `json:"dao_type"`        // Type of Dao (道类型) - Loại Đạo
    DaoLevel       int     `json:"dao_level"`       // Dao level (道等级) - Cấp độ Đạo
    DaoExperience  float64 `json:"dao_experience"`  // Dao experience (道经验) - Kinh nghiệm Đạo
    DaoMastery     float64 `json:"dao_mastery"`     // Dao mastery (道掌握) - Mức độ thành thạo
    
    // Advanced properties (高级属性) - Thuộc tính nâng cao
    DaoInsight     float64 `json:"dao_insight"`     // Dao insight (道洞察) - Sự thấu hiểu Đạo
    DaoWisdom      float64 `json:"dao_wisdom"`      // Dao wisdom (道智慧) - Trí tuệ Đạo
    DaoHarmony     float64 `json:"dao_harmony"`     // Dao harmony (道和谐) - Sự hài hòa Đạo
    DaoTranscendence float64 `json:"dao_transcendence"` // Dao transcendence (道超脱) - Siêu thoát Đạo
    
    // Status flags (状态标志) - Cờ trạng thái
    IsActive       bool    `json:"is_active"`       // Is this Dao active (是否激活) - Đạo này có đang hoạt động không
    IsPrimary      bool    `json:"is_primary"`      // Is this the primary Dao (是否主道) - Có phải Đạo chính không
    UnlockedAt     int64   `json:"unlocked_at"`     // When this Dao was unlocked (解锁时间) - Thời điểm mở khóa Đạo này
}

// Dao Type Constants (道类型常量) - Hằng số loại Đạo
const (
    DaoTypeSword     = "sword_dao"     // Sword Dao (剑道) - Kiếm Đạo
    DaoTypeBlade     = "blade_dao"     // Blade Dao (刀道) - Đao Đạo
    DaoTypeFist      = "fist_dao"      // Fist Dao (拳道) - Quyền Đạo
    DaoTypeSpell     = "spell_dao"     // Spell Dao (法道) - Pháp Đạo
    DaoTypeFormation = "formation_dao" // Formation Dao (阵道) - Trận Đạo
    DaoTypeRefinement = "refinement_dao" // Refinement Dao (炼道) - Luyện Đạo
    DaoTypeHeart     = "heart_dao"     // Heart Dao (心道) - Tâm Đạo
    DaoTypeHeaven    = "heaven_dao"    // Heaven Dao (天道) - Thiên Đạo
    DaoTypeEarth     = "earth_dao"     // Earth Dao (地道) - Địa Đạo
    DaoTypeHuman     = "human_dao"     // Human Dao (人道) - Nhân Đạo
)

// All Dao Types (所有道类型) - Tất cả loại Đạo
var AllDaoTypes = []string{
    DaoTypeSword, DaoTypeBlade, DaoTypeFist, DaoTypeSpell, DaoTypeFormation,
    DaoTypeRefinement, DaoTypeHeart, DaoTypeHeaven, DaoTypeEarth, DaoTypeHuman,
}

// Dao Comprehension (道理解) - Sự hiểu biết về Đạo
type DaoComprehension struct {
    // Basic comprehension (基础理解) - Hiểu biết cơ bản
    BasicUnderstanding float64 `json:"basic_understanding"` // Basic understanding (基础理解) - Hiểu biết cơ bản
    IntermediateUnderstanding float64 `json:"intermediate_understanding"` // Intermediate understanding (中级理解) - Hiểu biết trung cấp
    AdvancedUnderstanding float64 `json:"advanced_understanding"` // Advanced understanding (高级理解) - Hiểu biết nâng cao
    
    // Profound comprehension (深刻理解) - Hiểu biết sâu sắc
    ProfoundInsight    float64 `json:"profound_insight"`    // Profound insight (深刻洞察) - Sự thấu hiểu sâu sắc
    TranscendentWisdom float64 `json:"transcendent_wisdom"` // Transcendent wisdom (超脱智慧) - Trí tuệ siêu thoát
    DaoEssence        float64 `json:"dao_essence"`          // Dao essence (道本质) - Bản chất Đạo
}

// Dao Technique (道术) - Kỹ thuật Đạo
type DaoTechnique struct {
    // Basic info (基本信息) - Thông tin cơ bản
    TechniqueName    string  `json:"technique_name"`    // Technique name (术名称) - Tên kỹ thuật
    TechniqueType    string  `json:"technique_type"`    // Technique type (术类型) - Loại kỹ thuật
    TechniqueLevel   int     `json:"technique_level"`   // Technique level (术等级) - Cấp độ kỹ thuật
    TechniquePower   float64 `json:"technique_power"`   // Technique power (术威力) - Sức mạnh kỹ thuật
    
    // Advanced properties (高级属性) - Thuộc tính nâng cao
    TechniqueCost    float64 `json:"technique_cost"`    // Technique cost (术消耗) - Chi phí kỹ thuật
    TechniqueCooldown float64 `json:"technique_cooldown"` // Technique cooldown (术冷却) - Thời gian hồi chiêu
    TechniqueRange   float64 `json:"technique_range"`   // Technique range (术范围) - Phạm vi kỹ thuật
    TechniqueAccuracy float64 `json:"technique_accuracy"` // Technique accuracy (术精度) - Độ chính xác kỹ thuật
}

// Dao Compatibility (道兼容性) - Tương thích Đạo
type DaoCompatibility struct {
    // Compatibility matrix (兼容性矩阵) - Ma trận tương thích
    CompatibilityMatrix map[string]map[string]float64 `json:"compatibility_matrix"`
    
    // Resonance effects (共振效果) - Hiệu ứng cộng hưởng
    ResonanceEffects map[string]float64 `json:"resonance_effects"`
    
    // Suppression effects (压制效果) - Hiệu ứng áp chế
    SuppressionEffects map[string]float64 `json:"suppression_effects"`
}
```

#### **B. Profound Meaning System (Hệ Thống Áo Nghĩa):**

```go
// Profound Meaning System (奥义系统) - Hệ thống Áo Nghĩa
type ProfoundMeaningSystem struct {
    // Profound Meanings Map (奥义映射) - Map các Áo Nghĩa
    // Key: ProfoundMeaningType string, Value: ProfoundMeaning
    ProfoundMeanings map[string]ProfoundMeaning `json:"profound_meanings"`
    
    // Primary Profound Meaning Type (主奥义类型) - Loại Áo Nghĩa chính
    PrimaryProfoundMeaningType string `json:"primary_profound_meaning_type"`
    
    // Profound Understanding (奥义理解) - Sự hiểu biết Áo Nghĩa
    ProfoundUnderstanding ProfoundUnderstanding `json:"profound_understanding"`
    
    // Profound Abilities Map (奥义能力映射) - Map khả năng Áo Nghĩa
    // Key: ProfoundMeaningType string, Value: []ProfoundAbility
    ProfoundAbilities map[string][]ProfoundAbility `json:"profound_abilities"`
    
    // Profound Resonance (奥义共振) - Cộng hưởng Áo Nghĩa
    ProfoundResonance ProfoundResonance `json:"profound_resonance"`
}

// Profound Meaning (奥义) - Áo Nghĩa
type ProfoundMeaning struct {
    // Basic info (基本信息) - Thông tin cơ bản
    MeaningType      string  `json:"meaning_type"`      // Type of Profound Meaning (奥义类型) - Loại Áo Nghĩa
    MeaningLevel     int     `json:"meaning_level"`     // Profound Meaning level (奥义等级) - Cấp độ Áo Nghĩa
    MeaningExperience float64 `json:"meaning_experience"` // Profound Meaning experience (奥义经验) - Kinh nghiệm Áo Nghĩa
    MeaningMastery   float64 `json:"meaning_mastery"`    // Profound Meaning mastery (奥义掌握) - Mức độ thành thạo
    
    // Advanced properties (高级属性) - Thuộc tính nâng cao
    MeaningInsight   float64 `json:"meaning_insight"`   // Profound Meaning insight (奥义洞察) - Sự thấu hiểu Áo Nghĩa
    MeaningWisdom    float64 `json:"meaning_wisdom"`    // Profound Meaning wisdom (奥义智慧) - Trí tuệ Áo Nghĩa
    MeaningHarmony   float64 `json:"meaning_harmony"`   // Profound Meaning harmony (奥义和谐) - Sự hài hòa Áo Nghĩa
    MeaningTranscendence float64 `json:"meaning_transcendence"` // Profound Meaning transcendence (奥义超脱) - Siêu thoát Áo Nghĩa
    
    // Status flags (状态标志) - Cờ trạng thái
    IsActive         bool    `json:"is_active"`         // Is this Profound Meaning active (是否激活) - Áo Nghĩa này có đang hoạt động không
    IsPrimary        bool    `json:"is_primary"`        // Is this the primary Profound Meaning (是否主奥义) - Có phải Áo Nghĩa chính không
    UnlockedAt       int64   `json:"unlocked_at"`       // When this Profound Meaning was unlocked (解锁时间) - Thời điểm mở khóa Áo Nghĩa này
}

// Profound Meaning Type Constants (奥义类型常量) - Hằng số loại Áo Nghĩa
const (
    ProfoundMeaningTypeSwordIntent     = "sword_intent"     // Sword Intent (剑意) - Kiếm Ý
    ProfoundMeaningTypeBladeIntent     = "blade_intent"     // Blade Intent (刀意) - Đao Ý
    ProfoundMeaningTypeFistIntent      = "fist_intent"      // Fist Intent (拳意) - Quyền Ý
    ProfoundMeaningTypeSpellIntent     = "spell_intent"     // Spell Intent (法意) - Pháp Ý
    ProfoundMeaningTypeFormationIntent = "formation_intent" // Formation Intent (阵意) - Trận Ý
    ProfoundMeaningTypeRefinementIntent = "refinement_intent" // Refinement Intent (炼意) - Luyện Ý
    ProfoundMeaningTypeHeartIntent     = "heart_intent"     // Heart Intent (心意) - Tâm Ý
    ProfoundMeaningTypeHeavenIntent    = "heaven_intent"    // Heaven Intent (天意) - Thiên Ý
    ProfoundMeaningTypeEarthIntent     = "earth_intent"     // Earth Intent (地意) - Địa Ý
    ProfoundMeaningTypeHumanIntent     = "human_intent"     // Human Intent (人意) - Nhân Ý
)

// All Profound Meaning Types (所有奥义类型) - Tất cả loại Áo Nghĩa
var AllProfoundMeaningTypes = []string{
    ProfoundMeaningTypeSwordIntent, ProfoundMeaningTypeBladeIntent, ProfoundMeaningTypeFistIntent,
    ProfoundMeaningTypeSpellIntent, ProfoundMeaningTypeFormationIntent, ProfoundMeaningTypeRefinementIntent,
    ProfoundMeaningTypeHeartIntent, ProfoundMeaningTypeHeavenIntent, ProfoundMeaningTypeEarthIntent,
    ProfoundMeaningTypeHumanIntent,
}

// Profound Understanding (奥义理解) - Sự hiểu biết Áo Nghĩa
type ProfoundUnderstanding struct {
    // Basic understanding (基础理解) - Hiểu biết cơ bản
    BasicUnderstanding float64 `json:"basic_understanding"` // Basic understanding (基础理解) - Hiểu biết cơ bản
    IntermediateUnderstanding float64 `json:"intermediate_understanding"` // Intermediate understanding (中级理解) - Hiểu biết trung cấp
    AdvancedUnderstanding float64 `json:"advanced_understanding"` // Advanced understanding (高级理解) - Hiểu biết nâng cao
    
    // Profound understanding (深刻理解) - Hiểu biết sâu sắc
    ProfoundInsight    float64 `json:"profound_insight"`    // Profound insight (深刻洞察) - Sự thấu hiểu sâu sắc
    TranscendentWisdom float64 `json:"transcendent_wisdom"` // Transcendent wisdom (超脱智慧) - Trí tuệ siêu thoát
    MeaningEssence     float64 `json:"meaning_essence"`     // Profound Meaning essence (奥义本质) - Bản chất Áo Nghĩa
}

// Profound Ability (奥义能力) - Khả năng Áo Nghĩa
type ProfoundAbility struct {
    // Basic info (基本信息) - Thông tin cơ bản
    AbilityName    string  `json:"ability_name"`    // Ability name (能力名称) - Tên khả năng
    AbilityType    string  `json:"ability_type"`    // Ability type (能力类型) - Loại khả năng
    AbilityLevel   int     `json:"ability_level"`   // Ability level (能力等级) - Cấp độ khả năng
    AbilityPower   float64 `json:"ability_power"`   // Ability power (能力威力) - Sức mạnh khả năng
    
    // Advanced properties (高级属性) - Thuộc tính nâng cao
    AbilityCost    float64 `json:"ability_cost"`    // Ability cost (能力消耗) - Chi phí khả năng
    AbilityCooldown float64 `json:"ability_cooldown"` // Ability cooldown (能力冷却) - Thời gian hồi chiêu
    AbilityRange   float64 `json:"ability_range"`   // Ability range (能力范围) - Phạm vi khả năng
    AbilityAccuracy float64 `json:"ability_accuracy"` // Ability accuracy (能力精度) - Độ chính xác khả năng
}

// Profound Resonance (奥义共振) - Cộng hưởng Áo Nghĩa
type ProfoundResonance struct {
    // Resonance matrix (共振矩阵) - Ma trận cộng hưởng
    ResonanceMatrix map[string]map[string]float64 `json:"resonance_matrix"`
    
    // Resonance effects (共振效果) - Hiệu ứng cộng hưởng
    ResonanceEffects map[string]float64 `json:"resonance_effects"`
    
    // Overwhelm effects (压倒效果) - Hiệu ứng áp đảo
    OverwhelmEffects map[string]float64 `json:"overwhelm_effects"`
}
```

#### **C. Primary Stats từ Đạo và Áo Nghĩa:**

```go
// Dao-related primary stats (道相关主要属性) - Các primary stats từ Đạo
var DaoPrimaryStats = []string{
    // Core Dao stats (核心道属性) - Stats cốt lõi Đạo
    "dao_level",              // Dao level (道等级) - Cấp độ Đạo
    "dao_experience",         // Dao experience (道经验) - Kinh nghiệm Đạo
    "dao_mastery",           // Dao mastery (道掌握) - Mức độ thành thạo Đạo
    "dao_insight",           // Dao insight (道洞察) - Sự thấu hiểu Đạo
    "dao_wisdom",            // Dao wisdom (道智慧) - Trí tuệ Đạo
    
    // Advanced Dao stats (高级道属性) - Stats nâng cao Đạo
    "dao_harmony",           // Dao harmony (道和谐) - Sự hài hòa Đạo
    "dao_transcendence",     // Dao transcendence (道超脱) - Siêu thoát Đạo
    "dao_compatibility",     // Dao compatibility (道兼容性) - Tương thích Đạo
    "dao_suppression",       // Dao suppression (道压制) - Áp chế Đạo
    "dao_resonance",         // Dao resonance (道共振) - Cộng hưởng Đạo
    
    // Multi-Dao stats (多道属性) - Stats đa Đạo
    "total_dao_level",       // Total Dao level (总道等级) - Tổng cấp độ Đạo
    "total_dao_experience",  // Total Dao experience (总道经验) - Tổng kinh nghiệm Đạo
    "total_dao_mastery",     // Total Dao mastery (总道掌握) - Tổng mức độ thành thạo Đạo
    "active_dao_count",      // Active Dao count (激活道数量) - Số lượng Đạo đang hoạt động
    "average_dao_level",     // Average Dao level (平均道等级) - Cấp độ Đạo trung bình
    
    // Dao technique stats (道术属性) - Stats kỹ thuật Đạo
    "dao_technique_power",   // Dao technique power (道术威力) - Sức mạnh kỹ thuật Đạo
    "dao_technique_cost",    // Dao technique cost (道术消耗) - Chi phí kỹ thuật Đạo
    "dao_technique_cooldown", // Dao technique cooldown (道术冷却) - Thời gian hồi chiêu kỹ thuật Đạo
    "dao_technique_range",   // Dao technique range (道术范围) - Phạm vi kỹ thuật Đạo
    "dao_technique_accuracy", // Dao technique accuracy (道术精度) - Độ chính xác kỹ thuật Đạo
}

// Profound Meaning primary stats (奥义主要属性) - Các primary stats từ Áo Nghĩa
var ProfoundMeaningPrimaryStats = []string{
    // Core Profound Meaning stats (核心奥义属性) - Stats cốt lõi Áo Nghĩa
    "profound_meaning_level",     // Profound Meaning level (奥义等级) - Cấp độ Áo Nghĩa
    "profound_meaning_experience", // Profound Meaning experience (奥义经验) - Kinh nghiệm Áo Nghĩa
    "profound_meaning_mastery",   // Profound Meaning mastery (奥义掌握) - Mức độ thành thạo Áo Nghĩa
    "profound_meaning_insight",   // Profound Meaning insight (奥义洞察) - Sự thấu hiểu Áo Nghĩa
    "profound_meaning_wisdom",    // Profound Meaning wisdom (奥义智慧) - Trí tuệ Áo Nghĩa
    
    // Advanced Profound Meaning stats (高级奥义属性) - Stats nâng cao Áo Nghĩa
    "profound_meaning_harmony",   // Profound Meaning harmony (奥义和谐) - Sự hài hòa Áo Nghĩa
    "profound_meaning_transcendence", // Profound Meaning transcendence (奥义超脱) - Siêu thoát Áo Nghĩa
    "profound_meaning_resonance", // Profound Meaning resonance (奥义共振) - Cộng hưởng Áo Nghĩa
    "profound_meaning_overwhelm", // Profound Meaning overwhelm (奥义压倒) - Áp đảo Áo Nghĩa
    "profound_meaning_essence",   // Profound Meaning essence (奥义本质) - Bản chất Áo Nghĩa
    
    // Multi-Profound Meaning stats (多奥义属性) - Stats đa Áo Nghĩa
    "total_profound_meaning_level",     // Total Profound Meaning level (总奥义等级) - Tổng cấp độ Áo Nghĩa
    "total_profound_meaning_experience", // Total Profound Meaning experience (总奥义经验) - Tổng kinh nghiệm Áo Nghĩa
    "total_profound_meaning_mastery",   // Total Profound Meaning mastery (总奥义掌握) - Tổng mức độ thành thạo Áo Nghĩa
    "active_profound_meaning_count",    // Active Profound Meaning count (激活奥义数量) - Số lượng Áo Nghĩa đang hoạt động
    "average_profound_meaning_level",   // Average Profound Meaning level (平均奥义等级) - Cấp độ Áo Nghĩa trung bình
    
    // Profound Meaning ability stats (奥义能力属性) - Stats khả năng Áo Nghĩa
    "profound_ability_power",     // Profound Meaning ability power (奥义能力威力) - Sức mạnh khả năng Áo Nghĩa
    "profound_ability_cost",      // Profound Meaning ability cost (奥义能力消耗) - Chi phí khả năng Áo Nghĩa
    "profound_ability_cooldown",  // Profound Meaning ability cooldown (奥义能力冷却) - Thời gian hồi chiêu khả năng Áo Nghĩa
    "profound_ability_range",     // Profound Meaning ability range (奥义能力范围) - Phạm vi khả năng Áo Nghĩa
    "profound_ability_accuracy",  // Profound Meaning ability accuracy (奥义能力精度) - Độ chính xác khả năng Áo Nghĩa
}
```

#### **D. Công Thức Tính Toán Đạo và Áo Nghĩa:**

```go
// Calculate Dao stats (计算道属性) - Tính toán các stats của Đạo
func CalculateDaoStats(daoSystem DaoSystem) map[string]float64 {
    stats := make(map[string]float64)
    
    // Get primary Dao (获取主道) - Lấy Đạo chính
    primaryDao, exists := daoSystem.DaoPaths[daoSystem.PrimaryDaoType]
    if !exists {
        return stats // Return empty if no primary Dao (如果没有主道则返回空) - Nếu không có Đạo chính thì trả về rỗng
    }
    
    // Core Dao stats (核心道属性) - Stats cốt lõi Đạo
    stats["dao_level"] = float64(primaryDao.DaoLevel)
    stats["dao_experience"] = primaryDao.DaoExperience
    stats["dao_mastery"] = primaryDao.DaoMastery
    stats["dao_insight"] = primaryDao.DaoInsight
    stats["dao_wisdom"] = primaryDao.DaoWisdom
    
    // Advanced Dao stats (高级道属性) - Stats nâng cao Đạo
    stats["dao_harmony"] = primaryDao.DaoHarmony
    stats["dao_transcendence"] = primaryDao.DaoTranscendence
    
    // Calculate total stats across all active Daos (计算所有激活道的总属性) - Tính toán tổng stats từ tất cả Đạo đang hoạt động
    totalLevel := 0.0
    totalExperience := 0.0
    totalMastery := 0.0
    activeDaoCount := 0
    
    for _, dao := range daoSystem.DaoPaths {
        if dao.IsActive {
            totalLevel += float64(dao.DaoLevel)
            totalExperience += dao.DaoExperience
            totalMastery += dao.DaoMastery
            activeDaoCount++
        }
    }
    
    // Average stats across active Daos (激活道的平均属性) - Stats trung bình của các Đạo đang hoạt động
    if activeDaoCount > 0 {
        stats["total_dao_level"] = totalLevel
        stats["total_dao_experience"] = totalExperience
        stats["total_dao_mastery"] = totalMastery
        stats["active_dao_count"] = float64(activeDaoCount)
        stats["average_dao_level"] = totalLevel / float64(activeDaoCount)
    }
    
    // Calculate compatibility and resonance (计算兼容性和共振) - Tính toán tương thích và cộng hưởng
    stats["dao_compatibility"] = calculateDaoCompatibility(daoSystem.DaoCompatibility)
    stats["dao_resonance"] = calculateDaoResonance(daoSystem.DaoCompatibility)
    stats["dao_suppression"] = calculateDaoSuppression(daoSystem.DaoCompatibility)
    
    // Calculate technique stats (计算道术属性) - Tính toán stats kỹ thuật Đạo
    techniqueStats := calculateDaoTechniqueStats(daoSystem.DaoTechniques)
    for key, value := range techniqueStats {
        stats[key] = value
    }
    
    return stats
}

// Calculate Profound Meaning stats (计算奥义属性) - Tính toán các stats của Áo Nghĩa
func CalculateProfoundMeaningStats(profoundSystem ProfoundMeaningSystem) map[string]float64 {
    stats := make(map[string]float64)
    
    // Get primary Profound Meaning (获取主奥义) - Lấy Áo Nghĩa chính
    primaryProfound, exists := profoundSystem.ProfoundMeanings[profoundSystem.PrimaryProfoundMeaningType]
    if !exists {
        return stats // Return empty if no primary Profound Meaning (如果没有主奥义则返回空) - Nếu không có Áo Nghĩa chính thì trả về rỗng
    }
    
    // Core Profound Meaning stats (核心奥义属性) - Stats cốt lõi Áo Nghĩa
    stats["profound_meaning_level"] = float64(primaryProfound.MeaningLevel)
    stats["profound_meaning_experience"] = primaryProfound.MeaningExperience
    stats["profound_meaning_mastery"] = primaryProfound.MeaningMastery
    stats["profound_meaning_insight"] = primaryProfound.MeaningInsight
    stats["profound_meaning_wisdom"] = primaryProfound.MeaningWisdom
    
    // Advanced Profound Meaning stats (高级奥义属性) - Stats nâng cao Áo Nghĩa
    stats["profound_meaning_harmony"] = primaryProfound.MeaningHarmony
    stats["profound_meaning_transcendence"] = primaryProfound.MeaningTranscendence
    
    // Calculate total stats across all active Profound Meanings (计算所有激活奥义的总属性) - Tính toán tổng stats từ tất cả Áo Nghĩa đang hoạt động
    totalLevel := 0.0
    totalExperience := 0.0
    totalMastery := 0.0
    activeProfoundCount := 0
    
    for _, profound := range profoundSystem.ProfoundMeanings {
        if profound.IsActive {
            totalLevel += float64(profound.MeaningLevel)
            totalExperience += profound.MeaningExperience
            totalMastery += profound.MeaningMastery
            activeProfoundCount++
        }
    }
    
    // Average stats across active Profound Meanings (激活奥义的平均属性) - Stats trung bình của các Áo Nghĩa đang hoạt động
    if activeProfoundCount > 0 {
        stats["total_profound_meaning_level"] = totalLevel
        stats["total_profound_meaning_experience"] = totalExperience
        stats["total_profound_meaning_mastery"] = totalMastery
        stats["active_profound_meaning_count"] = float64(activeProfoundCount)
        stats["average_profound_meaning_level"] = totalLevel / float64(activeProfoundCount)
    }
    
    // Calculate resonance and overwhelm (计算共振和压倒) - Tính toán cộng hưởng và áp đảo
    stats["profound_meaning_resonance"] = calculateProfoundResonance(profoundSystem.ProfoundResonance)
    stats["profound_meaning_overwhelm"] = calculateProfoundOverwhelm(profoundSystem.ProfoundResonance)
    stats["profound_meaning_essence"] = calculateProfoundEssence(profoundSystem.ProfoundUnderstanding)
    
    // Calculate ability stats (计算奥义能力属性) - Tính toán stats khả năng Áo Nghĩa
    abilityStats := calculateProfoundAbilityStats(profoundSystem.ProfoundAbilities)
    for key, value := range abilityStats {
        stats[key] = value
    }
    
    return stats
}

// Calculate turn-based combat stats (计算回合制战斗属性) - Tính toán stats turn-based combat
func CalculateTurnBasedCombatStats(daoSystem DaoSystem, profoundSystem ProfoundMeaningSystem) map[string]float64 {
    stats := make(map[string]float64)
    
    // Action Points calculation (行动点计算) - Tính toán điểm hành động
    baseActionPoints := 3.0 // Base action points (基础行动点) - Điểm hành động cơ bản
    daoBonus := float64(daoSystem.PrimaryDao.DaoLevel) * 0.1 // Dao bonus (道加成) - Bonus từ Đạo
    profoundBonus := float64(profoundSystem.PrimaryProfoundMeaning.MeaningLevel) * 0.05 // Profound bonus (奥义加成) - Bonus từ Áo Nghĩa
    
    stats["action_points"] = baseActionPoints + daoBonus + profoundBonus
    stats["max_action_points"] = stats["action_points"]
    
    // Combat effectiveness calculation (战斗效果计算) - Tính toán hiệu quả chiến đấu
    daoLevel := float64(daoSystem.PrimaryDao.DaoLevel)
    profoundLevel := float64(profoundSystem.PrimaryProfoundMeaning.MeaningLevel)
    stats["combat_effectiveness"] = daoLevel * profoundLevel
    
    // Technique power calculation (道术威力计算) - Tính toán sức mạnh kỹ thuật
    baseTechniquePower := 100.0 // Base technique power (基础道术威力) - Sức mạnh kỹ thuật cơ bản
    daoMultiplier := 1.0 + (daoLevel * 0.1) // Dao multiplier (道倍数) - Hệ số Đạo
    profoundMultiplier := 1.0 + (profoundLevel * 0.05) // Profound multiplier (奥义倍数) - Hệ số Áo Nghĩa
    
    stats["technique_power"] = baseTechniquePower * daoMultiplier * profoundMultiplier
    
    // Ability power calculation (奥义能力威力计算) - Tính toán sức mạnh khả năng Áo Nghĩa
    baseAbilityPower := 150.0 // Base ability power (基础奥义能力威力) - Sức mạnh khả năng cơ bản
    stats["ability_power"] = baseAbilityPower * daoMultiplier * profoundMultiplier
    
    // Counter-attack chance calculation (反击概率计算) - Tính toán xác suất phản công
    baseCounterChance := 0.1 // Base counter chance (基础反击概率) - Xác suất phản công cơ bản
    daoCounterBonus := daoLevel * 0.01 // Dao counter bonus (道反击加成) - Bonus phản công từ Đạo
    profoundCounterBonus := profoundLevel * 0.005 // Profound counter bonus (奥义反击加成) - Bonus phản công từ Áo Nghĩa
    
    stats["counter_attack_chance"] = baseCounterChance + daoCounterBonus + profoundCounterBonus
    
    // Defensive stance effectiveness (防御姿态效果) - Hiệu quả tư thế phòng thủ
    baseDefense := 50.0 // Base defense (基础防御) - Phòng thủ cơ bản
    daoDefenseBonus := daoLevel * 2.0 // Dao defense bonus (道防御加成) - Bonus phòng thủ từ Đạo
    profoundDefenseBonus := profoundLevel * 1.0 // Profound defense bonus (奥义防御加成) - Bonus phòng thủ từ Áo Nghĩa
    
    stats["defensive_effectiveness"] = baseDefense + daoDefenseBonus + profoundDefenseBonus
    
    return stats
}

// Helper functions (辅助函数) - Các hàm trợ giúp
func calculateDaoCompatibility(compatibility DaoCompatibility) float64 {
    // Calculate overall compatibility (计算总体兼容性) - Tính toán tương thích tổng thể
    totalCompatibility := 0.0
    count := 0
    
    for _, innerMap := range compatibility.CompatibilityMatrix {
        for _, value := range innerMap {
            totalCompatibility += value
            count++
        }
    }
    
    if count > 0 {
        return totalCompatibility / float64(count)
    }
    return 0.0
}

func calculateDaoResonance(compatibility DaoCompatibility) float64 {
    // Calculate overall resonance (计算总体共振) - Tính toán cộng hưởng tổng thể
    totalResonance := 0.0
    count := 0
    
    for _, value := range compatibility.ResonanceEffects {
        totalResonance += value
        count++
    }
    
    if count > 0 {
        return totalResonance / float64(count)
    }
    return 0.0
}

func calculateDaoSuppression(compatibility DaoCompatibility) float64 {
    // Calculate overall suppression (计算总体压制) - Tính toán áp chế tổng thể
    totalSuppression := 0.0
    count := 0
    
    for _, value := range compatibility.SuppressionEffects {
        totalSuppression += value
        count++
    }
    
    if count > 0 {
        return totalSuppression / float64(count)
    }
    return 0.0
}

func calculateDaoTechniqueStats(techniques []DaoTechnique) map[string]float64 {
    stats := make(map[string]float64)
    
    if len(techniques) == 0 {
        return stats
    }
    
    // Calculate average technique stats (计算平均道术属性) - Tính toán stats kỹ thuật trung bình
    totalPower := 0.0
    totalCost := 0.0
    totalCooldown := 0.0
    totalRange := 0.0
    totalAccuracy := 0.0
    
    for _, technique := range techniques {
        totalPower += technique.TechniquePower
        totalCost += technique.TechniqueCost
        totalCooldown += technique.TechniqueCooldown
        totalRange += technique.TechniqueRange
        totalAccuracy += technique.TechniqueAccuracy
    }
    
    count := float64(len(techniques))
    stats["dao_technique_power"] = totalPower / count
    stats["dao_technique_cost"] = totalCost / count
    stats["dao_technique_cooldown"] = totalCooldown / count
    stats["dao_technique_range"] = totalRange / count
    stats["dao_technique_accuracy"] = totalAccuracy / count
    
    return stats
}

func calculateProfoundResonance(resonance ProfoundResonance) float64 {
    // Calculate overall resonance (计算总体共振) - Tính toán cộng hưởng tổng thể
    totalResonance := 0.0
    count := 0
    
    for _, value := range resonance.ResonanceEffects {
        totalResonance += value
        count++
    }
    
    if count > 0 {
        return totalResonance / float64(count)
    }
    return 0.0
}

func calculateProfoundOverwhelm(resonance ProfoundResonance) float64 {
    // Calculate overall overwhelm (计算总体压倒) - Tính toán áp đảo tổng thể
    totalOverwhelm := 0.0
    count := 0
    
    for _, value := range resonance.OverwhelmEffects {
        totalOverwhelm += value
        count++
    }
    
    if count > 0 {
        return totalOverwhelm / float64(count)
    }
    return 0.0
}

func calculateProfoundEssence(understanding ProfoundUnderstanding) float64 {
    // Calculate profound essence (计算奥义本质) - Tính toán bản chất Áo Nghĩa
    return understanding.MeaningEssence
}

func calculateProfoundAbilityStats(abilities []ProfoundAbility) map[string]float64 {
    stats := make(map[string]float64)
    
    if len(abilities) == 0 {
        return stats
    }
    
    // Calculate average ability stats (计算平均奥义能力属性) - Tính toán stats khả năng trung bình
    totalPower := 0.0
    totalCost := 0.0
    totalCooldown := 0.0
    totalRange := 0.0
    totalAccuracy := 0.0
    
    for _, ability := range abilities {
        totalPower += ability.AbilityPower
        totalCost += ability.AbilityCost
        totalCooldown += ability.AbilityCooldown
        totalRange += ability.AbilityRange
        totalAccuracy += ability.AbilityAccuracy
    }
    
    count := float64(len(abilities))
    stats["profound_ability_power"] = totalPower / count
    stats["profound_ability_cost"] = totalCost / count
    stats["profound_ability_cooldown"] = totalCooldown / count
    stats["profound_ability_range"] = totalRange / count
    stats["profound_ability_accuracy"] = totalAccuracy / count
    
    return stats
}

// Dao and Profound Meaning Management Functions (道和奥义管理函数) - Các hàm quản lý Đạo và Áo Nghĩa

// Initialize Dao System (初始化道系统) - Khởi tạo hệ thống Đạo
func InitializeDaoSystem() DaoSystem {
    return DaoSystem{
        DaoPaths: make(map[string]DaoPath),
        PrimaryDaoType: "",
        DaoComprehension: DaoComprehension{},
        DaoTechniques: make(map[string][]DaoTechnique),
        DaoCompatibility: DaoCompatibility{
            CompatibilityMatrix: make(map[string]map[string]float64),
            ResonanceEffects: make(map[string]float64),
            SuppressionEffects: make(map[string]float64),
        },
    }
}

// Initialize Profound Meaning System (初始化奥义系统) - Khởi tạo hệ thống Áo Nghĩa
func InitializeProfoundMeaningSystem() ProfoundMeaningSystem {
    return ProfoundMeaningSystem{
        ProfoundMeanings: make(map[string]ProfoundMeaning),
        PrimaryProfoundMeaningType: "",
        ProfoundUnderstanding: ProfoundUnderstanding{},
        ProfoundAbilities: make(map[string][]ProfoundAbility),
        ProfoundResonance: ProfoundResonance{
            ResonanceMatrix: make(map[string]map[string]float64),
            ResonanceEffects: make(map[string]float64),
            OverwhelmEffects: make(map[string]float64),
        },
    }
}

// Add Dao Path (添加道径) - Thêm con đường Đạo
func (ds *DaoSystem) AddDaoPath(daoType string, daoPath DaoPath) {
    daoPath.DaoType = daoType
    daoPath.IsActive = true
    daoPath.UnlockedAt = time.Now().Unix()
    
    ds.DaoPaths[daoType] = daoPath
    
    // Set as primary if it's the first one (如果是第一个则设为主道) - Nếu là cái đầu tiên thì đặt làm chính
    if ds.PrimaryDaoType == "" {
        ds.PrimaryDaoType = daoType
        daoPath.IsPrimary = true
        ds.DaoPaths[daoType] = daoPath
    }
}

// Remove Dao Path (移除道径) - Xóa con đường Đạo
func (ds *DaoSystem) RemoveDaoPath(daoType string) {
    delete(ds.DaoPaths, daoType)
    
    // If removing primary Dao, set a new primary (如果移除主道则设置新的主道) - Nếu xóa Đạo chính thì đặt Đạo chính mới
    if ds.PrimaryDaoType == daoType {
        ds.PrimaryDaoType = ""
        for daoType, dao := range ds.DaoPaths {
            if dao.IsActive {
                ds.PrimaryDaoType = daoType
                dao.IsPrimary = true
                ds.DaoPaths[daoType] = dao
                break
            }
        }
    }
}

// Set Primary Dao (设置主道) - Đặt Đạo chính
func (ds *DaoSystem) SetPrimaryDao(daoType string) bool {
    if dao, exists := ds.DaoPaths[daoType]; exists && dao.IsActive {
        // Remove primary flag from current primary (移除当前主道的主道标志) - Xóa cờ chính khỏi Đạo chính hiện tại
        if ds.PrimaryDaoType != "" {
            currentPrimary := ds.DaoPaths[ds.PrimaryDaoType]
            currentPrimary.IsPrimary = false
            ds.DaoPaths[ds.PrimaryDaoType] = currentPrimary
        }
        
        // Set new primary (设置新主道) - Đặt Đạo chính mới
        ds.PrimaryDaoType = daoType
        dao.IsPrimary = true
        ds.DaoPaths[daoType] = dao
        return true
    }
    return false
}

// Toggle Dao Active Status (切换道激活状态) - Chuyển đổi trạng thái hoạt động của Đạo
func (ds *DaoSystem) ToggleDaoActive(daoType string) bool {
    if dao, exists := ds.DaoPaths[daoType]; exists {
        dao.IsActive = !dao.IsActive
        ds.DaoPaths[daoType] = dao
        
        // If deactivating primary Dao, set a new primary (如果停用主道则设置新的主道) - Nếu tắt Đạo chính thì đặt Đạo chính mới
        if !dao.IsActive && ds.PrimaryDaoType == daoType {
            ds.PrimaryDaoType = ""
            for daoType, dao := range ds.DaoPaths {
                if dao.IsActive {
                    ds.PrimaryDaoType = daoType
                    dao.IsPrimary = true
                    ds.DaoPaths[daoType] = dao
                    break
                }
            }
        }
        return true
    }
    return false
}

// Add Profound Meaning (添加奥义) - Thêm Áo Nghĩa
func (pms *ProfoundMeaningSystem) AddProfoundMeaning(meaningType string, profoundMeaning ProfoundMeaning) {
    profoundMeaning.MeaningType = meaningType
    profoundMeaning.IsActive = true
    profoundMeaning.UnlockedAt = time.Now().Unix()
    
    pms.ProfoundMeanings[meaningType] = profoundMeaning
    
    // Set as primary if it's the first one (如果是第一个则设为主奥义) - Nếu là cái đầu tiên thì đặt làm chính
    if pms.PrimaryProfoundMeaningType == "" {
        pms.PrimaryProfoundMeaningType = meaningType
        profoundMeaning.IsPrimary = true
        pms.ProfoundMeanings[meaningType] = profoundMeaning
    }
}

// Remove Profound Meaning (移除奥义) - Xóa Áo Nghĩa
func (pms *ProfoundMeaningSystem) RemoveProfoundMeaning(meaningType string) {
    delete(pms.ProfoundMeanings, meaningType)
    
    // If removing primary Profound Meaning, set a new primary (如果移除主奥义则设置新的主奥义) - Nếu xóa Áo Nghĩa chính thì đặt Áo Nghĩa chính mới
    if pms.PrimaryProfoundMeaningType == meaningType {
        pms.PrimaryProfoundMeaningType = ""
        for meaningType, profound := range pms.ProfoundMeanings {
            if profound.IsActive {
                pms.PrimaryProfoundMeaningType = meaningType
                profound.IsPrimary = true
                pms.ProfoundMeanings[meaningType] = profound
                break
            }
        }
    }
}

// Set Primary Profound Meaning (设置主奥义) - Đặt Áo Nghĩa chính
func (pms *ProfoundMeaningSystem) SetPrimaryProfoundMeaning(meaningType string) bool {
    if profound, exists := pms.ProfoundMeanings[meaningType]; exists && profound.IsActive {
        // Remove primary flag from current primary (移除当前主奥义的主奥义标志) - Xóa cờ chính khỏi Áo Nghĩa chính hiện tại
        if pms.PrimaryProfoundMeaningType != "" {
            currentPrimary := pms.ProfoundMeanings[pms.PrimaryProfoundMeaningType]
            currentPrimary.IsPrimary = false
            pms.ProfoundMeanings[pms.PrimaryProfoundMeaningType] = currentPrimary
        }
        
        // Set new primary (设置新主奥义) - Đặt Áo Nghĩa chính mới
        pms.PrimaryProfoundMeaningType = meaningType
        profound.IsPrimary = true
        pms.ProfoundMeanings[meaningType] = profound
        return true
    }
    return false
}

// Toggle Profound Meaning Active Status (切换奥义激活状态) - Chuyển đổi trạng thái hoạt động của Áo Nghĩa
func (pms *ProfoundMeaningSystem) ToggleProfoundMeaningActive(meaningType string) bool {
    if profound, exists := pms.ProfoundMeanings[meaningType]; exists {
        profound.IsActive = !profound.IsActive
        pms.ProfoundMeanings[meaningType] = profound
        
        // If deactivating primary Profound Meaning, set a new primary (如果停用主奥义则设置新的主奥义) - Nếu tắt Áo Nghĩa chính thì đặt Áo Nghĩa chính mới
        if !profound.IsActive && pms.PrimaryProfoundMeaningType == meaningType {
            pms.PrimaryProfoundMeaningType = ""
            for meaningType, profound := range pms.ProfoundMeanings {
                if profound.IsActive {
                    pms.PrimaryProfoundMeaningType = meaningType
                    profound.IsPrimary = true
                    pms.ProfoundMeanings[meaningType] = profound
                    break
                }
            }
        }
        return true
    }
    return false
}

// Get Active Daos (获取激活的道) - Lấy các Đạo đang hoạt động
func (ds *DaoSystem) GetActiveDaos() []DaoPath {
    var activeDaos []DaoPath
    for _, dao := range ds.DaoPaths {
        if dao.IsActive {
            activeDaos = append(activeDaos, dao)
        }
    }
    return activeDaos
}

// Get Active Profound Meanings (获取激活的奥义) - Lấy các Áo Nghĩa đang hoạt động
func (pms *ProfoundMeaningSystem) GetActiveProfoundMeanings() []ProfoundMeaning {
    var activeProfoundMeanings []ProfoundMeaning
    for _, profound := range pms.ProfoundMeanings {
        if profound.IsActive {
            activeProfoundMeanings = append(activeProfoundMeanings, profound)
        }
    }
    return activeProfoundMeanings
}

// Get Dao by Type (根据类型获取道) - Lấy Đạo theo loại
func (ds *DaoSystem) GetDaoByType(daoType string) (DaoPath, bool) {
    dao, exists := ds.DaoPaths[daoType]
    return dao, exists
}

// Get Profound Meaning by Type (根据类型获取奥义) - Lấy Áo Nghĩa theo loại
func (pms *ProfoundMeaningSystem) GetProfoundMeaningByType(meaningType string) (ProfoundMeaning, bool) {
    profound, exists := pms.ProfoundMeanings[meaningType]
    return profound, exists
}
```

#### **F. Ví Dụ Sử Dụng (Usage Examples):**

```go
// Example: Creating a multi-Dao cultivator (示例：创建多道修炼者) - Ví dụ: Tạo một tu luyện giả đa Đạo
func ExampleMultiDaoCultivator() {
    // Initialize systems (初始化系统) - Khởi tạo hệ thống
    daoSystem := InitializeDaoSystem()
    profoundSystem := InitializeProfoundMeaningSystem()
    
    // Add Sword Dao as primary (添加剑道作为主道) - Thêm Kiếm Đạo làm chính
    swordDao := DaoPath{
        DaoLevel: 5,
        DaoExperience: 1000.0,
        DaoMastery: 0.8,
        DaoInsight: 0.7,
        DaoWisdom: 0.6,
        DaoHarmony: 0.5,
        DaoTranscendence: 0.3,
    }
    daoSystem.AddDaoPath(DaoTypeSword, swordDao)
    
    // Add Blade Dao as secondary (添加刀道作为副道) - Thêm Đao Đạo làm phụ
    bladeDao := DaoPath{
        DaoLevel: 3,
        DaoExperience: 500.0,
        DaoMastery: 0.6,
        DaoInsight: 0.5,
        DaoWisdom: 0.4,
        DaoHarmony: 0.3,
        DaoTranscendence: 0.1,
    }
    daoSystem.AddDaoPath(DaoTypeBlade, bladeDao)
    
    // Add Spell Dao as secondary (添加法道作为副道) - Thêm Pháp Đạo làm phụ
    spellDao := DaoPath{
        DaoLevel: 2,
        DaoExperience: 200.0,
        DaoMastery: 0.4,
        DaoInsight: 0.6,
        DaoWisdom: 0.7,
        DaoHarmony: 0.2,
        DaoTranscendence: 0.1,
    }
    daoSystem.AddDaoPath(DaoTypeSpell, spellDao)
    
    // Add Sword Intent as primary Profound Meaning (添加剑意作为主奥义) - Thêm Kiếm Ý làm Áo Nghĩa chính
    swordIntent := ProfoundMeaning{
        MeaningLevel: 4,
        MeaningExperience: 800.0,
        MeaningMastery: 0.7,
        MeaningInsight: 0.6,
        MeaningWisdom: 0.5,
        MeaningHarmony: 0.4,
        MeaningTranscendence: 0.2,
    }
    profoundSystem.AddProfoundMeaning(ProfoundMeaningTypeSwordIntent, swordIntent)
    
    // Add Blade Intent as secondary (添加刀意作为副奥义) - Thêm Đao Ý làm phụ
    bladeIntent := ProfoundMeaning{
        MeaningLevel: 2,
        MeaningExperience: 300.0,
        MeaningMastery: 0.5,
        MeaningInsight: 0.4,
        MeaningWisdom: 0.3,
        MeaningHarmony: 0.2,
        MeaningTranscendence: 0.1,
    }
    profoundSystem.AddProfoundMeaning(ProfoundMeaningTypeBladeIntent, bladeIntent)
    
    // Calculate stats (计算属性) - Tính toán stats
    daoStats := CalculateDaoStats(daoSystem)
    profoundStats := CalculateProfoundMeaningStats(profoundSystem)
    combatStats := CalculateTurnBasedCombatStats(daoSystem, profoundSystem)
    
    // Print results (打印结果) - In kết quả
    fmt.Printf("Primary Dao: %s (Level %d)\n", daoSystem.PrimaryDaoType, int(daoStats["dao_level"]))
    fmt.Printf("Active Daos: %d\n", int(daoStats["active_dao_count"]))
    fmt.Printf("Total Dao Level: %.1f\n", daoStats["total_dao_level"])
    fmt.Printf("Average Dao Level: %.1f\n", daoStats["average_dao_level"])
    
    fmt.Printf("Primary Profound Meaning: %s (Level %d)\n", profoundSystem.PrimaryProfoundMeaningType, int(profoundStats["profound_meaning_level"]))
    fmt.Printf("Active Profound Meanings: %d\n", int(profoundStats["active_profound_meaning_count"]))
    fmt.Printf("Total Profound Meaning Level: %.1f\n", profoundStats["total_profound_meaning_level"])
    
    fmt.Printf("Action Points: %.1f\n", combatStats["action_points"])
    fmt.Printf("Combat Effectiveness: %.1f\n", combatStats["combat_effectiveness"])
    fmt.Printf("Technique Power: %.1f\n", combatStats["technique_power"])
    fmt.Printf("Counter Attack Chance: %.2f\n", combatStats["counter_attack_chance"])
}

// Example: Switching primary Dao (示例：切换主道) - Ví dụ: Chuyển đổi Đạo chính
func ExampleSwitchPrimaryDao() {
    daoSystem := InitializeDaoSystem()
    
    // Add multiple Daos (添加多个道) - Thêm nhiều Đạo
    daoSystem.AddDaoPath(DaoTypeSword, DaoPath{DaoLevel: 5, DaoMastery: 0.8})
    daoSystem.AddDaoPath(DaoTypeBlade, DaoPath{DaoLevel: 3, DaoMastery: 0.6})
    daoSystem.AddDaoPath(DaoTypeSpell, DaoPath{DaoLevel: 7, DaoMastery: 0.9})
    
    // Initially Sword Dao is primary (最初剑道是主道) - Ban đầu Kiếm Đạo là chính
    fmt.Printf("Primary Dao: %s\n", daoSystem.PrimaryDaoType) // "sword_dao"
    
    // Switch to Spell Dao as primary (切换到法道作为主道) - Chuyển sang Pháp Đạo làm chính
    success := daoSystem.SetPrimaryDao(DaoTypeSpell)
    if success {
        fmt.Printf("Primary Dao changed to: %s\n", daoSystem.PrimaryDaoType) // "spell_dao"
    }
}

// Example: Toggle Dao active status (示例：切换道激活状态) - Ví dụ: Chuyển đổi trạng thái hoạt động của Đạo
func ExampleToggleDaoActive() {
    daoSystem := InitializeDaoSystem()
    
    // Add multiple Daos (添加多个道) - Thêm nhiều Đạo
    daoSystem.AddDaoPath(DaoTypeSword, DaoPath{DaoLevel: 5})
    daoSystem.AddDaoPath(DaoTypeBlade, DaoPath{DaoLevel: 3})
    daoSystem.AddDaoPath(DaoTypeSpell, DaoPath{DaoLevel: 7})
    
    // Deactivate Blade Dao (停用刀道) - Tắt Đao Đạo
    daoSystem.ToggleDaoActive(DaoTypeBlade)
    
    // Get active Daos (获取激活的道) - Lấy các Đạo đang hoạt động
    activeDaos := daoSystem.GetActiveDaos()
    fmt.Printf("Active Daos: %d\n", len(activeDaos)) // 2 (Sword and Spell)
    
    // Reactivate Blade Dao (重新激活刀道) - Bật lại Đao Đạo
    daoSystem.ToggleDaoActive(DaoTypeBlade)
    activeDaos = daoSystem.GetActiveDaos()
    fmt.Printf("Active Daos after reactivation: %d\n", len(activeDaos)) // 3 (All)
}

// Example: Adding new Dao types dynamically (示例：动态添加新道类型) - Ví dụ: Thêm loại Đạo mới động
func ExampleAddNewDaoType() {
    daoSystem := InitializeDaoSystem()
    
    // Add existing Daos (添加现有道) - Thêm các Đạo hiện có
    daoSystem.AddDaoPath(DaoTypeSword, DaoPath{DaoLevel: 5})
    daoSystem.AddDaoPath(DaoTypeBlade, DaoPath{DaoLevel: 3})
    
    // Add new custom Dao type (添加新的自定义道类型) - Thêm loại Đạo tùy chỉnh mới
    customDaoType := "lightning_dao" // Lightning Dao (雷道) - Lôi Đạo
    lightningDao := DaoPath{
        DaoLevel: 4,
        DaoExperience: 600.0,
        DaoMastery: 0.7,
        DaoInsight: 0.8,
        DaoWisdom: 0.5,
        DaoHarmony: 0.6,
        DaoTranscendence: 0.3,
    }
    daoSystem.AddDaoPath(customDaoType, lightningDao)
    
    // The system automatically handles the new type (系统自动处理新类型) - Hệ thống tự động xử lý loại mới
    fmt.Printf("Total Daos: %d\n", len(daoSystem.DaoPaths)) // 3
    fmt.Printf("Custom Dao Level: %d\n", daoSystem.DaoPaths[customDaoType].DaoLevel) // 4
}
```

#### **E. Tích Hợp Với Actor Core v3:**

```go
// Convert Dao and Profound Meaning to SubsystemOutput (转换道和奥义到子系统输出) - Chuyển đổi Đạo và Áo Nghĩa thành SubsystemOutput
func ConvertDaoAndProfoundToSubsystemOutput(daoSystem DaoSystem, profoundSystem ProfoundMeaningSystem) SubsystemOutput {
    // Calculate primary stats (计算主要属性) - Tính toán primary stats
    daoStats := CalculateDaoStats(daoSystem)
    profoundStats := CalculateProfoundMeaningStats(profoundSystem)
    combatStats := CalculateTurnBasedCombatStats(daoSystem, profoundSystem)
    
    // Combine all primary stats (合并所有主要属性) - Kết hợp tất cả primary stats
    primaryStats := make(map[string]float64)
    for key, value := range daoStats {
        primaryStats[key] = value
    }
    for key, value := range profoundStats {
        primaryStats[key] = value
    }
    for key, value := range combatStats {
        primaryStats[key] = value
    }
    
    // Calculate derived stats (计算派生属性) - Tính toán derived stats
    derivedStats := make(map[string]float64)
    
    // Combat effectiveness derived stats (战斗效果派生属性) - Derived stats hiệu quả chiến đấu
    derivedStats["total_combat_power"] = primaryStats["combat_effectiveness"] * primaryStats["technique_power"]
    derivedStats["total_ability_power"] = primaryStats["combat_effectiveness"] * primaryStats["ability_power"]
    derivedStats["total_defensive_power"] = primaryStats["defensive_effectiveness"] * primaryStats["dao_harmony"]
    
    // Action economy derived stats (行动经济派生属性) - Derived stats kinh tế hành động
    derivedStats["action_efficiency"] = primaryStats["action_points"] * primaryStats["dao_mastery"]
    derivedStats["technique_efficiency"] = primaryStats["dao_technique_power"] / primaryStats["dao_technique_cost"]
    derivedStats["ability_efficiency"] = primaryStats["profound_ability_power"] / primaryStats["profound_ability_cost"]
    
    // Create contributions (创建贡献) - Tạo contributions
    var contributions []Contribution
    
    // Primary stats contributions (主要属性贡献) - Contributions primary stats
    for stat, value := range primaryStats {
        contributions = append(contributions, Contribution{
            Dimension: stat,
            Bucket:    "Primary",
            Value:     value,
            System:    "DaoProfoundSystem",
            Priority:  1,
        })
    }
    
    // Derived stats contributions (派生属性贡献) - Contributions derived stats
    for stat, value := range derivedStats {
        contributions = append(contributions, Contribution{
            Dimension: stat,
            Bucket:    "Derived",
            Value:     value,
            System:    "DaoProfoundSystem",
            Priority:  2,
        })
    }
    
    // Caps contributions (上限贡献) - Contributions caps
    caps := make(map[string]float64)
    caps["max_dao_level"] = 15.0 // Maximum Dao level (最大道等级) - Cấp độ Đạo tối đa
    caps["max_profound_meaning_level"] = 10.0 // Maximum Profound Meaning level (最大奥义等级) - Cấp độ Áo Nghĩa tối đa
    caps["max_action_points"] = 10.0 // Maximum action points (最大行动点) - Điểm hành động tối đa
    
    for stat, value := range caps {
        contributions = append(contributions, Contribution{
            Dimension: stat,
            Bucket:    "Caps",
            Value:     value,
            System:    "DaoProfoundSystem",
            Priority:  3,
        })
    }
    
    return SubsystemOutput{
        Primary:   primaryStats,
        Derived:   derivedStats,
        Caps:      caps,
        Context:   map[string]interface{}{"dao_system": daoSystem, "profound_system": profoundSystem},
        Contributions: contributions,
    }
}
```

### **1. Đan Điền (Dantian) - Khí Quan Chứa Khí**
Đan điền là trung tâm lưu trữ và chuyển hóa khí, ảnh hưởng đến các primary stats liên quan đến **Khí**:

#### **Primary Stats từ Đan Điền:**
```go
// Dantian-related primary stats (丹田相关主要属性) - Các primary stats từ đan điền
var DantianPrimaryStats = []string{
    "dantian_capacity",        // Dantian capacity (丹田容量) - Dung lượng đan điền
    "dantian_compression",     // Dantian compression (丹田压缩) - Suất nén khí trong đan điền
    "dantian_stability",       // Dantian stability (丹田稳定性) - Độ ổn định đan điền
    "dantian_purity",          // Dantian purity (丹田纯度) - Độ tinh khiết đan điền
    "qi_purity",              // Qi purity (气纯度) - Độ tinh khiết khí
    "eff_jing_to_qi",         // Jing to Qi efficiency (精转气效率) - Hiệu suất chuyển Tinh → Khí
    "eff_qi_to_shen",         // Qi to Shen efficiency (气转神效率) - Hiệu suất chuyển Khí → Thần
    "cultivation_exp",         // Main cultivation experience (主要修炼经验) - Tu vi chính
    "aux_cultivation_exp",     // Auxiliary cultivation experience (辅助修炼经验) - Tu vi phụ
    "total_cultivation_exp",   // Total cultivation experience (总修炼经验) - Tu vi tổng hợp
}
```

#### **Công Thức Tính Toán Đan Điền:**
```go
// Calculate dantian-related stats (计算丹田相关属性) - Tính toán các stats liên quan đến đan điền
func CalculateDantianStats(dantian DantianInfo) map[string]float64 {
    stats := make(map[string]float64)
    
    // Dantian capacity (丹田容量) - Dung lượng đan điền
    stats["dantian_capacity"] = dantian.Storage.DantianCapacity
    
    // Dantian compression (丹田压缩) - Suất nén khí = Tu vi / Dung lượng
    stats["dantian_compression"] = dantian.Core.TotalCultivationExp / dantian.Storage.DantianCapacity
    
    // Dantian stability (丹田稳定性) - Độ ổn định đan điền
    stats["dantian_stability"] = dantian.Quality.DantianStability
    
    // Dantian purity (丹田纯度) - Độ tinh khiết đan điền
    stats["dantian_purity"] = dantian.Quality.DantianPurity
    
    // Qi purity (气纯度) - Độ tinh khiết khí = Độ tinh khiết đan điền * 0.8 + Độ ổn định * 0.2
    stats["qi_purity"] = dantian.Quality.DantianPurity*0.8 + dantian.Quality.DantianStability*0.2
    
    // Jing to Qi efficiency (精转气效率) - Hiệu suất chuyển Tinh → Khí = Độ tinh khiết * 0.6 + Độ ổn định * 0.4
    stats["eff_jing_to_qi"] = dantian.Quality.DantianPurity*0.6 + dantian.Quality.DantianStability*0.4
    
    // Qi to Shen efficiency (气转神效率) - Hiệu suất chuyển Khí → Thần = Độ tinh khiết * 0.4 + Độ ổn định * 0.6
    stats["eff_qi_to_shen"] = dantian.Quality.DantianPurity*0.4 + dantian.Quality.DantianStability*0.6
    
    // Cultivation experience (修炼经验) - Tu vi
    stats["cultivation_exp"] = dantian.Core.CultivationExp
    stats["aux_cultivation_exp"] = dantian.Core.AuxCultivationExp
    stats["total_cultivation_exp"] = dantian.Core.TotalCultivationExp
    
    return stats
}
```

### **2. Kinh Mạch (Meridians) - Hệ Thống Vận Chuyển Khí**
Kinh mạch là hệ thống vận chuyển khí trong cơ thể, ảnh hưởng đến các primary stats liên quan đến **vận chuyển và lưu thông khí**:

#### **Primary Stats từ Kinh Mạch:**
```go
// Meridian-related primary stats (经脉相关主要属性) - Các primary stats từ kinh mạch
var MeridianPrimaryStats = []string{
    "meridian_conductivity",      // Meridian conductivity (经脉传导性) - Độ dẫn khí trong kinh mạch
    "meridian_toughness",         // Meridian toughness (经脉韧性) - Sức chịu áp lực khí
    "meridian_purity_resistance", // Meridian purity resistance (经脉净抗性) - Chống tạp chất bám lưu
    "jing_reserve",              // Jing reserve (精储备) - Dự trữ Tinh (nguyên khí)
    "meridian_efficiency",        // Meridian efficiency (经脉效率) - Hiệu suất vận chuyển khí
    "meridian_capacity",          // Meridian capacity (经脉容量) - Dung lượng kinh mạch
}
```

#### **Cấu Trúc Kinh Mạch Chi Tiết:**

```go
// Meridian System (经脉系统) - Hệ thống kinh mạch
type MeridianSystem struct {
    // Meridian quality (经脉质量) - Chất lượng kinh mạch
    MeridianQuality MeridianQuality `json:"meridian_quality"`
    
    // Meridian capacity (经脉容量) - Dung lượng kinh mạch
    MeridianCapacity MeridianCapacity `json:"meridian_capacity"`
    
    // Jing reserve (精储备) - Dự trữ Tinh
    JingReserve JingReserve `json:"jing_reserve"`
    
    // Meridian channels (经脉通道) - Các kênh kinh mạch
    MeridianChannels MeridianChannels `json:"meridian_channels"`
    
    // Meridian cultivation (经脉修炼) - Tu luyện kinh mạch
    MeridianCultivation MeridianCultivation `json:"meridian_cultivation"`
}

// Meridian Quality (经脉质量) - Chất lượng kinh mạch
type MeridianQuality struct {
    Conductivity      float64 `json:"conductivity"`       // 0.0 - 1.0 (传导性) - Độ dẫn khí
    Toughness         float64 `json:"toughness"`          // 0.0 - 1.0 (韧性) - Sức chịu áp lực
    PurityResistance  float64 `json:"purity_resistance"`  // 0.0 - 1.0 (净抗性) - Chống tạp chất
    Flexibility       float64 `json:"flexibility"`        // 0.0 - 1.0 (柔韧性) - Độ linh hoạt
    Resilience        float64 `json:"resilience"`         // 0.0 - 1.0 (恢复力) - Khả năng phục hồi
    OverallQuality    float64 `json:"overall_quality"`    // Average of above (整体质量) - Chất lượng tổng hợp
}

// Meridian Capacity (经脉容量) - Dung lượng kinh mạch
type MeridianCapacity struct {
    MaxFlowRate       float64 `json:"max_flow_rate"`      // Maximum qi flow rate (最大气流速率) - Tốc độ dòng khí tối đa
    MaxPressure       float64 `json:"max_pressure"`       // Maximum pressure tolerance (最大压力耐受) - Áp lực tối đa
    TotalCapacity     float64 `json:"total_capacity"`     // Total meridian capacity (总经脉容量) - Tổng dung lượng
    CurrentFlow       float64 `json:"current_flow"`       // Current qi flow (当前气流) - Dòng khí hiện tại
    FlowEfficiency    float64 `json:"flow_efficiency"`    // Flow efficiency (流动效率) - Hiệu suất dòng chảy
    PressureTolerance float64 `json:"pressure_tolerance"` // Pressure tolerance (压力耐受) - Khả năng chịu áp lực
}

// Jing Reserve (精储备) - Dự trữ Tinh
type JingReserve struct {
    InnateJing        float64 `json:"innate_jing"`        // Innate jing (先天精) - Tinh tiên thiên
    AcquiredJing      float64 `json:"acquired_jing"`      // Acquired jing (后天精) - Tinh hậu thiên
    TotalJing         float64 `json:"total_jing"`         // Total jing (总精) - Tổng tinh
    JingRegeneration  float64 `json:"jing_regeneration"`  // Jing regeneration rate (精恢复速率) - Tốc độ hồi tinh
    JingConsumption   float64 `json:"jing_consumption"`   // Jing consumption rate (精消耗速率) - Tốc độ tiêu hao tinh
    JingEfficiency    float64 `json:"jing_efficiency"`    // Jing efficiency (精效率) - Hiệu suất sử dụng tinh
}

// Meridian Channels (经脉通道) - Các kênh kinh mạch
type MeridianChannels struct {
    // Main channels (主脉) - Kênh chính
    MainChannels MainChannels `json:"main_channels"`
    
    // Secondary channels (支脉) - Kênh phụ
    SecondaryChannels SecondaryChannels `json:"secondary_channels"`
    
    // Micro channels (微脉) - Kênh vi mô
    MicroChannels MicroChannels `json:"micro_channels"`
}

// Main Channels (主脉) - Kênh chính (12 kinh mạch chính)
type MainChannels struct {
    // Hand channels (手经) - Kênh tay
    HandTaiyinLung    MeridianChannel `json:"hand_taiyin_lung"`     // 手太阴肺经 - Kênh phổi
    HandYangmingLargeIntestine MeridianChannel `json:"hand_yangming_large_intestine"` // 手阳明大肠经 - Kênh ruột già
    HandShaoyinHeart  MeridianChannel `json:"hand_shaoyin_heart"`   // 手少阴心经 - Kênh tim
    HandTaiyangSmallIntestine MeridianChannel `json:"hand_taiyang_small_intestine"` // 手太阳小肠经 - Kênh ruột non
    HandJueyinPericardium MeridianChannel `json:"hand_jueyin_pericardium"` // 手厥阴心包经 - Kênh màng ngoài tim
    HandShaoyangTripleBurner MeridianChannel `json:"hand_shaoyang_triple_burner"` // 手少阳三焦经 - Kênh tam tiêu
    
    // Foot channels (足经) - Kênh chân
    FootTaiyinSpleen  MeridianChannel `json:"foot_taiyin_spleen"`   // 足太阴脾经 - Kênh tỳ
    FootYangmingStomach MeridianChannel `json:"foot_yangming_stomach"` // 足阳明胃经 - Kênh dạ dày
    FootShaoyinKidney MeridianChannel `json:"foot_shaoyin_kidney"`  // 足少阴肾经 - Kênh thận
    FootTaiyangBladder MeridianChannel `json:"foot_taiyang_bladder"` // 足太阳膀胱经 - Kênh bàng quang
    FootJueyinLiver   MeridianChannel `json:"foot_jueyin_liver"`    // 足厥阴肝经 - Kênh gan
    FootShaoyangGallbladder MeridianChannel `json:"foot_shaoyang_gallbladder"` // 足少阳胆经 - Kênh mật
}

// Secondary Channels (支脉) - Kênh phụ
type SecondaryChannels struct {
    CollateralChannels []MeridianChannel `json:"collateral_channels"` // 络脉 - Kênh lạc
    DivergentChannels  []MeridianChannel `json:"divergent_channels"`  // 别络 - Kênh biệt lạc
    MuscleChannels     []MeridianChannel `json:"muscle_channels"`     // 经筋 - Kênh cân
    SkinChannels       []MeridianChannel `json:"skin_channels"`       // 皮部 - Kênh bì
}

// Micro Channels (微脉) - Kênh vi mô
type MicroChannels struct {
    CapillaryChannels  []MeridianChannel `json:"capillary_channels"`  // 毛细血管 - Kênh mao mạch
    NerveChannels      []MeridianChannel `json:"nerve_channels"`      // 神经通道 - Kênh thần kinh
    EnergyChannels     []MeridianChannel `json:"energy_channels"`     // 能量通道 - Kênh năng lượng
}

// Individual Meridian Channel (单个经脉通道) - Kênh kinh mạch đơn lẻ
type MeridianChannel struct {
    ChannelName        string  `json:"channel_name"`        // Channel name (通道名称) - Tên kênh
    ChannelType        string  `json:"channel_type"`        // Channel type (通道类型) - Loại kênh
    ChannelLevel       int64   `json:"channel_level"`       // Channel level (通道等级) - Cấp độ kênh
    ChannelCapacity    float64 `json:"channel_capacity"`    // Channel capacity (通道容量) - Dung lượng kênh
    ChannelConductivity float64 `json:"channel_conductivity"` // Channel conductivity (通道传导性) - Độ dẫn kênh
    ChannelToughness   float64 `json:"channel_toughness"`   // Channel toughness (通道韧性) - Độ bền kênh
    ChannelPurity      float64 `json:"channel_purity"`      // Channel purity (通道纯度) - Độ tinh khiết kênh
    ChannelFlow        float64 `json:"channel_flow"`        // Current flow (当前流量) - Dòng chảy hiện tại
    ChannelPressure    float64 `json:"channel_pressure"`    // Current pressure (当前压力) - Áp lực hiện tại
    ChannelHealth      float64 `json:"channel_health"`      // Channel health (通道健康度) - Sức khỏe kênh
}

// Meridian Cultivation (经脉修炼) - Tu luyện kinh mạch
type MeridianCultivation struct {
    CultivationLevel   int64   `json:"cultivation_level"`   // Cultivation level (修炼等级) - Cấp độ tu luyện
    CultivationExp     float64 `json:"cultivation_exp"`     // Cultivation experience (修炼经验) - Kinh nghiệm tu luyện
    CultivationSpeed   float64 `json:"cultivation_speed"`   // Cultivation speed (修炼速度) - Tốc độ tu luyện
    CultivationEfficiency float64 `json:"cultivation_efficiency"` // Cultivation efficiency (修炼效率) - Hiệu suất tu luyện
    BreakthroughChance float64 `json:"breakthrough_chance"` // Breakthrough chance (突破几率) - Tỷ lệ đột phá
    MeridianStability  float64 `json:"meridian_stability"`  // Meridian stability (经脉稳定性) - Độ ổn định kinh mạch
}
```

#### **Primary Stats Ảnh Hưởng Bởi Kinh Mạch:**

```go
// Meridian-related primary stats (经脉相关主要属性) - Các primary stats từ kinh mạch
var MeridianPrimaryStats = []string{
    // Core meridian stats (核心经脉属性) - Stats cốt lõi kinh mạch
    "meridian_conductivity",      // Meridian conductivity (经脉传导性) - Độ dẫn khí trong kinh mạch
    "meridian_toughness",         // Meridian toughness (经脉韧性) - Sức chịu áp lực khí
    "meridian_purity_resistance", // Meridian purity resistance (经脉净抗性) - Chống tạp chất bám lưu
    "meridian_flexibility",       // Meridian flexibility (经脉柔韧性) - Độ linh hoạt kinh mạch
    "meridian_resilience",        // Meridian resilience (经脉恢复力) - Khả năng phục hồi kinh mạch
    
    // Capacity and flow stats (容量和流动属性) - Stats dung lượng và dòng chảy
    "meridian_capacity",          // Meridian capacity (经脉容量) - Dung lượng kinh mạch
    "meridian_flow_rate",         // Meridian flow rate (经脉流速) - Tốc độ dòng chảy
    "meridian_pressure",          // Meridian pressure (经脉压力) - Áp lực kinh mạch
    "meridian_efficiency",        // Meridian efficiency (经脉效率) - Hiệu suất vận chuyển khí
    "meridian_flow_efficiency",   // Meridian flow efficiency (经脉流动效率) - Hiệu suất dòng chảy
    
    // Jing-related stats (精相关属性) - Stats liên quan đến Tinh
    "jing_reserve",              // Jing reserve (精储备) - Dự trữ Tinh (nguyên khí)
    "jing_regeneration",         // Jing regeneration (精恢复) - Tốc độ hồi tinh
    "jing_consumption",          // Jing consumption (精消耗) - Tốc độ tiêu hao tinh
    "jing_efficiency",           // Jing efficiency (精效率) - Hiệu suất sử dụng tinh
    
    // Channel-specific stats (通道特定属性) - Stats đặc thù kênh
    "main_channel_health",       // Main channel health (主脉健康度) - Sức khỏe kênh chính
    "secondary_channel_health",  // Secondary channel health (支脉健康度) - Sức khỏe kênh phụ
    "micro_channel_health",      // Micro channel health (微脉健康度) - Sức khỏe kênh vi mô
    "channel_balance",           // Channel balance (通道平衡) - Cân bằng kênh
    "channel_synchronization",   // Channel synchronization (通道同步) - Đồng bộ kênh
    
    // Cultivation-related stats (修炼相关属性) - Stats liên quan đến tu luyện
    "meridian_cultivation_level", // Meridian cultivation level (经脉修炼等级) - Cấp độ tu luyện kinh mạch
    "meridian_cultivation_exp",   // Meridian cultivation exp (经脉修炼经验) - Kinh nghiệm tu luyện kinh mạch
    "meridian_cultivation_speed", // Meridian cultivation speed (经脉修炼速度) - Tốc độ tu luyện kinh mạch
    "meridian_breakthrough_chance", // Meridian breakthrough chance (经脉突破几率) - Tỷ lệ đột phá kinh mạch
    "meridian_stability",         // Meridian stability (经脉稳定性) - Độ ổn định kinh mạch
}
```

#### **Công Thức Tính Toán Kinh Mạch Chi Tiết:**
```go
// Calculate meridian-related stats (计算经脉相关属性) - Tính toán các stats liên quan đến kinh mạch
func CalculateMeridianStats(meridians MeridianSystem) map[string]float64 {
    stats := make(map[string]float64)
    
    // Core meridian stats (核心经脉属性) - Stats cốt lõi kinh mạch
    stats["meridian_conductivity"] = meridians.MeridianQuality.Conductivity
    stats["meridian_toughness"] = meridians.MeridianQuality.Toughness
    stats["meridian_purity_resistance"] = meridians.MeridianQuality.PurityResistance
    stats["meridian_flexibility"] = meridians.MeridianQuality.Flexibility
    stats["meridian_resilience"] = meridians.MeridianQuality.Resilience
    
    // Capacity and flow stats (容量和流动属性) - Stats dung lượng và dòng chảy
    stats["meridian_capacity"] = meridians.MeridianCapacity.TotalCapacity
    stats["meridian_flow_rate"] = meridians.MeridianCapacity.MaxFlowRate
    stats["meridian_pressure"] = meridians.MeridianCapacity.MaxPressure
    stats["meridian_efficiency"] = (meridians.MeridianQuality.Conductivity + meridians.MeridianQuality.Toughness) / 2.0
    stats["meridian_flow_efficiency"] = meridians.MeridianCapacity.FlowEfficiency
    
    // Jing-related stats (精相关属性) - Stats liên quan đến Tinh
    stats["jing_reserve"] = meridians.JingReserve.TotalJing
    stats["jing_regeneration"] = meridians.JingReserve.JingRegeneration
    stats["jing_consumption"] = meridians.JingReserve.JingConsumption
    stats["jing_efficiency"] = meridians.JingReserve.JingEfficiency
    
    // Channel-specific stats (通道特定属性) - Stats đặc thù kênh
    stats["main_channel_health"] = CalculateMainChannelHealth(meridians.MeridianChannels.MainChannels)
    stats["secondary_channel_health"] = CalculateSecondaryChannelHealth(meridians.MeridianChannels.SecondaryChannels)
    stats["micro_channel_health"] = CalculateMicroChannelHealth(meridians.MeridianChannels.MicroChannels)
    stats["channel_balance"] = CalculateChannelBalance(meridians.MeridianChannels)
    stats["channel_synchronization"] = CalculateChannelSynchronization(meridians.MeridianChannels)
    
    // Cultivation-related stats (修炼相关属性) - Stats liên quan đến tu luyện
    stats["meridian_cultivation_level"] = float64(meridians.MeridianCultivation.CultivationLevel)
    stats["meridian_cultivation_exp"] = meridians.MeridianCultivation.CultivationExp
    stats["meridian_cultivation_speed"] = meridians.MeridianCultivation.CultivationSpeed
    stats["meridian_breakthrough_chance"] = meridians.MeridianCultivation.BreakthroughChance
    stats["meridian_stability"] = meridians.MeridianCultivation.MeridianStability
    
    return stats
}

// Calculate main channel health (计算主脉健康度) - Tính sức khỏe kênh chính
func CalculateMainChannelHealth(mainChannels MainChannels) float64 {
    channels := []MeridianChannel{
        mainChannels.HandTaiyinLung,
        mainChannels.HandYangmingLargeIntestine,
        mainChannels.HandShaoyinHeart,
        mainChannels.HandTaiyangSmallIntestine,
        mainChannels.HandJueyinPericardium,
        mainChannels.HandShaoyangTripleBurner,
        mainChannels.FootTaiyinSpleen,
        mainChannels.FootYangmingStomach,
        mainChannels.FootShaoyinKidney,
        mainChannels.FootTaiyangBladder,
        mainChannels.FootJueyinLiver,
        mainChannels.FootShaoyangGallbladder,
    }
    
    totalHealth := 0.0
    for _, channel := range channels {
        totalHealth += channel.ChannelHealth
    }
    
    return totalHealth / float64(len(channels))
}

// Calculate secondary channel health (计算支脉健康度) - Tính sức khỏe kênh phụ
func CalculateSecondaryChannelHealth(secondaryChannels SecondaryChannels) float64 {
    allChannels := append(secondaryChannels.CollateralChannels, secondaryChannels.DivergentChannels...)
    allChannels = append(allChannels, secondaryChannels.MuscleChannels...)
    allChannels = append(allChannels, secondaryChannels.SkinChannels...)
    
    if len(allChannels) == 0 {
        return 0.0
    }
    
    totalHealth := 0.0
    for _, channel := range allChannels {
        totalHealth += channel.ChannelHealth
    }
    
    return totalHealth / float64(len(allChannels))
}

// Calculate micro channel health (计算微脉健康度) - Tính sức khỏe kênh vi mô
func CalculateMicroChannelHealth(microChannels MicroChannels) float64 {
    allChannels := append(microChannels.CapillaryChannels, microChannels.NerveChannels...)
    allChannels = append(allChannels, microChannels.EnergyChannels...)
    
    if len(allChannels) == 0 {
        return 0.0
    }
    
    totalHealth := 0.0
    for _, channel := range allChannels {
        totalHealth += channel.ChannelHealth
    }
    
    return totalHealth / float64(len(allChannels))
}

// Calculate channel balance (计算通道平衡) - Tính cân bằng kênh
func CalculateChannelBalance(channels MeridianChannels) float64 {
    mainHealth := CalculateMainChannelHealth(channels.MainChannels)
    secondaryHealth := CalculateSecondaryChannelHealth(channels.SecondaryChannels)
    microHealth := CalculateMicroChannelHealth(channels.MicroChannels)
    
    // Balance = 1 - (max - min) / max
    maxHealth := mainHealth
    minHealth := mainHealth
    
    if secondaryHealth > maxHealth {
        maxHealth = secondaryHealth
    }
    if microHealth > maxHealth {
        maxHealth = microHealth
    }
    
    if secondaryHealth < minHealth {
        minHealth = secondaryHealth
    }
    if microHealth < minHealth {
        minHealth = microHealth
    }
    
    if maxHealth == 0 {
        return 0.0
    }
    
    return 1.0 - (maxHealth - minHealth) / maxHealth
}

// Calculate channel synchronization (计算通道同步) - Tính đồng bộ kênh
func CalculateChannelSynchronization(channels MeridianChannels) float64 {
    // Synchronization based on flow consistency across channels
    // Đồng bộ dựa trên tính nhất quán dòng chảy qua các kênh
    mainChannels := []MeridianChannel{
        channels.MainChannels.HandTaiyinLung,
        channels.MainChannels.HandYangmingLargeIntestine,
        channels.MainChannels.HandShaoyinHeart,
        channels.MainChannels.HandTaiyangSmallIntestine,
        channels.MainChannels.HandJueyinPericardium,
        channels.MainChannels.HandShaoyangTripleBurner,
        channels.MainChannels.FootTaiyinSpleen,
        channels.MainChannels.FootYangmingStomach,
        channels.MainChannels.FootShaoyinKidney,
        channels.MainChannels.FootTaiyangBladder,
        channels.MainChannels.FootJueyinLiver,
        channels.MainChannels.FootShaoyangGallbladder,
    }
    
    if len(mainChannels) == 0 {
        return 0.0
    }
    
    // Calculate flow variance (计算流量方差) - Tính phương sai dòng chảy
    totalFlow := 0.0
    for _, channel := range mainChannels {
        totalFlow += channel.ChannelFlow
    }
    
    avgFlow := totalFlow / float64(len(mainChannels))
    
    variance := 0.0
    for _, channel := range mainChannels {
        diff := channel.ChannelFlow - avgFlow
        variance += diff * diff
    }
    
    variance /= float64(len(mainChannels))
    
    // Synchronization = 1 - (variance / avgFlow) if avgFlow > 0
    if avgFlow == 0 {
        return 0.0
    }
    
    sync := 1.0 - (variance / avgFlow)
    if sync < 0 {
        sync = 0
    }
    if sync > 1 {
        sync = 1
    }
    
    return sync
}
```

### **Ảnh Hưởng Của Kinh Mạch Đến Speed System**

#### **1. Combat Speed (Tốc Độ Chiến Đấu)**
```go
// Calculate combat speed from meridians (从经脉计算战斗速度) - Tính tốc độ chiến đấu từ kinh mạch
func CalculateCombatSpeed(meridians MeridianSystem) float64 {
    // Base combat speed (基础战斗速度) - Tốc độ chiến đấu cơ bản
    baseSpeed := 1.0
    
    // Meridian flow rate affects reaction speed (经脉流速影响反应速度) - Tốc độ dòng chảy ảnh hưởng tốc độ phản ứng
    flowFactor := meridians.MeridianCapacity.MaxFlowRate * 0.3
    
    // Channel synchronization affects coordination (通道同步影响协调性) - Đồng bộ kênh ảnh hưởng sự phối hợp
    syncFactor := CalculateChannelSynchronization(meridians.MeridianChannels) * 0.4
    
    // Meridian efficiency affects energy utilization (经脉效率影响能量利用) - Hiệu suất kinh mạch ảnh hưởng sử dụng năng lượng
    efficiencyFactor := (meridians.MeridianQuality.Conductivity + meridians.MeridianQuality.Toughness) / 2.0 * 0.3
    
    return baseSpeed + flowFactor + syncFactor + efficiencyFactor
}

// Calculate spell casting speed (计算施法速度) - Tính tốc độ thi triển pháp thuật
func CalculateSpellCastingSpeed(meridians MeridianSystem, spiritSea SpiritSea) float64 {
    // Base casting speed (基础施法速度) - Tốc độ thi triển cơ bản
    baseSpeed := 1.0
    
    // Meridian conductivity affects qi flow to hands (经脉传导性影响气到手部) - Độ dẫn kinh mạch ảnh hưởng dòng khí đến tay
    conductivityFactor := meridians.MeridianQuality.Conductivity * 0.4
    
    // Channel health affects stability (通道健康影响稳定性) - Sức khỏe kênh ảnh hưởng độ ổn định
    healthFactor := CalculateMainChannelHealth(meridians.MeridianChannels.MainChannels) * 0.3
    
    // Spirit sea control affects precision (识海控制影响精确度) - Điều khiển thức hải ảnh hưởng độ chính xác
    controlFactor := spiritSea.SpiritSeaCore.ShenControl * 0.3
    
    return baseSpeed + conductivityFactor + healthFactor + controlFactor
}

// Calculate movement speed (计算移动速度) - Tính tốc độ di chuyển
func CalculateMovementSpeed(meridians MeridianSystem) float64 {
    // Base movement speed (基础移动速度) - Tốc độ di chuyển cơ bản
    baseSpeed := 1.0
    
    // Foot channel health affects leg strength (足经健康影响腿部力量) - Sức khỏe kênh chân ảnh hưởng sức mạnh chân
    footChannels := []MeridianChannel{
        meridians.MeridianChannels.MainChannels.FootTaiyinSpleen,
        meridians.MeridianChannels.MainChannels.FootYangmingStomach,
        meridians.MeridianChannels.MainChannels.FootShaoyinKidney,
        meridians.MeridianChannels.MainChannels.FootTaiyangBladder,
        meridians.MeridianChannels.MainChannels.FootJueyinLiver,
        meridians.MeridianChannels.MainChannels.FootShaoyangGallbladder,
    }
    
    footHealth := 0.0
    for _, channel := range footChannels {
        footHealth += channel.ChannelHealth
    }
    footHealth /= float64(len(footChannels))
    
    // Meridian flow efficiency affects energy distribution (经脉流动效率影响能量分配) - Hiệu suất dòng chảy ảnh hưởng phân phối năng lượng
    flowEfficiencyFactor := meridians.MeridianCapacity.FlowEfficiency * 0.5
    
    // Channel balance affects overall coordination (通道平衡影响整体协调) - Cân bằng kênh ảnh hưởng sự phối hợp tổng thể
    balanceFactor := CalculateChannelBalance(meridians.MeridianChannels) * 0.3
    
    return baseSpeed + footHealth*0.4 + flowEfficiencyFactor + balanceFactor
}
```

#### **2. Cultivation Speed (Tốc Độ Tu Luyện)**
```go
// Calculate cultivation speed from meridians (从经脉计算修炼速度) - Tính tốc độ tu luyện từ kinh mạch
func CalculateCultivationSpeed(meridians MeridianSystem, dantian DantianInfo) float64 {
    // Base cultivation speed (基础修炼速度) - Tốc độ tu luyện cơ bản
    baseSpeed := 1.0
    
    // Meridian conductivity affects qi absorption (经脉传导性影响气吸收) - Độ dẫn kinh mạch ảnh hưởng hấp thụ khí
    conductivityFactor := meridians.MeridianQuality.Conductivity * 0.3
    
    // Meridian capacity affects qi storage (经脉容量影响气存储) - Dung lượng kinh mạch ảnh hưởng lưu trữ khí
    capacityFactor := meridians.MeridianCapacity.TotalCapacity / 1000000.0 * 0.2 // Normalize to reasonable range
    
    // Channel health affects stability during cultivation (通道健康影响修炼稳定性) - Sức khỏe kênh ảnh hưởng độ ổn định khi tu luyện
    healthFactor := CalculateMainChannelHealth(meridians.MeridianChannels.MainChannels) * 0.2
    
    // Jing efficiency affects resource utilization (精效率影响资源利用) - Hiệu suất tinh ảnh hưởng sử dụng tài nguyên
    jingFactor := meridians.JingReserve.JingEfficiency * 0.2
    
    // Dantian purity affects conversion efficiency (丹田纯度影响转换效率) - Độ tinh khiết đan điền ảnh hưởng hiệu suất chuyển đổi
    dantianFactor := dantian.Quality.DantianPurity * 0.1
    
    return baseSpeed + conductivityFactor + capacityFactor + healthFactor + jingFactor + dantianFactor
}

// Calculate breakthrough speed (计算突破速度) - Tính tốc độ đột phá
func CalculateBreakthroughSpeed(meridians MeridianSystem, spiritSea SpiritSea) float64 {
    // Base breakthrough speed (基础突破速度) - Tốc độ đột phá cơ bản
    baseSpeed := 1.0
    
    // Meridian stability affects breakthrough success (经脉稳定性影响突破成功) - Độ ổn định kinh mạch ảnh hưởng thành công đột phá
    stabilityFactor := meridians.MeridianCultivation.MeridianStability * 0.4
    
    // Channel synchronization affects energy coordination (通道同步影响能量协调) - Đồng bộ kênh ảnh hưởng phối hợp năng lượng
    syncFactor := CalculateChannelSynchronization(meridians.MeridianChannels) * 0.3
    
    // Spirit sea clarity affects focus (识海清晰度影响专注) - Độ tinh tường thức hải ảnh hưởng sự tập trung
    clarityFactor := spiritSea.SpiritSeaCore.ShenClarity * 0.3
    
    return baseSpeed + stabilityFactor + syncFactor + clarityFactor
}
```

#### **3. Derived Stats từ Kinh Mạch**
```go
// Meridian-derived stats (经脉派生属性) - Các derived stats từ kinh mạch
var MeridianDerivedStats = []string{
    // Speed-related stats (速度相关属性) - Stats liên quan đến tốc độ
    "combat_speed",              // Combat speed (战斗速度) - Tốc độ chiến đấu
    "spell_casting_speed",       // Spell casting speed (施法速度) - Tốc độ thi triển pháp thuật
    "movement_speed",            // Movement speed (移动速度) - Tốc độ di chuyển
    "reaction_speed",            // Reaction speed (反应速度) - Tốc độ phản ứng
    "attack_speed",              // Attack speed (攻击速度) - Tốc độ tấn công
    
    // Cultivation-related stats (修炼相关属性) - Stats liên quan đến tu luyện
    "cultivation_speed",         // Cultivation speed (修炼速度) - Tốc độ tu luyện
    "breakthrough_speed",        // Breakthrough speed (突破速度) - Tốc độ đột phá
    "qi_absorption_rate",        // Qi absorption rate (气吸收率) - Tỷ lệ hấp thụ khí
    "jing_consumption_rate",     // Jing consumption rate (精消耗率) - Tỷ lệ tiêu hao tinh
    "energy_efficiency",         // Energy efficiency (能量效率) - Hiệu suất năng lượng
    
    // Stability and control stats (稳定性和控制属性) - Stats ổn định và điều khiển
    "meridian_stability",        // Meridian stability (经脉稳定性) - Độ ổn định kinh mạch
    "channel_balance",           // Channel balance (通道平衡) - Cân bằng kênh
    "flow_control",              // Flow control (流动控制) - Điều khiển dòng chảy
    "pressure_tolerance",        // Pressure tolerance (压力耐受) - Khả năng chịu áp lực
    "recovery_speed",            // Recovery speed (恢复速度) - Tốc độ phục hồi
}

// Calculate meridian-derived stats (计算经脉派生属性) - Tính các derived stats từ kinh mạch
func CalculateMeridianDerivedStats(meridians MeridianSystem, dantian DantianInfo, spiritSea SpiritSea) map[string]float64 {
    stats := make(map[string]float64)
    
    // Speed-related stats (速度相关属性) - Stats liên quan đến tốc độ
    stats["combat_speed"] = CalculateCombatSpeed(meridians)
    stats["spell_casting_speed"] = CalculateSpellCastingSpeed(meridians, spiritSea)
    stats["movement_speed"] = CalculateMovementSpeed(meridians)
    stats["reaction_speed"] = meridians.MeridianCapacity.MaxFlowRate * 0.8 + meridians.MeridianQuality.Conductivity * 0.2
    stats["attack_speed"] = CalculateCombatSpeed(meridians) * 0.9 // Slightly slower than combat speed
    
    // Cultivation-related stats (修炼相关属性) - Stats liên quan đến tu luyện
    stats["cultivation_speed"] = CalculateCultivationSpeed(meridians, dantian)
    stats["breakthrough_speed"] = CalculateBreakthroughSpeed(meridians, spiritSea)
    stats["qi_absorption_rate"] = meridians.MeridianQuality.Conductivity * 0.6 + meridians.MeridianCapacity.FlowEfficiency * 0.4
    stats["jing_consumption_rate"] = meridians.JingReserve.JingConsumption
    stats["energy_efficiency"] = (meridians.MeridianQuality.Conductivity + meridians.MeridianQuality.Toughness) / 2.0
    
    // Stability and control stats (稳定性和控制属性) - Stats ổn định và điều khiển
    stats["meridian_stability"] = meridians.MeridianCultivation.MeridianStability
    stats["channel_balance"] = CalculateChannelBalance(meridians.MeridianChannels)
    stats["flow_control"] = CalculateChannelSynchronization(meridians.MeridianChannels)
    stats["pressure_tolerance"] = meridians.MeridianCapacity.PressureTolerance
    stats["recovery_speed"] = meridians.MeridianQuality.Resilience * 0.7 + meridians.JingReserve.JingRegeneration * 0.3
    
    return stats
}
```

#### **4. Ảnh Hưởng Đến Các Hoạt Động Cụ Thể**

**Combat System:**
```go
// Calculate attack cooldown (计算攻击冷却) - Tính thời gian hồi chiêu tấn công
func CalculateAttackCooldown(meridians MeridianSystem) float64 {
    baseCooldown := 2.0 // 2 seconds base cooldown
    speedFactor := CalculateCombatSpeed(meridians)
    return baseCooldown / speedFactor
}

// Calculate spell cooldown (计算法术冷却) - Tính thời gian hồi chiêu pháp thuật
func CalculateSpellCooldown(meridians MeridianSystem, spiritSea SpiritSea) float64 {
    baseCooldown := 3.0 // 3 seconds base cooldown
    speedFactor := CalculateSpellCastingSpeed(meridians, spiritSea)
    return baseCooldown / speedFactor
}
```

**Cultivation System:**
```go
// Calculate cultivation time (计算修炼时间) - Tính thời gian tu luyện
func CalculateCultivationTime(meridians MeridianSystem, dantian DantianInfo, targetExp float64) float64 {
    baseTime := targetExp / 1000.0 // Base time in hours
    speedFactor := CalculateCultivationSpeed(meridians, dantian)
    return baseTime / speedFactor
}

// Calculate breakthrough time (计算突破时间) - Tính thời gian đột phá
func CalculateBreakthroughTime(meridians MeridianSystem, spiritSea SpiritSea, realmLevel int64) float64 {
    baseTime := float64(realmLevel) * 24.0 // Base time in hours (24h per realm level)
    speedFactor := CalculateBreakthroughSpeed(meridians, spiritSea)
    return baseTime / speedFactor
}
```

### **Ảnh Hưởng Của Đan Điền Đến Energy System (Hệ Thống Năng Lượng)**

#### **1. Energy Types (Các Loại Năng Lượng)**
```go
// Energy types in Jindan System (金丹系统中的能量类型) - Các loại năng lượng trong hệ thống kim đan
type EnergyType string

const (
    // Basic energies (基础能量) - Năng lượng cơ bản
    EnergyTypeHP        EnergyType = "hp"         // Health Points (生命值) - Điểm sinh mệnh
    EnergyTypeStamina   EnergyType = "stamina"    // Stamina (体力) - Thể lực
    EnergyTypeMana      EnergyType = "mana"       // Mana (法力) - Pháp lực
    
    // Cultivation energies (修炼能量) - Năng lượng tu luyện
    EnergyTypeQi        EnergyType = "qi"         // Qi (气) - Khí
    EnergyTypeLingQi    EnergyType = "ling_qi"    // Ling Qi (灵气) - Linh khí
    EnergyTypeXianQi    EnergyType = "xian_qi"    // Xian Qi (仙气) - Tiên khí
    EnergyTypeShenQi    EnergyType = "shen_qi"    // Shen Qi (神气) - Thần khí
    
    // Special energies (特殊能量) - Năng lượng đặc biệt
    EnergyTypeJing      EnergyType = "jing"       // Jing (精) - Tinh
    EnergyTypeShen      EnergyType = "shen"       // Shen (神) - Thần
    EnergyTypeTuVi      EnergyType = "tu_vi"      // Tu Vi (修为) - Tu vi
    EnergyTypeYuanLi    EnergyType = "yuan_li"    // Yuan Li (元力) - Nguyên lực
    EnergyTypeNianLi    EnergyType = "nian_li"    // Nian Li (念力) - Niệm lực
)

// Energy configuration (能量配置) - Cấu hình năng lượng
type EnergyConfig struct {
    Type        EnergyType `json:"type"`         // Energy type (能量类型) - Loại năng lượng
    Name        string     `json:"name"`         // Display name (显示名称) - Tên hiển thị
    Description string     `json:"description"`  // Description (描述) - Mô tả
    BaseValue   float64    `json:"base_value"`   // Base value (基础值) - Giá trị cơ bản
    MaxValue    float64    `json:"max_value"`    // Max value (最大值) - Giá trị tối đa
    RegenRate   float64    `json:"regen_rate"`   // Regeneration rate (恢复率) - Tỷ lệ hồi phục
    DecayRate   float64    `json:"decay_rate"`   // Decay rate (衰减率) - Tỷ lệ suy giảm
}

// Get all energy types (获取所有能量类型) - Lấy tất cả loại năng lượng
func GetAllEnergyTypes() []EnergyType {
    return []EnergyType{
        EnergyTypeHP, EnergyTypeStamina, EnergyTypeMana,
        EnergyTypeQi, EnergyTypeLingQi, EnergyTypeXianQi, EnergyTypeShenQi,
        EnergyTypeJing, EnergyTypeShen, EnergyTypeTuVi, EnergyTypeYuanLi, EnergyTypeNianLi,
    }
}

// Get energy configs (获取能量配置) - Lấy cấu hình năng lượng
func GetEnergyConfigs() map[EnergyType]EnergyConfig {
    return map[EnergyType]EnergyConfig{
        EnergyTypeHP: {
            Type:        EnergyTypeHP,
            Name:        "Health Points",
            Description: "Life force and vitality (生命力和活力) - Sinh lực và sức sống",
            BaseValue:   100.0,
            MaxValue:    1000.0,
            RegenRate:   1.0,
            DecayRate:   0.0,
        },
        EnergyTypeStamina: {
            Type:        EnergyTypeStamina,
            Name:        "Stamina",
            Description: "Physical endurance (体力) - Thể lực",
            BaseValue:   100.0,
            MaxValue:    1000.0,
            RegenRate:   2.0,
            DecayRate:   0.1,
        },
        EnergyTypeMana: {
            Type:        EnergyTypeMana,
            Name:        "Mana",
            Description: "Magical energy (魔法能量) - Năng lượng pháp thuật",
            BaseValue:   100.0,
            MaxValue:    1000.0,
            RegenRate:   1.5,
            DecayRate:   0.05,
        },
        EnergyTypeQi: {
            Type:        EnergyTypeQi,
            Name:        "Qi",
            Description: "Basic cultivation energy (基础修炼能量) - Năng lượng tu luyện cơ bản",
            BaseValue:   0.0,
            MaxValue:    10000.0,
            RegenRate:   0.5,
            DecayRate:   0.02,
        },
        EnergyTypeLingQi: {
            Type:        EnergyTypeLingQi,
            Name:        "Ling Qi",
            Description: "Spiritual energy (灵气) - Linh khí",
            BaseValue:   0.0,
            MaxValue:    50000.0,
            RegenRate:   0.3,
            DecayRate:   0.01,
        },
        EnergyTypeXianQi: {
            Type:        EnergyTypeXianQi,
            Name:        "Xian Qi",
            Description: "Immortal energy (仙气) - Tiên khí",
            BaseValue:   0.0,
            MaxValue:    100000.0,
            RegenRate:   0.2,
            DecayRate:   0.005,
        },
        EnergyTypeShenQi: {
            Type:        EnergyTypeShenQi,
            Name:        "Shen Qi",
            Description: "Divine energy (神气) - Thần khí",
            BaseValue:   0.0,
            MaxValue:    500000.0,
            RegenRate:   0.1,
            DecayRate:   0.001,
        },
        EnergyTypeJing: {
            Type:        EnergyTypeJing,
            Name:        "Jing",
            Description: "Essence energy (精) - Tinh",
            BaseValue:   100.0,
            MaxValue:    1000.0,
            RegenRate:   0.1,
            DecayRate:   0.01,
        },
        EnergyTypeShen: {
            Type:        EnergyTypeShen,
            Name:        "Shen",
            Description: "Spirit energy (神) - Thần",
            BaseValue:   100.0,
            MaxValue:    1000.0,
            RegenRate:   0.1,
            DecayRate:   0.01,
        },
        EnergyTypeTuVi: {
            Type:        EnergyTypeTuVi,
            Name:        "Tu Vi",
            Description: "Cultivation experience (修为) - Tu vi",
            BaseValue:   0.0,
            MaxValue:    1000000.0,
            RegenRate:   0.0, // Tu Vi doesn't regenerate naturally
            DecayRate:   0.0, // Tu Vi doesn't decay
        },
        EnergyTypeYuanLi: {
            Type:        EnergyTypeYuanLi,
            Name:        "Yuan Li",
            Description: "Primordial force (元力) - Nguyên lực",
            BaseValue:   0.0,
            MaxValue:    100000.0,
            RegenRate:   0.05,
            DecayRate:   0.001,
        },
        EnergyTypeNianLi: {
            Type:        EnergyTypeNianLi,
            Name:        "Nian Li",
            Description: "Mental force from Spirit Sea (念力) - Niệm lực từ thức hải",
            BaseValue:   0.0,
            MaxValue:    50000.0,
            RegenRate:   0.1,
            DecayRate:   0.005,
        },
    }
}
```

#### **2. Energy Calculation from Dantian (Tính Năng Lượng từ Đan Điền)**
```go
// Calculate energy from dantian (从丹田计算能量) - Tính năng lượng từ đan điền
func CalculateEnergyFromDantian(dantian DantianInfo, meridians MeridianSystem, energyType EnergyType) float64 {
    config := GetEnergyConfigs()[energyType]
    
    // Base value from config (从配置获取基础值) - Lấy giá trị cơ bản từ cấu hình
    baseValue := config.BaseValue
    
    // Dantian capacity affects all energies (丹田容量影响所有能量) - Dung lượng đan điền ảnh hưởng tất cả năng lượng
    capacityFactor := dantian.Storage.DantianCapacity / 1000.0
    
    // Dantian purity affects energy quality (丹田纯度影响能量质量) - Độ tinh khiết đan điền ảnh hưởng chất lượng năng lượng
    purityFactor := dantian.Quality.DantianPurity
    
    // Dantian level affects energy strength (丹田等级影响能量强度) - Cấp độ đan điền ảnh hưởng sức mạnh năng lượng
    levelFactor := float64(dantian.Core.DantianLevel)
    
    // Meridian health affects energy flow (经脉健康影响能量流动) - Sức khỏe kinh mạch ảnh hưởng dòng chảy năng lượng
    meridianHealth := CalculateMainChannelHealth(meridians.MeridianChannels.MainChannels)
    
    // Calculate energy based on type (根据类型计算能量) - Tính năng lượng dựa trên loại
    switch energyType {
    case EnergyTypeHP:
        return baseValue + capacityFactor*0.4 + purityFactor*50.0*0.3 + levelFactor*20.0*0.2 + meridianHealth*30.0*0.1
    case EnergyTypeStamina:
        return baseValue + capacityFactor*0.3 + purityFactor*40.0*0.4 + levelFactor*15.0*0.3
    case EnergyTypeMana:
        return baseValue + capacityFactor*0.5 + purityFactor*80.0*0.3 + levelFactor*30.0*0.2
    case EnergyTypeQi:
        return baseValue + capacityFactor*0.6 + purityFactor*100.0*0.4 + levelFactor*50.0*0.3 + meridianHealth*20.0*0.2
    case EnergyTypeLingQi:
        return baseValue + capacityFactor*0.7 + purityFactor*150.0*0.5 + levelFactor*80.0*0.4 + meridianHealth*25.0*0.3
    case EnergyTypeXianQi:
        return baseValue + capacityFactor*0.8 + purityFactor*200.0*0.6 + levelFactor*120.0*0.5 + meridianHealth*30.0*0.4
    case EnergyTypeShenQi:
        return baseValue + capacityFactor*0.9 + purityFactor*300.0*0.7 + levelFactor*200.0*0.6 + meridianHealth*40.0*0.5
    case EnergyTypeJing:
        return baseValue + capacityFactor*0.2 + purityFactor*30.0*0.3 + levelFactor*10.0*0.2
    case EnergyTypeShen:
        return baseValue + capacityFactor*0.3 + purityFactor*40.0*0.4 + levelFactor*15.0*0.3
    case EnergyTypeTuVi:
        // Tu Vi is calculated differently (Tu Vi được tính khác) - Tu Vi được tính từ power level
        return CalculateTuViFromPowerLevel(dantian.Core.PowerLevel)
    case EnergyTypeYuanLi:
        return baseValue + capacityFactor*0.4 + purityFactor*60.0*0.5 + levelFactor*25.0*0.4 + meridianHealth*15.0*0.3
    case EnergyTypeNianLi:
        // Nian Li is calculated from Spirit Sea, not Dantian (Niệm lực được tính từ thức hải, không phải đan điền) - Nian Li is calculated from Spirit Sea
        return 0.0 // Will be calculated separately in Spirit Sea section
    default:
        return baseValue
    }
}

// Calculate energy regeneration from dantian (从丹田计算能量恢复) - Tính hồi phục năng lượng từ đan điền
func CalculateEnergyRegeneration(dantian DantianInfo, meridians MeridianSystem, energyType EnergyType) float64 {
    config := GetEnergyConfigs()[energyType]
    
    // Base regen rate from config (从配置获取基础恢复率) - Lấy tỷ lệ hồi phục cơ bản từ cấu hình
    baseRegen := config.RegenRate
    
    // Dantian efficiency affects regeneration (丹田效率影响恢复) - Hiệu suất đan điền ảnh hưởng hồi phục
    efficiencyFactor := dantian.Quality.DantianEfficiency
    
    // Dantian stability affects consistent regen (丹田稳定性影响持续恢复) - Độ ổn định đan điền ảnh hưởng hồi phục liên tục
    stabilityFactor := dantian.Quality.DantianStability
    
    // Meridian flow affects energy circulation (经脉流动影响能量循环) - Dòng chảy kinh mạch ảnh hưởng tuần hoàn năng lượng
    flowFactor := meridians.MeridianCapacity.FlowEfficiency
    
    // Calculate regen based on type (根据类型计算恢复) - Tính hồi phục dựa trên loại
    switch energyType {
    case EnergyTypeHP:
        return baseRegen + efficiencyFactor*0.5 + stabilityFactor*0.3 + flowFactor*0.2
    case EnergyTypeStamina:
        return baseRegen + efficiencyFactor*0.6 + stabilityFactor*0.4 + flowFactor*0.3
    case EnergyTypeMana:
        return baseRegen + efficiencyFactor*0.7 + stabilityFactor*0.4 + flowFactor*0.2
    case EnergyTypeQi:
        return baseRegen + efficiencyFactor*0.8 + stabilityFactor*0.5 + flowFactor*0.4
    case EnergyTypeLingQi:
        return baseRegen + efficiencyFactor*0.9 + stabilityFactor*0.6 + flowFactor*0.5
    case EnergyTypeXianQi:
        return baseRegen + efficiencyFactor*1.0 + stabilityFactor*0.7 + flowFactor*0.6
    case EnergyTypeShenQi:
        return baseRegen + efficiencyFactor*1.1 + stabilityFactor*0.8 + flowFactor*0.7
    case EnergyTypeJing:
        return baseRegen + efficiencyFactor*0.3 + stabilityFactor*0.2 + flowFactor*0.1
    case EnergyTypeShen:
        return baseRegen + efficiencyFactor*0.4 + stabilityFactor*0.3 + flowFactor*0.2
    case EnergyTypeTuVi:
        return 0.0 // Tu Vi doesn't regenerate naturally
    case EnergyTypeYuanLi:
        return baseRegen + efficiencyFactor*0.5 + stabilityFactor*0.4 + flowFactor*0.3
    case EnergyTypeNianLi:
        return 0.0 // Nian Li regeneration is calculated from Spirit Sea
    default:
        return baseRegen
    }
}

// Calculate energy cap from dantian (从丹田计算能量上限) - Tính giới hạn năng lượng từ đan điền
func CalculateEnergyCap(dantian DantianInfo, meridians MeridianSystem, energyType EnergyType) float64 {
    config := GetEnergyConfigs()[energyType]
    
    // Base cap from config (从配置获取基础上限) - Lấy giới hạn cơ bản từ cấu hình
    baseCap := config.MaxValue
    
    // Dantian capacity directly affects energy cap (丹田容量直接影响能量上限) - Dung lượng đan điền ảnh hưởng trực tiếp giới hạn năng lượng
    capacityFactor := dantian.Storage.DantianCapacity / 100.0
    
    // Dantian quality affects energy quality (丹田质量影响能量质量) - Chất lượng đan điền ảnh hưởng chất lượng năng lượng
    qualityFactor := (dantian.Quality.DantianPurity + dantian.Quality.DantianEfficiency) / 2.0
    
    // Meridian capacity affects energy storage (经脉容量影响能量存储) - Dung lượng kinh mạch ảnh hưởng lưu trữ năng lượng
    meridianFactor := meridians.MeridianCapacity.TotalCapacity / 10000.0
    
    // Calculate cap based on type (根据类型计算上限) - Tính giới hạn dựa trên loại
    switch energyType {
    case EnergyTypeHP:
        return baseCap + capacityFactor*0.6 + qualityFactor*100.0*0.3 + meridianFactor*0.1
    case EnergyTypeStamina:
        return baseCap + capacityFactor*0.5 + qualityFactor*80.0*0.4 + meridianFactor*0.1
    case EnergyTypeMana:
        return baseCap + capacityFactor*0.7 + qualityFactor*150.0*0.2 + meridianFactor*0.1
    case EnergyTypeQi:
        return baseCap + capacityFactor*0.8 + qualityFactor*200.0*0.3 + meridianFactor*0.2
    case EnergyTypeLingQi:
        return baseCap + capacityFactor*0.9 + qualityFactor*300.0*0.4 + meridianFactor*0.3
    case EnergyTypeXianQi:
        return baseCap + capacityFactor*1.0 + qualityFactor*500.0*0.5 + meridianFactor*0.4
    case EnergyTypeShenQi:
        return baseCap + capacityFactor*1.1 + qualityFactor*800.0*0.6 + meridianFactor*0.5
    case EnergyTypeJing:
        return baseCap + capacityFactor*0.3 + qualityFactor*50.0*0.2 + meridianFactor*0.05
    case EnergyTypeShen:
        return baseCap + capacityFactor*0.4 + qualityFactor*60.0*0.3 + meridianFactor*0.05
    case EnergyTypeTuVi:
        return baseCap // Tu Vi cap is based on power level, not dantian
    case EnergyTypeYuanLi:
        return baseCap + capacityFactor*0.6 + qualityFactor*120.0*0.4 + meridianFactor*0.2
    case EnergyTypeNianLi:
        return baseCap // Nian Li cap is calculated from Spirit Sea
    default:
        return baseCap
    }
}
```

#### **3. Integration with Actor Core v3 (Tích Hợp với Actor Core v3)**
```go
// Convert Jindan System to Actor Core v3 SubsystemOutput (转换金丹系统到Actor Core v3 SubsystemOutput) - Chuyển đổi hệ thống kim đan sang SubsystemOutput của Actor Core v3
func ConvertToSubsystemOutput(dantian DantianInfo, meridians MeridianSystem, spiritSea SpiritSea) *interfaces.SubsystemOutput {
    // Calculate all energies (计算所有能量) - Tính tất cả năng lượng
    energyValues := make(map[EnergyType]float64)
    energyRegens := make(map[EnergyType]float64)
    energyCaps := make(map[EnergyType]float64)
    
    for _, energyType := range GetAllEnergyTypes() {
        energyValues[energyType] = CalculateEnergyFromDantian(dantian, meridians, energyType)
        energyRegens[energyType] = CalculateEnergyRegeneration(dantian, meridians, energyType)
        energyCaps[energyType] = CalculateEnergyCap(dantian, meridians, energyType)
    }
    
    // Create primary contributions (创建主要贡献) - Tạo các đóng góp chính
    primaryContributions := make([]interfaces.Contribution, 0)
    
    // Add dantian primary stats (添加丹田主要属性) - Thêm các primary stats của đan điền
    dantianPrimaryStats := CalculateDantianPrimaryStats(dantian, meridians)
    for statName, value := range dantianPrimaryStats {
        primaryContributions = append(primaryContributions, interfaces.Contribution{
            Dimension: statName,
            Bucket:    "dantian",
            Value:     value,
            System:    "jindan_system",
            Priority:  100,
        })
    }
    
    // Add meridian primary stats (添加经脉主要属性) - Thêm các primary stats của kinh mạch
    meridianPrimaryStats := CalculateMeridianPrimaryStats(meridians)
    for statName, value := range meridianPrimaryStats {
        primaryContributions = append(primaryContributions, interfaces.Contribution{
            Dimension: statName,
            Bucket:    "meridians",
            Value:     value,
            System:    "jindan_system",
            Priority:  90,
        })
    }
    
    // Add spirit sea primary stats (添加识海主要属性) - Thêm các primary stats của thức hải
    spiritSeaPrimaryStats := CalculateSpiritSeaPrimaryStats(spiritSea)
    for statName, value := range spiritSeaPrimaryStats {
        primaryContributions = append(primaryContributions, interfaces.Contribution{
            Dimension: statName,
            Bucket:    "spirit_sea",
            Value:     value,
            System:    "jindan_system",
            Priority:  80,
        })
    }
    
    // Create derived contributions (创建派生贡献) - Tạo các đóng góp dẫn xuất
    derivedContributions := make([]interfaces.Contribution, 0)
    
    // Add energy values as derived stats (添加能量值作为派生属性) - Thêm giá trị năng lượng như derived stats
    for energyType, value := range energyValues {
        derivedContributions = append(derivedContributions, interfaces.Contribution{
            Dimension: string(energyType),
            Bucket:    "energy",
            Value:     value,
            System:    "jindan_system",
            Priority:  100,
        })
    }
    
    // Add energy regeneration rates (添加能量恢复率) - Thêm tỷ lệ hồi phục năng lượng
    for energyType, regen := range energyRegens {
        derivedContributions = append(derivedContributions, interfaces.Contribution{
            Dimension: string(energyType) + "_regen",
            Bucket:    "energy_regen",
            Value:     regen,
            System:    "jindan_system",
            Priority:  90,
        })
    }
    
    // Add energy caps (添加能量上限) - Thêm giới hạn năng lượng
    for energyType, cap := range energyCaps {
        derivedContributions = append(derivedContributions, interfaces.Contribution{
            Dimension: string(energyType) + "_cap",
            Bucket:    "energy_cap",
            Value:     cap,
            System:    "jindan_system",
            Priority:  80,
        })
    }
    
    // Add speed-related derived stats (添加速度相关派生属性) - Thêm các derived stats liên quan đến tốc độ
    speedStats := CalculateMeridianDerivedStats(meridians, dantian, spiritSea)
    for statName, value := range speedStats {
        derivedContributions = append(derivedContributions, interfaces.Contribution{
            Dimension: statName,
            Bucket:    "speed",
            Value:     value,
            System:    "jindan_system",
            Priority:  70,
        })
    }
    
    // Create cap contributions (创建上限贡献) - Tạo các đóng góp giới hạn
    capContributions := make([]interfaces.CapContribution, 0)
    
    // Add energy caps (添加能量上限) - Thêm giới hạn năng lượng
    for energyType, cap := range energyCaps {
        capContributions = append(capContributions, interfaces.CapContribution{
            System:    "jindan_system",
            Dimension: string(energyType),
            Mode:      "HARD_MAX",
            Kind:      "ENERGY",
            Value:     cap,
            Priority:  100,
            Scope:     "REALM",
            Realm:     GetCurrentRealm(dantian.Core.DantianLevel),
            Tags:      []string{"energy", "dantian"},
        })
    }
    
    // Create context modifiers (创建上下文修饰符) - Tạo các bộ điều chỉnh ngữ cảnh
    contextModifiers := make(map[string]interfaces.ModifierPack)
    
    // Add dantian quality modifiers (添加丹田质量修饰符) - Thêm bộ điều chỉnh chất lượng đan điền
    contextModifiers["dantian_quality"] = interfaces.ModifierPack{
        AdditivePercent: dantian.Quality.DantianPurity * 0.1,
        Multipliers:     []float64{dantian.Quality.DantianEfficiency},
        PostAdd:         dantian.Quality.DantianStability * 0.05,
    }
    
    // Add meridian flow modifiers (添加经脉流动修饰符) - Thêm bộ điều chỉnh dòng chảy kinh mạch
    contextModifiers["meridian_flow"] = interfaces.ModifierPack{
        AdditivePercent: meridians.MeridianCapacity.FlowEfficiency * 0.2,
        Multipliers:     []float64{meridians.MeridianQuality.Conductivity},
        PostAdd:         meridians.MeridianQuality.Toughness * 0.1,
    }
    
    // Create subsystem metadata (创建子系统元数据) - Tạo siêu dữ liệu hệ thống con
    meta := interfaces.SubsystemMeta{
        System:     "jindan_system",
        Version:    1,
        APILevel:   3,
        Compatible: true,
    }
    
    return &interfaces.SubsystemOutput{
        Primary: primaryContributions,
        Derived: derivedContributions,
        Caps:    capContributions,
        Context: contextModifiers,
        Meta:    meta,
    }
}
```

#### **4. Energy Management Functions (Hàm Quản Lý Năng Lượng)**
```go
// Energy management functions (能量管理函数) - Các hàm quản lý năng lượng
type EnergyManager struct {
    dantian   DantianInfo
    meridians MeridianSystem
    spiritSea SpiritSea
}

// NewEnergyManager creates a new energy manager (创建新的能量管理器) - Tạo energy manager mới
func NewEnergyManager(dantian DantianInfo, meridians MeridianSystem, spiritSea SpiritSea) *EnergyManager {
    return &EnergyManager{
        dantian:   dantian,
        meridians: meridians,
        spiritSea: spiritSea,
    }
}

// GetEnergyValue gets current energy value (获取当前能量值) - Lấy giá trị năng lượng hiện tại
func (em *EnergyManager) GetEnergyValue(energyType EnergyType) float64 {
    return CalculateEnergyFromDantian(em.dantian, em.meridians, energyType)
}

// GetEnergyRegen gets energy regeneration rate (获取能量恢复率) - Lấy tỷ lệ hồi phục năng lượng
func (em *EnergyManager) GetEnergyRegen(energyType EnergyType) float64 {
    return CalculateEnergyRegeneration(em.dantian, em.meridians, energyType)
}

// GetEnergyCap gets energy capacity (获取能量容量) - Lấy dung lượng năng lượng
func (em *EnergyManager) GetEnergyCap(energyType EnergyType) float64 {
    return CalculateEnergyCap(em.dantian, em.meridians, energyType)
}

// ConsumeEnergy consumes energy (消耗能量) - Tiêu hao năng lượng
func (em *EnergyManager) ConsumeEnergy(energyType EnergyType, amount float64) bool {
    currentValue := em.GetEnergyValue(energyType)
    if currentValue < amount {
        return false // Not enough energy
    }
    
    // Update dantian storage (更新丹田存储) - Cập nhật lưu trữ đan điền
    em.dantian.Storage.CurrentQi -= amount * 0.1 // Convert to Qi consumption
    return true
}

// RestoreEnergy restores energy (恢复能量) - Hồi phục năng lượng
func (em *EnergyManager) RestoreEnergy(energyType EnergyType, amount float64) {
    regenRate := em.GetEnergyRegen(energyType)
    cap := em.GetEnergyCap(energyType)
    
    // Calculate restoration amount (计算恢复量) - Tính lượng hồi phục
    restoration := regenRate * amount
    if restoration > cap {
        restoration = cap
    }
    
    // Update dantian storage (更新丹田存储) - Cập nhật lưu trữ đan điền
    em.dantian.Storage.CurrentQi += restoration * 0.1 // Convert to Qi restoration
}
```

#### **5. Combat Integration (Tích Hợp Combat)**
```go
// Combat energy functions (战斗能量函数) - Các hàm năng lượng chiến đấu
func (em *EnergyManager) CanCastSpell(spellCost map[EnergyType]float64) bool {
    for energyType, cost := range spellCost {
        if em.GetEnergyValue(energyType) < cost {
            return false
        }
    }
    return true
}

func (em *EnergyManager) CastSpell(spellCost map[EnergyType]float64) bool {
    if !em.CanCastSpell(spellCost) {
        return false
    }
    
    for energyType, cost := range spellCost {
        em.ConsumeEnergy(energyType, cost)
    }
    return true
}

func (em *EnergyManager) CanPerformAction(actionCost map[EnergyType]float64) bool {
    for energyType, cost := range actionCost {
        if em.GetEnergyValue(energyType) < cost {
            return false
        }
    }
    return true
}

func (em *EnergyManager) PerformAction(actionCost map[EnergyType]float64) bool {
    if !em.CanPerformAction(actionCost) {
        return false
    }
    
    for energyType, cost := range actionCost {
        em.ConsumeEnergy(energyType, cost)
    }
    return true
}
```

### **Ảnh Hưởng Của Đan Điền Đến HP và MP**

#### **1. HP (Sinh Mệnh) - Health Points**
```go
// Calculate HP from dantian (从丹田计算生命值) - Tính HP từ đan điền
func CalculateHPFromDantian(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base HP (基础生命值) - HP cơ bản
    baseHP := 100.0
    
    // Dantian capacity affects total life force (丹田容量影响总生命力) - Dung lượng đan điền ảnh hưởng tổng sinh lực
    capacityFactor := dantian.Storage.DantianCapacity / 1000.0 * 0.4
    
    // Dantian purity affects life quality (丹田纯度影响生命质量) - Độ tinh khiết đan điền ảnh hưởng chất lượng sinh mệnh
    purityFactor := dantian.Quality.DantianPurity * 50.0 * 0.3
    
    // Dantian level affects life force strength (丹田等级影响生命力强度) - Cấp độ đan điền ảnh hưởng sức mạnh sinh lực
    levelFactor := float64(dantian.Core.DantianLevel) * 20.0 * 0.2
    
    // Meridian health affects life circulation (经脉健康影响生命循环) - Sức khỏe kinh mạch ảnh hưởng tuần hoàn sinh mệnh
    meridianHealth := CalculateMainChannelHealth(meridians.MeridianChannels.MainChannels)
    meridianFactor := meridianHealth * 30.0 * 0.1
    
    return baseHP + capacityFactor + purityFactor + levelFactor + meridianFactor
}

// Calculate HP regeneration from dantian (从丹田计算生命恢复) - Tính hồi phục HP từ đan điền
func CalculateHPRegeneration(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base HP regen (基础生命恢复) - Hồi phục HP cơ bản
    baseRegen := 1.0
    
    // Dantian efficiency affects life force regeneration (丹田效率影响生命力恢复) - Hiệu suất đan điền ảnh hưởng hồi phục sinh lực
    efficiencyFactor := dantian.Quality.DantianEfficiency * 0.5
    
    // Dantian stability affects consistent regeneration (丹田稳定性影响持续恢复) - Độ ổn định đan điền ảnh hưởng hồi phục liên tục
    stabilityFactor := dantian.Quality.DantianStability * 0.3
    
    // Meridian flow affects life force circulation (经脉流动影响生命力循环) - Dòng chảy kinh mạch ảnh hưởng tuần hoàn sinh lực
    flowFactor := meridians.MeridianCapacity.FlowEfficiency * 0.2
    
    return baseRegen + efficiencyFactor + stabilityFactor + flowFactor
}

// Calculate HP cap from dantian (从丹田计算生命上限) - Tính giới hạn HP từ đan điền
func CalculateHPCap(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base HP cap (基础生命上限) - Giới hạn HP cơ bản
    baseCap := 1000.0
    
    // Dantian capacity directly affects HP cap (丹田容量直接影响生命上限) - Dung lượng đan điền ảnh hưởng trực tiếp giới hạn HP
    capacityFactor := dantian.Storage.DantianCapacity / 100.0 * 0.6
    
    // Dantian quality affects HP quality (丹田质量影响生命质量) - Chất lượng đan điền ảnh hưởng chất lượng HP
    qualityFactor := (dantian.Quality.DantianPurity + dantian.Quality.DantianEfficiency) / 2.0 * 100.0 * 0.3
    
    // Meridian capacity affects life force storage (经脉容量影响生命力存储) - Dung lượng kinh mạch ảnh hưởng lưu trữ sinh lực
    meridianFactor := meridians.MeridianCapacity.TotalCapacity / 10000.0 * 0.1
    
    return baseCap + capacityFactor + qualityFactor + meridianFactor
}
```

#### **2. MP (Tu Vi/Linh Khí/Tiên Khí) - Mana Points**
```go
// Calculate MP from dantian (从丹田计算法力值) - Tính MP từ đan điền
func CalculateMPFromDantian(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base MP (基础法力值) - MP cơ bản
    baseMP := 100.0
    
    // Dantian capacity directly affects MP (丹田容量直接影响法力值) - Dung lượng đan điền ảnh hưởng trực tiếp MP
    capacityFactor := dantian.Storage.DantianCapacity / 1000.0 * 0.5
    
    // Dantian purity affects MP quality (丹田纯度影响法力质量) - Độ tinh khiết đan điền ảnh hưởng chất lượng MP
    purityFactor := dantian.Quality.DantianPurity * 80.0 * 0.3
    
    // Dantian level affects MP strength (丹田等级影响法力强度) - Cấp độ đan điền ảnh hưởng sức mạnh MP
    levelFactor := float64(dantian.Core.DantianLevel) * 30.0 * 0.2
    
    return baseMP + capacityFactor + purityFactor + levelFactor
}

// Calculate MP regeneration from dantian (从丹田计算法力恢复) - Tính hồi phục MP từ đan điền
func CalculateMPRegeneration(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base MP regen (基础法力恢复) - Hồi phục MP cơ bản
    baseRegen := 2.0
    
    // Dantian efficiency affects MP regeneration (丹田效率影响法力恢复) - Hiệu suất đan điền ảnh hưởng hồi phục MP
    efficiencyFactor := dantian.Quality.DantianEfficiency * 0.6
    
    // Dantian stability affects consistent MP regen (丹田稳定性影响持续法力恢复) - Độ ổn định đan điền ảnh hưởng hồi phục MP liên tục
    stabilityFactor := dantian.Quality.DantianStability * 0.4
    
    // Meridian conductivity affects qi flow to dantian (经脉传导性影响气到丹田) - Độ dẫn kinh mạch ảnh hưởng dòng khí đến đan điền
    conductivityFactor := meridians.MeridianQuality.Conductivity * 0.3
    
    // Meridian flow efficiency affects MP conversion (经脉流动效率影响法力转换) - Hiệu suất dòng chảy kinh mạch ảnh hưởng chuyển đổi MP
    flowFactor := meridians.MeridianCapacity.FlowEfficiency * 0.2
    
    return baseRegen + efficiencyFactor + stabilityFactor + conductivityFactor + flowFactor
}

// Calculate MP cap from dantian (从丹田计算法力上限) - Tính giới hạn MP từ đan điền
func CalculateMPCap(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base MP cap (基础法力上限) - Giới hạn MP cơ bản
    baseCap := 1000.0
    
    // Dantian capacity directly affects MP cap (丹田容量直接影响法力上限) - Dung lượng đan điền ảnh hưởng trực tiếp giới hạn MP
    capacityFactor := dantian.Storage.DantianCapacity / 100.0 * 0.7
    
    // Dantian quality affects MP quality (丹田质量影响法力质量) - Chất lượng đan điền ảnh hưởng chất lượng MP
    qualityFactor := (dantian.Quality.DantianPurity + dantian.Quality.DantianEfficiency) / 2.0 * 150.0 * 0.2
    
    // Meridian capacity affects qi storage (经脉容量影响气存储) - Dung lượng kinh mạch ảnh hưởng lưu trữ khí
    meridianFactor := meridians.MeridianCapacity.TotalCapacity / 10000.0 * 0.1
    
    return baseCap + capacityFactor + qualityFactor + meridianFactor
}

// Calculate MP consumption efficiency from dantian (从丹田计算法力消耗效率) - Tính hiệu suất tiêu hao MP từ đan điền
func CalculateMPConsumptionEfficiency(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base efficiency (基础效率) - Hiệu suất cơ bản
    baseEfficiency := 1.0
    
    // Dantian efficiency affects MP usage (丹田效率影响法力使用) - Hiệu suất đan điền ảnh hưởng sử dụng MP
    efficiencyFactor := dantian.Quality.DantianEfficiency * 0.4
    
    // Dantian stability affects consistent MP usage (丹田稳定性影响持续法力使用) - Độ ổn định đan điền ảnh hưởng sử dụng MP liên tục
    stabilityFactor := dantian.Quality.DantianStability * 0.3
    
    // Meridian efficiency affects qi flow (经脉效率影响气流动) - Hiệu suất kinh mạch ảnh hưởng dòng chảy khí
    meridianFactor := (meridians.MeridianQuality.Conductivity + meridians.MeridianQuality.Toughness) / 2.0 * 0.3
    
    return baseEfficiency + efficiencyFactor + stabilityFactor + meridianFactor
}
```

#### **3. Derived Stats từ Đan Điền cho HP/MP**
```go
// Dantian-derived HP/MP stats (丹田派生生命/法力属性) - Các derived stats HP/MP từ đan điền
var DantianHPMPStats = []string{
    // HP-related stats (生命相关属性) - Stats liên quan đến HP
    "hp_max",                    // Maximum HP (最大生命值) - HP tối đa
    "hp_current",                // Current HP (当前生命值) - HP hiện tại
    "hp_regeneration",           // HP regeneration rate (生命恢复率) - Tỷ lệ hồi phục HP
    "hp_cap",                    // HP cap (生命上限) - Giới hạn HP
    "life_force",                // Life force (生命力) - Sinh lực
    "vitality",                  // Vitality (活力) - Sức sống
    
    // MP-related stats (法力相关属性) - Stats liên quan đến MP
    "mp_max",                    // Maximum MP (最大法力值) - MP tối đa
    "mp_current",                // Current MP (当前法力值) - MP hiện tại
    "mp_regeneration",           // MP regeneration rate (法力恢复率) - Tỷ lệ hồi phục MP
    "mp_cap",                    // MP cap (法力上限) - Giới hạn MP
    "qi_reserve",                // Qi reserve (气储备) - Dự trữ khí
    "spiritual_energy",          // Spiritual energy (精神能量) - Năng lượng tinh thần
    "mp_consumption_efficiency", // MP consumption efficiency (法力消耗效率) - Hiệu suất tiêu hao MP
    "qi_quality",                // Qi quality (气质量) - Chất lượng khí
}

// Calculate dantian-derived HP/MP stats (计算丹田派生生命/法力属性) - Tính các derived stats HP/MP từ đan điền
func CalculateDantianHPMPStats(dantian DantianInfo, meridians MeridianSystem) map[string]float64 {
    stats := make(map[string]float64)
    
    // HP-related stats (生命相关属性) - Stats liên quan đến HP
    stats["hp_max"] = CalculateHPFromDantian(dantian, meridians)
    stats["hp_current"] = stats["hp_max"] // Start at full HP
    stats["hp_regeneration"] = CalculateHPRegeneration(dantian, meridians)
    stats["hp_cap"] = CalculateHPCap(dantian, meridians)
    stats["life_force"] = dantian.Storage.DantianCapacity / 1000.0 * 0.8 + dantian.Quality.DantianPurity * 0.2
    stats["vitality"] = dantian.Quality.DantianEfficiency * 0.6 + dantian.Quality.DantianStability * 0.4
    
    // MP-related stats (法力相关属性) - Stats liên quan đến MP
    stats["mp_max"] = CalculateMPFromDantian(dantian, meridians)
    stats["mp_current"] = stats["mp_max"] // Start at full MP
    stats["mp_regeneration"] = CalculateMPRegeneration(dantian, meridians)
    stats["mp_cap"] = CalculateMPCap(dantian, meridians)
    stats["qi_reserve"] = dantian.Storage.DantianCapacity / 1000.0 * 0.9 + dantian.Quality.DantianPurity * 0.1
    stats["spiritual_energy"] = dantian.Quality.DantianPurity * 0.7 + dantian.Quality.DantianEfficiency * 0.3
    stats["mp_consumption_efficiency"] = CalculateMPConsumptionEfficiency(dantian, meridians)
    stats["qi_quality"] = dantian.Quality.DantianPurity * 0.8 + dantian.Quality.DantianEfficiency * 0.2
    
    return stats
}
```

#### **4. Ảnh Hưởng Đến Combat và Cultivation**

**Combat System:**
```go
// Calculate damage taken with HP (计算受伤害) - Tính sát thương nhận vào
func CalculateDamageTaken(dantian DantianInfo, meridians MeridianSystem, incomingDamage float64) float64 {
    // Dantian stability reduces damage (丹田稳定性减少伤害) - Độ ổn định đan điền giảm sát thương
    stabilityReduction := dantian.Quality.DantianStability * 0.1
    
    // Meridian health provides damage resistance (经脉健康提供伤害抗性) - Sức khỏe kinh mạch cung cấp kháng sát thương
    meridianResistance := CalculateMainChannelHealth(meridians.MeridianChannels.MainChannels) * 0.05
    
    totalReduction := stabilityReduction + meridianResistance
    if totalReduction > 0.5 {
        totalReduction = 0.5 // Cap at 50% reduction
    }
    
    return incomingDamage * (1.0 - totalReduction)
}

// Calculate spell cost with MP efficiency (计算法术消耗) - Tính chi phí pháp thuật
func CalculateSpellCost(dantian DantianInfo, meridians MeridianSystem, baseCost float64) float64 {
    // MP consumption efficiency reduces spell cost (法力消耗效率减少法术消耗) - Hiệu suất tiêu hao MP giảm chi phí pháp thuật
    efficiency := CalculateMPConsumptionEfficiency(dantian, meridians)
    
    return baseCost / efficiency
}
```

**Cultivation System:**
```go
// Calculate cultivation efficiency with HP/MP (计算修炼效率) - Tính hiệu suất tu luyện
func CalculateCultivationEfficiency(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Base efficiency (基础效率) - Hiệu suất cơ bản
    baseEfficiency := 1.0
    
    // HP affects cultivation stability (生命值影响修炼稳定性) - HP ảnh hưởng độ ổn định tu luyện
    hpFactor := CalculateHPFromDantian(dantian, meridians) / 1000.0 * 0.3
    
    // MP affects cultivation power (法力值影响修炼力量) - MP ảnh hưởng sức mạnh tu luyện
    mpFactor := CalculateMPFromDantian(dantian, meridians) / 1000.0 * 0.4
    
    // Dantian quality affects overall efficiency (丹田质量影响整体效率) - Chất lượng đan điền ảnh hưởng hiệu suất tổng thể
    qualityFactor := (dantian.Quality.DantianPurity + dantian.Quality.DantianEfficiency) / 2.0 * 0.3
    
    return baseEfficiency + hpFactor + mpFactor + qualityFactor
}
```

### **3. Thức Hải (Spirit Sea) - Trung Tâm Thần Thức**

#### **Định Nghĩa Thức Hải và Thần Thức**

**Thức Hải (Spirit Sea)** là trung tâm của thần thức, tương tự như "consciousness" trong tâm lý học hiện đại. Đây là nơi chứa đựng:

1. **Thần Thức (Divine Consciousness)** - Khả năng nhận thức và điều khiển
2. **Niệm Lực (Mental Force)** - Năng lượng tinh thần để thực hiện các hoạt động tâm linh
3. **Trí Tuệ (Wisdom)** - Khả năng hiểu biết và phân tích
4. **Ý Chí (Willpower)** - Sức mạnh tinh thần để vượt qua khó khăn

**Thần Thức (Divine Consciousness)** trong xianxia có vai trò tương tự như **Magic/Intelligence** trong RPG:

- **Cao Thần Thức** = **Cao Magic** → Cast spell damage cao hơn
- **Cao Thần Thức** = **Cao Intelligence** → Hiểu biết pháp thuật tốt hơn
- **Cao Thần Thức** = **Cao Control** → Điều khiển pháp bảo, luyện đan, bày trận pháp tốt hơn

#### **Cấu Trúc Thức Hải**
```go
// Spirit Sea System (识海系统) - Hệ thống thức hải
type SpiritSeaSystem struct {
    // Core components (核心组件) - Các thành phần cốt lõi
    SpiritSeaCore    SpiritSeaCore    `json:"spirit_sea_core"`    // Core of spirit sea (识海核心) - Lõi thức hải
    Consciousness    Consciousness    `json:"consciousness"`      // Consciousness level (意识层次) - Mức độ ý thức
    MentalForce      MentalForce      `json:"mental_force"`       // Mental force (念力) - Niệm lực
    Wisdom           Wisdom           `json:"wisdom"`              // Wisdom (智慧) - Trí tuệ
    Willpower        Willpower        `json:"willpower"`           // Willpower (意志力) - Ý chí
    
    // Advanced components (高级组件) - Các thành phần nâng cao
    DivineSense      DivineSense      `json:"divine_sense"`       // Divine sense (神念) - Thần niệm
    SpiritualControl SpiritualControl `json:"spiritual_control"`  // Spiritual control (精神控制) - Điều khiển tinh thần
    MemoryPalace     MemoryPalace     `json:"memory_palace"`      // Memory palace (记忆宫殿) - Cung điện ký ức
    CultivationMind  CultivationMind  `json:"cultivation_mind"`   // Cultivation mind (修炼心境) - Tâm cảnh tu luyện
}

// Spirit Sea Core (识海核心) - Lõi thức hải
type SpiritSeaCore struct {
    // Basic stats (基础属性) - Thuộc tính cơ bản
    ShenClarity      float64 `json:"shen_clarity"`       // Shen clarity (神清) - Thần thanh
    ShenControl      float64 `json:"shen_control"`       // Shen control (神控) - Thần khống
    ShenCapacity     float64 `json:"shen_capacity"`      // Shen capacity (神容) - Thần dung
    ShenStability    float64 `json:"shen_stability"`     // Shen stability (神稳) - Thần ổn
    ShenEfficiency   float64 `json:"shen_efficiency"`    // Shen efficiency (神效) - Thần hiệu
    
    // Advanced stats (高级属性) - Thuộc tính nâng cao
    DivineAwareness  float64 `json:"divine_awareness"`   // Divine awareness (神觉) - Thần giác
    SpiritualRange   float64 `json:"spiritual_range"`    // Spiritual range (神域) - Thần vực
    MentalResistance float64 `json:"mental_resistance"`  // Mental resistance (神抗) - Thần kháng
    ThoughtSpeed     float64 `json:"thought_speed"`      // Thought speed (神速) - Thần tốc
    MemoryCapacity   float64 `json:"memory_capacity"`    // Memory capacity (神记) - Thần ký
}

// Consciousness (意识) - Ý thức
type Consciousness struct {
    // Consciousness levels (意识层次) - Mức độ ý thức
    BasicConsciousness    float64 `json:"basic_consciousness"`     // Basic consciousness (基础意识) - Ý thức cơ bản
    AdvancedConsciousness float64 `json:"advanced_consciousness"`  // Advanced consciousness (高级意识) - Ý thức nâng cao
    DivineConsciousness   float64 `json:"divine_consciousness"`    // Divine consciousness (神意识) - Thần ý thức
    TranscendentConsciousness float64 `json:"transcendent_consciousness"` // Transcendent consciousness (超脱意识) - Siêu thoát ý thức
    
    // Consciousness abilities (意识能力) - Năng lực ý thức
    MultiTasking     float64 `json:"multi_tasking"`      // Multi-tasking (多任务) - Đa nhiệm
    Focus            float64 `json:"focus"`               // Focus (专注) - Tập trung
    Meditation       float64 `json:"meditation"`          // Meditation (冥想) - Minh tưởng
    Enlightenment    float64 `json:"enlightenment"`       // Enlightenment (开悟) - Khai ngộ
}

// Mental Force (念力) - Niệm lực
type MentalForce struct {
    // Basic mental force (基础念力) - Niệm lực cơ bản
    NianLiCapacity   float64 `json:"nian_li_capacity"`   // Nian Li capacity (念力容量) - Dung lượng niệm lực
    NianLiCurrent    float64 `json:"nian_li_current"`    // Current Nian Li (当前念力) - Niệm lực hiện tại
    NianLiRegen      float64 `json:"nian_li_regen"`      // Nian Li regeneration (念力恢复) - Hồi phục niệm lực
    NianLiEfficiency float64 `json:"nian_li_efficiency"` // Nian Li efficiency (念力效率) - Hiệu suất niệm lực
    
    // Mental force applications (念力应用) - Ứng dụng niệm lực
    Telekinesis      float64 `json:"telekinesis"`        // Telekinesis (念力控物) - Niệm lực khống vật
    MindReading      float64 `json:"mind_reading"`       // Mind reading (读心术) - Độc tâm thuật
    MentalAttack     float64 `json:"mental_attack"`      // Mental attack (精神攻击) - Tinh thần tấn công
    MentalDefense    float64 `json:"mental_defense"`     // Mental defense (精神防御) - Tinh thần phòng ngự
    SpiritualScan    float64 `json:"spiritual_scan"`     // Spiritual scan (神念扫描) - Thần niệm quét
}

// Wisdom (智慧) - Trí tuệ
type Wisdom struct {
    // Basic wisdom (基础智慧) - Trí tuệ cơ bản
    Knowledge        float64 `json:"knowledge"`           // Knowledge (知识) - Tri thức
    Understanding    float64 `json:"understanding"`       // Understanding (理解) - Lý giải
    Analysis         float64 `json:"analysis"`            // Analysis (分析) - Phân tích
    Synthesis        float64 `json:"synthesis"`           // Synthesis (综合) - Tổng hợp
    Intuition        float64 `json:"intuition"`           // Intuition (直觉) - Trực giác
    
    // Advanced wisdom (高级智慧) - Trí tuệ nâng cao
    Foresight        float64 `json:"foresight"`           // Foresight (预见) - Dự kiến
    Insight          float64 `json:"insight"`             // Insight (洞察) - Động sát
    Wisdom           float64 `json:"wisdom"`              // Wisdom (智慧) - Trí tuệ
    Enlightenment    float64 `json:"enlightenment"`       // Enlightenment (开悟) - Khai ngộ
    Transcendence    float64 `json:"transcendence"`       // Transcendence (超脱) - Siêu thoát
}

// Willpower (意志力) - Ý chí
type Willpower struct {
    // Basic willpower (基础意志力) - Ý chí cơ bản
    Determination    float64 `json:"determination"`       // Determination (决心) - Quyết tâm
    Perseverance     float64 `json:"perseverance"`        // Perseverance (毅力) - Nghị lực
    Resilience       float64 `json:"resilience"`          // Resilience (韧性) - Nhẫn nại
    Courage          float64 `json:"courage"`             // Courage (勇气) - Dũng khí
    Discipline       float64 `json:"discipline"`          // Discipline (自律) - Tự luật
    
    // Advanced willpower (高级意志力) - Ý chí nâng cao
    MentalStrength   float64 `json:"mental_strength"`     // Mental strength (精神力量) - Sức mạnh tinh thần
    SpiritualWill    float64 `json:"spiritual_will"`      // Spiritual will (精神意志) - Ý chí tinh thần
    DivineWill       float64 `json:"divine_will"`         // Divine will (神意志) - Thần ý chí
    TranscendentWill float64 `json:"transcendent_will"`   // Transcendent will (超脱意志) - Siêu thoát ý chí
}

// Divine Sense (神念) - Thần niệm
type DivineSense struct {
    // Basic divine sense (基础神念) - Thần niệm cơ bản
    SenseRange       float64 `json:"sense_range"`         // Sense range (感知范围) - Phạm vi cảm giác
    SensePrecision   float64 `json:"sense_precision"`     // Sense precision (感知精度) - Độ chính xác cảm giác
    SenseSpeed       float64 `json:"sense_speed"`         // Sense speed (感知速度) - Tốc độ cảm giác
    SensePenetration float64 `json:"sense_penetration"`   // Sense penetration (感知穿透) - Xuyên thấu cảm giác
    SenseStealth     float64 `json:"sense_stealth"`       // Sense stealth (感知隐蔽) - Ẩn nấp cảm giác
    
    // Advanced divine sense (高级神念) - Thần niệm nâng cao
    DivineScan       float64 `json:"divine_scan"`         // Divine scan (神念扫描) - Thần niệm quét
    SpiritualProbe   float64 `json:"spiritual_probe"`     // Spiritual probe (精神探测) - Tinh thần thám trắc
    MindControl      float64 `json:"mind_control"`        // Mind control (精神控制) - Tinh thần khống chế
    Telepathy        float64 `json:"telepathy"`           // Telepathy (心灵感应) - Tâm linh cảm ứng
    Precognition     float64 `json:"precognition"`        // Precognition (预知) - Dự tri
}

// Spiritual Control (精神控制) - Điều khiển tinh thần
type SpiritualControl struct {
    // Basic control (基础控制) - Điều khiển cơ bản
    SelfControl      float64 `json:"self_control"`        // Self control (自我控制) - Tự điều khiển
    EmotionControl   float64 `json:"emotion_control"`     // Emotion control (情绪控制) - Điều khiển cảm xúc
    ThoughtControl   float64 `json:"thought_control"`     // Thought control (思维控制) - Điều khiển tư duy
    MemoryControl    float64 `json:"memory_control"`      // Memory control (记忆控制) - Điều khiển ký ức
    DreamControl     float64 `json:"dream_control"`       // Dream control (梦境控制) - Điều khiển mộng cảnh
    
    // Advanced control (高级控制) - Điều khiển nâng cao
    SpiritualMastery float64 `json:"spiritual_mastery"`   // Spiritual mastery (精神掌握) - Nắm vững tinh thần
    DivineControl    float64 `json:"divine_control"`      // Divine control (神控制) - Thần khống chế
    TranscendentControl float64 `json:"transcendent_control"` // Transcendent control (超脱控制) - Siêu thoát khống chế
}

// Memory Palace (记忆宫殿) - Cung điện ký ức
type MemoryPalace struct {
    // Basic memory (基础记忆) - Ký ức cơ bản
    MemoryCapacity   float64 `json:"memory_capacity"`     // Memory capacity (记忆容量) - Dung lượng ký ức
    MemorySpeed      float64 `json:"memory_speed"`        // Memory speed (记忆速度) - Tốc độ ký ức
    MemoryAccuracy   float64 `json:"memory_accuracy"`     // Memory accuracy (记忆准确性) - Độ chính xác ký ức
    MemoryRetention  float64 `json:"memory_retention"`    // Memory retention (记忆保持) - Duy trì ký ức
    MemoryRecall     float64 `json:"memory_recall"`       // Memory recall (记忆回忆) - Hồi tưởng ký ức
    
    // Advanced memory (高级记忆) - Ký ức nâng cao
    EideticMemory    float64 `json:"eidetic_memory"`      // Eidetic memory (图像记忆) - Hình ảnh ký ức
    PhotographicMemory float64 `json:"photographic_memory"` // Photographic memory (照相记忆) - Chụp ảnh ký ức
    PerfectMemory    float64 `json:"perfect_memory"`      // Perfect memory (完美记忆) - Hoàn mỹ ký ức
    TranscendentMemory float64 `json:"transcendent_memory"` // Transcendent memory (超脱记忆) - Siêu thoát ký ức
}

// Cultivation Mind (修炼心境) - Tâm cảnh tu luyện
type CultivationMind struct {
    // Basic cultivation mind (基础修炼心境) - Tâm cảnh tu luyện cơ bản
    Calmness         float64 `json:"calmness"`            // Calmness (平静) - Bình tĩnh
    Serenity         float64 `json:"serenity"`            // Serenity (宁静) - Tĩnh lặng
    Tranquility      float64 `json:"tranquility"`         // Tranquility (宁静) - An tĩnh
    Peace            float64 `json:"peace"`               // Peace (和平) - Hòa bình
    Harmony          float64 `json:"harmony"`             // Harmony (和谐) - Hài hòa
    
    // Advanced cultivation mind (高级修炼心境) - Tâm cảnh tu luyện nâng cao
    Enlightenment    float64 `json:"enlightenment"`       // Enlightenment (开悟) - Khai ngộ
    Transcendence    float64 `json:"transcendence"`       // Transcendence (超脱) - Siêu thoát
    Nirvana          float64 `json:"nirvana"`             // Nirvana (涅槃) - Niết bàn
    Buddhahood       float64 `json:"buddhahood"`          // Buddhahood (佛性) - Phật tính
    DaoHeart         float64 `json:"dao_heart"`           // Dao Heart (道心) - Đạo tâm
}
```

#### **Primary Stats từ Thức Hải**
```go
// Spirit Sea primary stats (识海主要属性) - Các primary stats từ thức hải
var SpiritSeaPrimaryStats = []string{
    // Core stats (核心属性) - Thuộc tính cốt lõi
    "shen_clarity",          // Shen clarity (神清) - Thần thanh
    "shen_control",          // Shen control (神控) - Thần khống
    "shen_capacity",         // Shen capacity (神容) - Thần dung
    "shen_stability",        // Shen stability (神稳) - Thần ổn
    "shen_efficiency",       // Shen efficiency (神效) - Thần hiệu
    
    // Advanced stats (高级属性) - Thuộc tính nâng cao
    "divine_awareness",      // Divine awareness (神觉) - Thần giác
    "spiritual_range",       // Spiritual range (神域) - Thần vực
    "mental_resistance",     // Mental resistance (神抗) - Thần kháng
    "thought_speed",         // Thought speed (神速) - Thần tốc
    "memory_capacity",       // Memory capacity (神记) - Thần ký
    
    // Consciousness stats (意识属性) - Thuộc tính ý thức
    "basic_consciousness",   // Basic consciousness (基础意识) - Ý thức cơ bản
    "advanced_consciousness", // Advanced consciousness (高级意识) - Ý thức nâng cao
    "divine_consciousness",  // Divine consciousness (神意识) - Thần ý thức
    "transcendent_consciousness", // Transcendent consciousness (超脱意识) - Siêu thoát ý thức
    
    // Mental force stats (念力属性) - Thuộc tính niệm lực
    "nian_li_capacity",      // Nian Li capacity (念力容量) - Dung lượng niệm lực
    "nian_li_current",       // Current Nian Li (当前念力) - Niệm lực hiện tại
    "nian_li_regen",         // Nian Li regeneration (念力恢复) - Hồi phục niệm lực
    "nian_li_efficiency",    // Nian Li efficiency (念力效率) - Hiệu suất niệm lực
    
    // Wisdom stats (智慧属性) - Thuộc tính trí tuệ
    "knowledge",              // Knowledge (知识) - Tri thức
    "understanding",          // Understanding (理解) - Lý giải
    "analysis",               // Analysis (分析) - Phân tích
    "synthesis",              // Synthesis (综合) - Tổng hợp
    "intuition",              // Intuition (直觉) - Trực giác
    
    // Willpower stats (意志力属性) - Thuộc tính ý chí
    "determination",          // Determination (决心) - Quyết tâm
    "perseverance",           // Perseverance (毅力) - Nghị lực
    "resilience",             // Resilience (韧性) - Nhẫn nại
    "courage",                // Courage (勇气) - Dũng khí
    "discipline",             // Discipline (自律) - Tự luật
    
    // Divine sense stats (神念属性) - Thuộc tính thần niệm
    "sense_range",            // Sense range (感知范围) - Phạm vi cảm giác
    "sense_precision",        // Sense precision (感知精度) - Độ chính xác cảm giác
    "sense_speed",            // Sense speed (感知速度) - Tốc độ cảm giác
    "sense_penetration",      // Sense penetration (感知穿透) - Xuyên thấu cảm giác
    "sense_stealth",          // Sense stealth (感知隐蔽) - Ẩn nấp cảm giác
    
    // Spiritual control stats (精神控制属性) - Thuộc tính điều khiển tinh thần
    "self_control",           // Self control (自我控制) - Tự điều khiển
    "emotion_control",        // Emotion control (情绪控制) - Điều khiển cảm xúc
    "thought_control",        // Thought control (思维控制) - Điều khiển tư duy
    "memory_control",         // Memory control (记忆控制) - Điều khiển ký ức
    "dream_control",          // Dream control (梦境控制) - Điều khiển mộng cảnh
    
    // Memory palace stats (记忆宫殿属性) - Thuộc tính cung điện ký ức
    "memory_speed",           // Memory speed (记忆速度) - Tốc độ ký ức
    "memory_accuracy",        // Memory accuracy (记忆准确性) - Độ chính xác ký ức
    "memory_retention",       // Memory retention (记忆保持) - Duy trì ký ức
    "memory_recall",          // Memory recall (记忆回忆) - Hồi tưởng ký ức
    
    // Cultivation mind stats (修炼心境属性) - Thuộc tính tâm cảnh tu luyện
    "calmness",               // Calmness (平静) - Bình tĩnh
    "serenity",               // Serenity (宁静) - Tĩnh lặng
    "tranquility",            // Tranquility (宁静) - An tĩnh
    "peace",                  // Peace (和平) - Hòa bình
    "harmony",                // Harmony (和谐) - Hài hòa
}

// Calculate Spirit Sea primary stats (计算识海主要属性) - Tính các primary stats từ thức hải
func CalculateSpiritSeaPrimaryStats(spiritSea SpiritSeaSystem) map[string]float64 {
    stats := make(map[string]float64)
    
    // Core stats (核心属性) - Thuộc tính cốt lõi
    stats["shen_clarity"] = spiritSea.SpiritSeaCore.ShenClarity
    stats["shen_control"] = spiritSea.SpiritSeaCore.ShenControl
    stats["shen_capacity"] = spiritSea.SpiritSeaCore.ShenCapacity
    stats["shen_stability"] = spiritSea.SpiritSeaCore.ShenStability
    stats["shen_efficiency"] = spiritSea.SpiritSeaCore.ShenEfficiency
    
    // Advanced stats (高级属性) - Thuộc tính nâng cao
    stats["divine_awareness"] = spiritSea.SpiritSeaCore.DivineAwareness
    stats["spiritual_range"] = spiritSea.SpiritSeaCore.SpiritualRange
    stats["mental_resistance"] = spiritSea.SpiritSeaCore.MentalResistance
    stats["thought_speed"] = spiritSea.SpiritSeaCore.ThoughtSpeed
    stats["memory_capacity"] = spiritSea.SpiritSeaCore.MemoryCapacity
    
    // Consciousness stats (意识属性) - Thuộc tính ý thức
    stats["basic_consciousness"] = spiritSea.Consciousness.BasicConsciousness
    stats["advanced_consciousness"] = spiritSea.Consciousness.AdvancedConsciousness
    stats["divine_consciousness"] = spiritSea.Consciousness.DivineConsciousness
    stats["transcendent_consciousness"] = spiritSea.Consciousness.TranscendentConsciousness
    
    // Mental force stats (念力属性) - Thuộc tính niệm lực
    stats["nian_li_capacity"] = spiritSea.MentalForce.NianLiCapacity
    stats["nian_li_current"] = spiritSea.MentalForce.NianLiCurrent
    stats["nian_li_regen"] = spiritSea.MentalForce.NianLiRegen
    stats["nian_li_efficiency"] = spiritSea.MentalForce.NianLiEfficiency
    
    // Wisdom stats (智慧属性) - Thuộc tính trí tuệ
    stats["knowledge"] = spiritSea.Wisdom.Knowledge
    stats["understanding"] = spiritSea.Wisdom.Understanding
    stats["analysis"] = spiritSea.Wisdom.Analysis
    stats["synthesis"] = spiritSea.Wisdom.Synthesis
    stats["intuition"] = spiritSea.Wisdom.Intuition
    
    // Willpower stats (意志力属性) - Thuộc tính ý chí
    stats["determination"] = spiritSea.Willpower.Determination
    stats["perseverance"] = spiritSea.Willpower.Perseverance
    stats["resilience"] = spiritSea.Willpower.Resilience
    stats["courage"] = spiritSea.Willpower.Courage
    stats["discipline"] = spiritSea.Willpower.Discipline
    
    // Divine sense stats (神念属性) - Thuộc tính thần niệm
    stats["sense_range"] = spiritSea.DivineSense.SenseRange
    stats["sense_precision"] = spiritSea.DivineSense.SensePrecision
    stats["sense_speed"] = spiritSea.DivineSense.SenseSpeed
    stats["sense_penetration"] = spiritSea.DivineSense.SensePenetration
    stats["sense_stealth"] = spiritSea.DivineSense.SenseStealth
    
    // Spiritual control stats (精神控制属性) - Thuộc tính điều khiển tinh thần
    stats["self_control"] = spiritSea.SpiritualControl.SelfControl
    stats["emotion_control"] = spiritSea.SpiritualControl.EmotionControl
    stats["thought_control"] = spiritSea.SpiritualControl.ThoughtControl
    stats["memory_control"] = spiritSea.SpiritualControl.MemoryControl
    stats["dream_control"] = spiritSea.SpiritualControl.DreamControl
    
    // Memory palace stats (记忆宫殿属性) - Thuộc tính cung điện ký ức
    stats["memory_speed"] = spiritSea.MemoryPalace.MemorySpeed
    stats["memory_accuracy"] = spiritSea.MemoryPalace.MemoryAccuracy
    stats["memory_retention"] = spiritSea.MemoryPalace.MemoryRetention
    stats["memory_recall"] = spiritSea.MemoryPalace.MemoryRecall
    
    // Cultivation mind stats (修炼心境属性) - Thuộc tính tâm cảnh tu luyện
    stats["calmness"] = spiritSea.CultivationMind.Calmness
    stats["serenity"] = spiritSea.CultivationMind.Serenity
    stats["tranquility"] = spiritSea.CultivationMind.Tranquility
    stats["peace"] = spiritSea.CultivationMind.Peace
    stats["harmony"] = spiritSea.CultivationMind.Harmony
    
    return stats
}
```

#### **Tính Niệm Lực từ Thức Hải**
```go
// Calculate Nian Li from Spirit Sea (从识海计算念力) - Tính niệm lực từ thức hải
func CalculateNianLiFromSpiritSea(spiritSea SpiritSeaSystem) float64 {
    // Base Nian Li (基础念力) - Niệm lực cơ bản
    baseNianLi := 0.0
    
    // Shen capacity affects Nian Li capacity (神容影响念力容量) - Thần dung ảnh hưởng dung lượng niệm lực
    shenCapacityFactor := spiritSea.SpiritSeaCore.ShenCapacity / 1000.0 * 0.4
    
    // Shen control affects Nian Li control (神控影响念力控制) - Thần khống ảnh hưởng điều khiển niệm lực
    shenControlFactor := spiritSea.SpiritSeaCore.ShenControl * 0.3
    
    // Shen clarity affects Nian Li precision (神清影响念力精度) - Thần thanh ảnh hưởng độ chính xác niệm lực
    shenClarityFactor := spiritSea.SpiritSeaCore.ShenClarity * 0.2
    
    // Shen efficiency affects Nian Li efficiency (神效影响念力效率) - Thần hiệu ảnh hưởng hiệu suất niệm lực
    shenEfficiencyFactor := spiritSea.SpiritSeaCore.ShenEfficiency * 0.1
    
    return baseNianLi + shenCapacityFactor + shenControlFactor + shenClarityFactor + shenEfficiencyFactor
}

// Calculate Nian Li regeneration from Spirit Sea (从识海计算念力恢复) - Tính hồi phục niệm lực từ thức hải
func CalculateNianLiRegeneration(spiritSea SpiritSeaSystem) float64 {
    // Base regen rate (基础恢复率) - Tỷ lệ hồi phục cơ bản
    baseRegen := 0.1
    
    // Shen efficiency affects Nian Li regen (神效影响念力恢复) - Thần hiệu ảnh hưởng hồi phục niệm lực
    efficiencyFactor := spiritSea.SpiritSeaCore.ShenEfficiency * 0.5
    
    // Shen stability affects consistent regen (神稳影响持续恢复) - Thần ổn ảnh hưởng hồi phục liên tục
    stabilityFactor := spiritSea.SpiritSeaCore.ShenStability * 0.3
    
    // Consciousness level affects regen speed (意识层次影响恢复速度) - Mức độ ý thức ảnh hưởng tốc độ hồi phục
    consciousnessFactor := (spiritSea.Consciousness.BasicConsciousness + 
                           spiritSea.Consciousness.AdvancedConsciousness + 
                           spiritSea.Consciousness.DivineConsciousness) / 3.0 * 0.2
    
    return baseRegen + efficiencyFactor + stabilityFactor + consciousnessFactor
}

// Calculate Nian Li cap from Spirit Sea (从识海计算念力上限) - Tính giới hạn niệm lực từ thức hải
func CalculateNianLiCap(spiritSea SpiritSeaSystem) float64 {
    // Base cap (基础上限) - Giới hạn cơ bản
    baseCap := 50000.0
    
    // Shen capacity directly affects Nian Li cap (神容直接影响念力上限) - Thần dung ảnh hưởng trực tiếp giới hạn niệm lực
    capacityFactor := spiritSea.SpiritSeaCore.ShenCapacity / 100.0 * 0.6
    
    // Shen clarity affects Nian Li quality (神清影响念力质量) - Thần thanh ảnh hưởng chất lượng niệm lực
    clarityFactor := spiritSea.SpiritSeaCore.ShenClarity * 100.0 * 0.3
    
    // Divine consciousness affects Nian Li power (神意识影响念力力量) - Thần ý thức ảnh hưởng sức mạnh niệm lực
    consciousnessFactor := spiritSea.Consciousness.DivineConsciousness * 50.0 * 0.1
    
    return baseCap + capacityFactor + clarityFactor + consciousnessFactor
}
```

#### **Ảnh Hưởng của Thần Thức đến Combat**
```go
// Calculate spell damage from Shen (从神计算法术伤害) - Tính sát thương pháp thuật từ thần
func CalculateSpellDamageFromShen(spiritSea SpiritSeaSystem, baseDamage float64) float64 {
    // Base damage (基础伤害) - Sát thương cơ bản
    baseSpellDamage := baseDamage
    
    // Shen control affects spell power (神控影响法术威力) - Thần khống ảnh hưởng uy lực pháp thuật
    shenControlFactor := spiritSea.SpiritSeaCore.ShenControl * 0.4
    
    // Shen clarity affects spell precision (神清影响法术精度) - Thần thanh ảnh hưởng độ chính xác pháp thuật
    shenClarityFactor := spiritSea.SpiritSeaCore.ShenClarity * 0.3
    
    // Shen efficiency affects spell efficiency (神效影响法术效率) - Thần hiệu ảnh hưởng hiệu suất pháp thuật
    shenEfficiencyFactor := spiritSea.SpiritSeaCore.ShenEfficiency * 0.2
    
    // Divine consciousness affects spell power (神意识影响法术威力) - Thần ý thức ảnh hưởng uy lực pháp thuật
    consciousnessFactor := spiritSea.Consciousness.DivineConsciousness * 0.1
    
    return baseSpellDamage * (1.0 + shenControlFactor + shenClarityFactor + shenEfficiencyFactor + consciousnessFactor)
}

// Calculate spell accuracy from Shen (从神计算法术命中) - Tính độ chính xác pháp thuật từ thần
func CalculateSpellAccuracyFromShen(spiritSea SpiritSeaSystem) float64 {
    // Base accuracy (基础命中) - Độ chính xác cơ bản
    baseAccuracy := 0.8
    
    // Shen clarity affects accuracy (神清影响命中) - Thần thanh ảnh hưởng độ chính xác
    clarityFactor := spiritSea.SpiritSeaCore.ShenClarity * 0.3
    
    // Shen control affects control (神控影响控制) - Thần khống ảnh hưởng điều khiển
    controlFactor := spiritSea.SpiritSeaCore.ShenControl * 0.2
    
    // Divine sense affects precision (神念影响精度) - Thần niệm ảnh hưởng độ chính xác
    senseFactor := spiritSea.DivineSense.SensePrecision * 0.1
    
    return baseAccuracy + clarityFactor + controlFactor + senseFactor
}

// Calculate spell range from Shen (从神计算法术范围) - Tính phạm vi pháp thuật từ thần
func CalculateSpellRangeFromShen(spiritSea SpiritSeaSystem) float64 {
    // Base range (基础范围) - Phạm vi cơ bản
    baseRange := 10.0
    
    // Spiritual range affects spell range (神域影响法术范围) - Thần vực ảnh hưởng phạm vi pháp thuật
    rangeFactor := spiritSea.SpiritSeaCore.SpiritualRange * 0.5
    
    // Divine sense affects range (神念影响范围) - Thần niệm ảnh hưởng phạm vi
    senseFactor := spiritSea.DivineSense.SenseRange * 0.3
    
    // Advanced consciousness affects range (高级意识影响范围) - Ý thức nâng cao ảnh hưởng phạm vi
    consciousnessFactor := spiritSea.Consciousness.AdvancedConsciousness * 0.2
    
    return baseRange + rangeFactor + senseFactor + consciousnessFactor
}

// Calculate spell cooldown from Shen (从神计算法术冷却) - Tính thời gian hồi chiêu pháp thuật từ thần
func CalculateSpellCooldownFromShen(spiritSea SpiritSeaSystem, baseCooldown float64) float64 {
    // Base cooldown (基础冷却) - Thời gian hồi chiêu cơ bản
    baseSpellCooldown := baseCooldown
    
    // Shen efficiency affects cooldown (神效影响冷却) - Thần hiệu ảnh hưởng thời gian hồi chiêu
    efficiencyFactor := spiritSea.SpiritSeaCore.ShenEfficiency * 0.3
    
    // Shen stability affects consistency (神稳影响一致性) - Thần ổn ảnh hưởng tính nhất quán
    stabilityFactor := spiritSea.SpiritSeaCore.ShenStability * 0.2
    
    // Thought speed affects casting speed (神速影响施法速度) - Thần tốc ảnh hưởng tốc độ thi triển
    speedFactor := spiritSea.SpiritSeaCore.ThoughtSpeed * 0.1
    
    return baseSpellCooldown / (1.0 + efficiencyFactor + stabilityFactor + speedFactor)
}
```

### **3. Thức Hải (Spirit Sea) - Trung Tâm Thần Thức**
Thức hải là trung tâm của thần thức, ảnh hưởng đến các primary stats liên quan đến **Thần** và **điều khiển**:

#### **Primary Stats từ Thức Hải:**
```go
// Spirit Sea-related primary stats (识海相关主要属性) - Các primary stats từ thức hải
var SpiritSeaPrimaryStats = []string{
    "shen_depth",           // Shen depth (神深度) - Độ sâu thức hải
    "shen_clarity",         // Shen clarity (神清晰度) - Độ tinh tường của Thần
    "shen_control",         // Shen control (神控制) - Năng lực điều khiển
    "spirit_sea_capacity",  // Spirit sea capacity (识海容量) - Dung lượng thức hải
    "spirit_sea_stability", // Spirit sea stability (识海稳定性) - Độ ổn định thức hải
    "dao_comprehension",    // Dao comprehension (道理解) - Ngộ tính/đạo hạnh
}
```

#### **Cấu Trúc Thức Hải:**
```go
type SpiritSea struct {
    // Spirit sea core (识海核心) - Lõi thức hải
    SpiritSeaCore SpiritSeaCore `json:"spirit_sea_core"`
    
    // Spirit sea capacity (识海容量) - Dung lượng thức hải
    SpiritSeaCapacity SpiritSeaCapacity `json:"spirit_sea_capacity"`
    
    // Dao comprehension (道理解) - Ngộ tính đạo
    DaoComprehension DaoComprehension `json:"dao_comprehension"`
}

type SpiritSeaCore struct {
    ShenDepth        float64 `json:"shen_depth"`        // 0.0 - 1.0 (神深度) - Độ sâu thức hải
    ShenClarity      float64 `json:"shen_clarity"`      // 0.0 - 1.0 (神清晰度) - Độ tinh tường
    ShenControl      float64 `json:"shen_control"`      // 0.0 - 1.0 (神控制) - Năng lực điều khiển
    OverallShen      float64 `json:"overall_shen"`      // Average of above (整体神) - Thần tổng hợp
}

type SpiritSeaCapacity struct {
    MaxSpiritPower   float64 `json:"max_spirit_power"`  // Maximum spirit power (最大神识力) - Thần thức lực tối đa
    CurrentSpiritPower float64 `json:"current_spirit_power"` // Current spirit power (当前神识力) - Thần thức lực hiện tại
    SpiritRegeneration float64 `json:"spirit_regeneration"` // Spirit regeneration rate (神识恢复速率) - Tốc độ hồi thần
    TotalCapacity    float64 `json:"total_capacity"`    // Total spirit sea capacity (总识海容量) - Tổng dung lượng thức hải
}

type DaoComprehension struct {
    DaoLevel         float64 `json:"dao_level"`         // 0.0 - 1.0 (道等级) - Cấp độ đạo
    ComprehensionRate float64 `json:"comprehension_rate"` // 0.0 - 1.0 (理解速率) - Tốc độ lĩnh ngộ
    DaoAffinity      float64 `json:"dao_affinity"`      // 0.0 - 1.0 (道亲和力) - Độ tương thích với đạo
}
```

#### **Công Thức Tính Toán Thức Hải:**
```go
// Calculate spirit sea-related stats (计算识海相关属性) - Tính toán các stats liên quan đến thức hải
func CalculateSpiritSeaStats(spiritSea SpiritSea) map[string]float64 {
    stats := make(map[string]float64)
    
    // Shen depth (神深度) - Độ sâu thức hải
    stats["shen_depth"] = spiritSea.SpiritSeaCore.ShenDepth
    
    // Shen clarity (神清晰度) - Độ tinh tường của Thần
    stats["shen_clarity"] = spiritSea.SpiritSeaCore.ShenClarity
    
    // Shen control (神控制) - Năng lực điều khiển
    stats["shen_control"] = spiritSea.SpiritSeaCore.ShenControl
    
    // Spirit sea capacity (识海容量) - Dung lượng thức hải
    stats["spirit_sea_capacity"] = spiritSea.SpiritSeaCapacity.TotalCapacity
    
    // Spirit sea stability (识海稳定性) - Độ ổn định thức hải = (ShenDepth + ShenClarity) / 2
    stats["spirit_sea_stability"] = (spiritSea.SpiritSeaCore.ShenDepth + spiritSea.SpiritSeaCore.ShenClarity) / 2.0
    
    // Dao comprehension (道理解) - Ngộ tính đạo
    stats["dao_comprehension"] = spiritSea.DaoComprehension.DaoLevel
    
    return stats
}
```

### **Tóm Tắt Hệ Thống 3 Thành Phần**

#### **Bảng Phân Chia Primary Stats:**
| Thành Phần | Primary Stats | Chức Năng Chính | Ảnh Hưởng Đến |
|------------|---------------|------------------|---------------|
| **Đan Điền** | `dantian_capacity`, `dantian_compression`, `dantian_stability`, `dantian_purity`, `qi_purity`, `eff_jing_to_qi`, `eff_qi_to_shen`, `cultivation_exp` | Lưu trữ và chuyển hóa khí | Tu luyện, breakthrough, chuyển hóa năng lượng |
| **Kinh Mạch** | `meridian_conductivity`, `meridian_toughness`, `meridian_purity_resistance`, `jing_reserve`, `meridian_efficiency`, `meridian_capacity` | Vận chuyển khí trong cơ thể | Tốc độ tu luyện, khả năng chịu áp lực, lưu thông khí |
| **Thức Hải** | `shen_depth`, `shen_clarity`, `shen_control`, `spirit_sea_capacity`, `spirit_sea_stability`, `dao_comprehension` | Điều khiển thần thức | Điều khiển pháp bảo, luyện kim, bày trận pháp, lĩnh ngộ đạo |

#### **Ví Dụ Ảnh Hưởng Đến Các Hoạt Động:**

**1. Điều Khiển Pháp Bảo (Artifact Control):**
```go
// Artifact control effectiveness (法宝控制效果) - Hiệu quả điều khiển pháp bảo
func CalculateArtifactControlEffectiveness(spiritSea SpiritSea) float64 {
    // Dựa trên shen_control và shen_clarity
    return spiritSea.SpiritSeaCore.ShenControl * 0.7 + spiritSea.SpiritSeaCore.ShenClarity * 0.3
}
```

**2. Luyện Kim (Alchemy):**
```go
// Alchemy success rate (炼丹成功率) - Tỷ lệ thành công luyện kim
func CalculateAlchemySuccessRate(dantian DantianInfo, spiritSea SpiritSea) float64 {
    // Dựa trên dantian_purity, shen_control, và dao_comprehension
    dantianFactor := dantian.Quality.DantianPurity * 0.4
    spiritFactor := spiritSea.SpiritSeaCore.ShenControl * 0.3
    daoFactor := spiritSea.DaoComprehension.DaoLevel * 0.3
    
    return dantianFactor + spiritFactor + daoFactor
}
```

**3. Luyện Khí (Qi Refining):**
```go
// Qi refining efficiency (炼气效率) - Hiệu suất luyện khí
func CalculateQiRefiningEfficiency(dantian DantianInfo, meridians MeridianSystem) float64 {
    // Dựa trên dantian_compression, meridian_conductivity, và qi_purity
    dantianFactor := dantian.Quality.DantianPurity * 0.4
    meridianFactor := meridians.MeridianQuality.Conductivity * 0.4
    compressionFactor := (dantian.Core.TotalCultivationExp / dantian.Storage.DantianCapacity) * 0.2
    
    return dantianFactor + meridianFactor + compressionFactor
}
```

**4. Bày Trận Pháp (Formation Array):**
```go
// Formation array effectiveness (阵法效果) - Hiệu quả bày trận pháp
func CalculateFormationArrayEffectiveness(spiritSea SpiritSea, meridians MeridianSystem) float64 {
    // Dựa trên shen_depth, shen_control, và meridian_efficiency
    shenFactor := (spiritSea.SpiritSeaCore.ShenDepth + spiritSea.SpiritSeaCore.ShenControl) / 2.0 * 0.6
    meridianFactor := meridians.MeridianQuality.Conductivity * 0.4
    
    return shenFactor + meridianFactor
}
```

**5. Breakthrough (Đột Phá):**
```go
// Breakthrough success rate (突破成功率) - Tỷ lệ thành công đột phá
func CalculateBreakthroughSuccessRate(dantian DantianInfo, meridians MeridianSystem, spiritSea SpiritSea) float64 {
    // Dựa trên tất cả 3 thành phần
    dantianFactor := dantian.Quality.DantianStability * 0.4
    meridianFactor := meridians.MeridianQuality.Toughness * 0.3
    spiritFactor := spiritSea.SpiritSeaCore.ShenClarity * 0.3
    
    return dantianFactor + meridianFactor + spiritFactor
}
```

### **Công Thức Tổng Hợp Primary Stats:**
```go
// Calculate all primary stats from 3 components (从3个组件计算所有主要属性) - Tính toán tất cả primary stats từ 3 thành phần
func CalculateAllPrimaryStats(dantian DantianInfo, meridians MeridianSystem, spiritSea SpiritSea) map[string]float64 {
    allStats := make(map[string]float64)
    
    // Merge stats from all 3 components (合并3个组件的属性) - Gộp stats từ 3 thành phần
    dantianStats := CalculateDantianStats(dantian)
    meridianStats := CalculateMeridianStats(meridians)
    spiritSeaStats := CalculateSpiritSeaStats(spiritSea)
    
    // Add dantian stats (添加丹田属性) - Thêm stats đan điền
    for key, value := range dantianStats {
        allStats[key] = value
    }
    
    // Add meridian stats (添加经脉属性) - Thêm stats kinh mạch
    for key, value := range meridianStats {
        allStats[key] = value
    }
    
    // Add spirit sea stats (添加识海属性) - Thêm stats thức hải
    for key, value := range spiritSeaStats {
        allStats[key] = value
    }
    
    return allStats
}
```

#### **3. Derived Stats từ Đan Điền**
```go
// Derived stats calculated from dantian (从丹田计算的派生属性) - Các derived stats được tính từ đan điền
var DantianDerivedStats = []string{
    "qi_max",             // Maximum qi (最大气力) - Khí lực tối đa (dựa trên tu vi)
    "qi_regeneration",    // Qi regeneration rate (气力恢复速度) - Tốc độ hồi khí (dựa trên chất lượng đan điền)
    "cultivation_speed",  // Cultivation speed (修炼速度) - Tốc độ tu luyện (dựa trên độ tinh khiết)
    "breakthrough_chance", // Breakthrough chance (突破几率) - Tỷ lệ breakthrough (dựa trên độ ổn định)
    "power_level",        // Power level (力量等级) - Power level (dựa trên tu vi)
}
```

#### **4. Caps từ Đan Điền**
```go
// Caps applied based on dantian (基于丹田应用的限制) - Các caps được áp dụng dựa trên đan điền
var DantianCaps = []CapContribution{
    {
        Dimension: "cultivation_exp",
        Value: dantian.DantianCapacity,
        Scope: "REALM",
        Mode: "CLAMP_MAX",
    },
    {
        Dimension: "dantian_capacity",
        Value: dantian.DantianCapacity,
        Scope: "REALM", 
        Mode: "CLAMP_MAX",
    },
    {
        Dimension: "qi_max",
        Value: dantian.TotalCultivationExp * 100, // 1 cultivation exp = 100 qi (1修炼经验 = 100气力)
        Scope: "REALM",
        Mode: "CLAMP_MAX",
    },
}
```

### **Công Thức Tính Toán Chi Tiết**

#### **1. Cultivation Experience → Power Level**
```go
// Convert cultivation experience to power level (将修炼经验转换为力量等级) - Tu Vi → Power Level
func CultivationExpToPowerLevel(cultivationExp float64) int64 {
    return int64(cultivationExp / 1000.0)
}
```

#### **2. Power Level → Cultivation Experience**
```go
// Convert power level to cultivation experience (将力量等级转换为修炼经验) - Power Level → Tu Vi
func PowerLevelToCultivationExp(powerLevel int64) float64 {
    return float64(powerLevel) * 1000.0
}
```

#### **3. Cultivation Experience → Qi Max**
```go
// Convert cultivation experience to maximum qi (将修炼经验转换为最大气力) - Tu Vi → Qi Max
func CultivationExpToQiMax(cultivationExp float64) float64 {
    return cultivationExp * 100.0 // 1 cultivation exp = 100 qi (1修炼经验 = 100气力)
}
```

#### **4. Dantian Quality → Cultivation Speed**
```go
// Convert dantian quality to cultivation speed (将丹田质量转换为修炼速度) - Chất Lượng Đan Điền → Tốc Độ Tu Luyện
func DantianQualityToCultivationSpeed(quality float64) float64 {
    return quality * 1.5 // High quality = faster cultivation (高质量 = 修炼更快)
}
```

### **Ví Dụ Implementation**

#### **Trúc Cơ Sơ kỳ**
```go
dantian := DantianInfo{
    Core: DantianCore{
        TuVi: 15000.0,
        TuViPhu: 2000.0,
        TuViTongHop: 17000.0,
        CapDo: 2,
        TieuCanhGioi: "Sơ kỳ",
    },
    Storage: DantianStorage{
        DungLuong: 30000.0,
        TuViDaSuDung: 5000.0,
        TuViConLai: 25000.0,
        TyLeDay: 56.67,
    },
    Quality: DantianQuality{
        DoTinhKhiet: 0.8,
        DoOnDinh: 0.7,
        DoBenVung: 0.6,
        ChatLuongTongHop: 0.7,
    },
}

// Tạo SubsystemOutput
output := &SubsystemOutput{
    Primary: []Contribution{
        {Dimension: "dantian_capacity", Value: 30000.0},
        {Dimension: "dantian_purity", Value: 0.8},
        {Dimension: "dantian_stability", Value: 0.7},
        {Dimension: "dantian_durability", Value: 0.6},
        {Dimension: "tu_vi", Value: 15000.0},
        {Dimension: "tu_vi_phu", Value: 2000.0},
        {Dimension: "tu_vi_tong_hop", Value: 17000.0},
    },
    Derived: []Contribution{
        {Dimension: "qi_max", Value: 1700000.0}, // 17000 * 100
        {Dimension: "qi_regeneration", Value: 0.7}, // Dựa trên chất lượng
        {Dimension: "cultivation_speed", Value: 1.05}, // 0.7 * 1.5
        {Dimension: "breakthrough_chance", Value: 0.7},
        {Dimension: "power_level", Value: 17.0}, // 17000 / 1000
    },
    Caps: []CapContribution{
        {Dimension: "tu_vi", Value: 30000.0, Scope: "REALM", Mode: "CLAMP_MAX"},
        {Dimension: "qi_max", Value: 3000000.0, Scope: "REALM", Mode: "CLAMP_MAX"},
    },
    Dantian: dantian,
}
```

## 🧘 **Định Nghĩa Tu Vi Chi Tiết**

### **Phàm Trần Cảnh (7 cảnh giới)**

#### **1. Luyện Khí (Qi Refining)**
- **Tu vi**: 1,000-10,000 năm
- **Mô tả**: Giai đoạn khởi đầu, tu luyện cơ bản
- **Đặc điểm**: Hình thành đan điền, có thể bay ngắn hạn

#### **2. Trúc Cơ (Foundation Building)**
- **Sơ kỳ**: 10,000-20,000 năm
- **Trung kỳ**: 20,000-40,000 năm  
- **Hậu kỳ**: 40,000-80,000 năm
- **Viên mãn**: 80,000-100,000 năm
- **Mô tả**: Xây dựng nền tảng tu luyện vững chắc

#### **3. Kim Đan (Golden Core)**
- **Sơ kỳ**: 100,000-200,000 năm
- **Trung kỳ**: 200,000-400,000 năm
- **Hậu kỳ**: 400,000-800,000 năm
- **Viên mãn**: 800,000-1,000,000 năm
- **Mô tả**: Kết tinh linh khí thành Kim Đan

#### **4. Nguyên Anh (Nascent Soul)**
- **Sơ kỳ**: 1,000,000-2,000,000 năm
- **Trung kỳ**: 2,000,000-4,000,000 năm
- **Hậu kỳ**: 4,000,000-8,000,000 năm
- **Viên mãn**: 8,000,000-10,000,000 năm
- **Mô tả**: Kim Đan phát triển thành Nguyên Anh

#### **5. Hóa Thần (Spirit Transformation)**
- **Sơ kỳ**: 10,000,000-20,000,000 năm
- **Trung kỳ**: 20,000,000-40,000,000 năm
- **Hậu kỳ**: 40,000,000-80,000,000 năm
- **Viên mãn**: 80,000,000-100,000,000 năm
- **Mô tả**: Hóa thân thành thần linh

#### **6. Luyện Hư (Void Refining)**
- **Sơ kỳ**: 100,000,000-200,000,000 năm
- **Trung kỳ**: 200,000,000-400,000,000 năm
- **Hậu kỳ**: 400,000,000-800,000,000 năm
- **Viên mãn**: 800,000,000-1,000,000,000 năm
- **Mô tả**: Luyện tập vượt qua hư ảo

#### **7. Hợp Thể (Integration)**
- **Sơ kỳ**: 1,000,000,000-2,000,000,000 năm
- **Trung kỳ**: 2,000,000,000-4,000,000,000 năm
- **Hậu kỳ**: 4,000,000,000-8,000,000,000 năm
- **Viên mãn**: 8,000,000,000-10,000,000,000 năm
- **Mô tả**: Hợp nhất hoàn toàn với thiên địa

#### **8. Đại Thừa (Great Ascension)**
- **Sơ kỳ**: 10,000,000,000-20,000,000,000 năm
- **Trung kỳ**: 20,000,000,000-40,000,000,000 năm
- **Hậu kỳ**: 40,000,000,000-80,000,000,000 năm
- **Viên mãn**: 80,000,000,000-100,000,000,000 năm
- **Mô tả**: Hoàn thiện cuối cùng trước phi thăng

### **Tiên Nhân Cảnh (8 cảnh giới)**

#### **9. Địa Tiên (Earth Immortal)**
- **Tầng 1**: 100,000,000,000-110,000,000,000 năm
- **Tầng 2**: 110,000,000,000-125,000,000,000 năm
- **Tầng 3**: 125,000,000,000-150,000,000,000 năm
- **Tầng 4**: 150,000,000,000-200,000,000,000 năm
- **Tầng 5**: 200,000,000,000-250,000,000,000 năm
- **Tầng 6**: 250,000,000,000-300,000,000,000 năm
- **Tầng 7**: 300,000,000,000-350,000,000,000 năm
- **Tầng 8**: 350,000,000,000-400,000,000,000 năm
- **Tầng 9**: 400,000,000,000-450,000,000,000 năm
- **Viên mãn**: 450,000,000,000-500,000,000,000 năm
- **Mô tả**: Cấp bậc đầu tiên của Tiên Nhân

#### **10. Thiên Tiên (Heaven Immortal)**
- **Tầng 1**: 500,000,000,000-550,000,000,000 năm
- **Tầng 2**: 550,000,000,000-625,000,000,000 năm
- **Tầng 3**: 625,000,000,000-750,000,000,000 năm
- **Tầng 4**: 750,000,000,000-1,000,000,000,000 năm
- **Tầng 5**: 1,000,000,000,000-1,250,000,000,000 năm
- **Tầng 6**: 1,250,000,000,000-1,500,000,000,000 năm
- **Tầng 7**: 1,500,000,000,000-1,750,000,000,000 năm
- **Tầng 8**: 1,750,000,000,000-2,000,000,000,000 năm
- **Tầng 9**: 2,000,000,000,000-2,250,000,000,000 năm
- **Viên mãn**: 2,250,000,000,000-2,500,000,000,000 năm
- **Mô tả**: Tiên nhân cấp cao, có thể bay lên Thiên Giới

#### **11. Huyền Tiên (Mystic Immortal)**
- **Tầng 1**: 2,500,000,000,000-2,750,000,000,000 năm
- **Tầng 2**: 2,750,000,000,000-3,125,000,000,000 năm
- **Tầng 3**: 3,125,000,000,000-3,750,000,000,000 năm
- **Tầng 4**: 3,750,000,000,000-5,000,000,000,000 năm
- **Tầng 5**: 5,000,000,000,000-6,250,000,000,000 năm
- **Tầng 6**: 6,250,000,000,000-7,500,000,000,000 năm
- **Tầng 7**: 7,500,000,000,000-8,750,000,000,000 năm
- **Tầng 8**: 8,750,000,000,000-10,000,000,000,000 năm
- **Tầng 9**: 10,000,000,000,000-11,250,000,000,000 năm
- **Viên mãn**: 11,250,000,000,000-12,500,000,000,000 năm
- **Mô tả**: Tiên nhân thần bí, hiểu biết sâu sắc về đạo

#### **12. Thái Ất Tán Tiên (Taiyi Scattered Immortal)**
- **Tầng 1**: 12,500,000,000,000-13,750,000,000,000 năm
- **Tầng 2**: 13,750,000,000,000-15,625,000,000,000 năm
- **Tầng 3**: 15,625,000,000,000-18,750,000,000,000 năm
- **Tầng 4**: 18,750,000,000,000-25,000,000,000,000 năm
- **Tầng 5**: 25,000,000,000,000-31,250,000,000,000 năm
- **Tầng 6**: 31,250,000,000,000-37,500,000,000,000 năm
- **Tầng 7**: 37,500,000,000,000-43,750,000,000,000 năm
- **Tầng 8**: 43,750,000,000,000-50,000,000,000,000 năm
- **Tầng 9**: 50,000,000,000,000-56,250,000,000,000 năm
- **Viên mãn**: 56,250,000,000,000-62,500,000,000,000 năm
- **Mô tả**: Tiên nhân tán lạc, có thể tạo ra thế giới nhỏ

#### **13. Kim Tiên (Golden Immortal)**
- **Tầng 1**: 62,500,000,000,000-68,750,000,000,000 năm
- **Tầng 2**: 68,750,000,000,000-78,125,000,000,000 năm
- **Tầng 3**: 78,125,000,000,000-93,750,000,000,000 năm
- **Tầng 4**: 93,750,000,000,000-125,000,000,000,000 năm
- **Tầng 5**: 125,000,000,000,000-156,250,000,000,000 năm
- **Tầng 6**: 156,250,000,000,000-187,500,000,000,000 năm
- **Tầng 7**: 187,500,000,000,000-218,750,000,000,000 năm
- **Tầng 8**: 218,750,000,000,000-250,000,000,000,000 năm
- **Tầng 9**: 250,000,000,000,000-281,250,000,000,000 năm
- **Viên mãn**: 281,250,000,000,000-312,500,000,000,000 năm
- **Mô tả**: Tiên nhân kim sắc, sức mạnh vượt trội

#### **14. Đại La Kim Tiên (Great Luo Golden Immortal)**
- **Tầng 1**: 312,500,000,000,000-343,750,000,000,000 năm
- **Tầng 2**: 343,750,000,000,000-390,625,000,000,000 năm
- **Tầng 3**: 390,625,000,000,000-468,750,000,000,000 năm
- **Tầng 4**: 468,750,000,000,000-625,000,000,000,000 năm
- **Tầng 5**: 625,000,000,000,000-781,250,000,000,000 năm
- **Tầng 6**: 781,250,000,000,000-937,500,000,000,000 năm
- **Tầng 7**: 937,500,000,000,000-1,093,750,000,000,000 năm
- **Tầng 8**: 1,093,750,000,000,000-1,250,000,000,000,000 năm
- **Tầng 9**: 1,250,000,000,000,000-1,406,250,000,000,000 năm
- **Viên mãn**: 1,406,250,000,000,000-1,562,500,000,000,000 năm
- **Mô tả**: Tiên nhân đại la, gần như bất tử

#### **15. Chuẩn Thánh (Quasi-Saint)**
- **Tầng 1**: 1,562,500,000,000,000-1,718,750,000,000,000 năm
- **Tầng 2**: 1,718,750,000,000,000-1,953,125,000,000,000 năm
- **Tầng 3**: 1,953,125,000,000,000-2,343,750,000,000,000 năm
- **Tầng 4**: 2,343,750,000,000,000-3,125,000,000,000,000 năm
- **Tầng 5**: 3,125,000,000,000,000-3,906,250,000,000,000 năm
- **Tầng 6**: 3,906,250,000,000,000-4,687,500,000,000,000 năm
- **Tầng 7**: 4,687,500,000,000,000-5,468,750,000,000,000 năm
- **Tầng 8**: 5,468,750,000,000,000-6,250,000,000,000,000 năm
- **Tầng 9**: 6,250,000,000,000,000-7,031,250,000,000,000 năm
- **Viên mãn**: 7,031,250,000,000,000-7,812,500,000,000,000 năm
- **Mô tả**: Chuẩn thánh, sức mạnh gần như vô hạn

#### **16. Thánh Nhân (Saint)**
- **Tầng 1**: 7,812,500,000,000,000-8,593,750,000,000,000 năm
- **Tầng 2**: 8,593,750,000,000,000-9,765,625,000,000,000 năm
- **Tầng 3**: 9,765,625,000,000,000-11,718,750,000,000,000 năm
- **Tầng 4**: 11,718,750,000,000,000-15,625,000,000,000,000 năm
- **Tầng 5**: 15,625,000,000,000,000-19,531,250,000,000,000 năm
- **Tầng 6**: 19,531,250,000,000,000-23,437,500,000,000,000 năm
- **Tầng 7**: 23,437,500,000,000,000-27,343,750,000,000,000 năm
- **Tầng 8**: 27,343,750,000,000,000-31,250,000,000,000,000 năm
- **Tầng 9**: 31,250,000,000,000,000-35,156,250,000,000,000 năm
- **Viên mãn**: 35,156,250,000,000,000-39,062,500,000,000,000+ năm
- **Mô tả**: Thánh nhân, đỉnh cao của tu đạo, bất tử vĩnh viễn

### **Tóm Tắt Tu Vi**

#### **Phàm Trần Cảnh (1,000 - 100,000,000,000 năm)**
- **Luyện Khí**: 1,000-10,000 năm
- **Trúc Cơ**: 10,000-100,000 năm
- **Kim Đan**: 100,000-1,000,000 năm
- **Nguyên Anh**: 1,000,000-10,000,000 năm
- **Hóa Thần**: 10,000,000-100,000,000 năm
- **Luyện Hư**: 100,000,000-1,000,000,000 năm
- **Hợp Thể**: 1,000,000,000-10,000,000,000 năm
- **Đại Thừa**: 10,000,000,000-100,000,000,000 năm

#### **Tiên Nhân Cảnh (100,000,000,000 - 39,062,500,000,000+ năm)**
- **Địa Tiên**: 100,000,000,000-500,000,000,000 năm
- **Thiên Tiên**: 500,000,000,000-2,500,000,000,000 năm
- **Huyền Tiên**: 2,500,000,000,000-12,500,000,000,000 năm
- **Thái Ất Tán Tiên**: 12,500,000,000,000-62,500,000,000,000 năm
- **Kim Tiên**: 62,500,000,000,000-312,500,000,000,000 năm
- **Đại La Kim Tiên**: 312,500,000,000,000-1,562,500,000,000,000 năm
- **Chuẩn Thánh**: 1,562,500,000,000,000-7,812,500,000,000,000 năm
- **Thánh Nhân**: 7,812,500,000,000,000-39,062,500,000,000,000+ năm

### **Ví Dụ Tu Vi Cụ Thể**

#### **Luyện Khí Tầng 1 → Kim Đan Thượng Phẩm**
- **Tu vi**: 1,000 → 1,000,000 năm (1,000x tăng)
- **Thời gian tu luyện**: Từ vài năm đến hàng triệu năm
- **Sự khác biệt**: Từ tu sĩ mới bắt đầu đến đại sư

#### **Trúc Cơ Sơ kỳ → Trúc Cơ Viên mãn**
- **Tu vi**: 10,000 → 100,000 năm (10x tăng)
- **Thời gian tu luyện**: Từ vài chục năm đến hàng trăm nghìn năm
- **Sự khác biệt**: Từ tu sĩ cơ bản đến đại sư nền tảng

#### **Địa Tiên Tầng 1 → Địa Tiên Viên mãn**
- **Tu vi**: 100,000,000,000 → 500,000,000,000 năm (5x tăng)
- **Thời gian tu luyện**: Từ hàng trăm tỷ năm đến hàng nghìn tỷ năm
- **Sự khác biệt**: Từ tiên nhân mới đến tiên nhân thành thục

#### **Hóa Thần Sơ → Thánh Nhân Thái Ất**
- **Tu vi**: 10,000,000 → 39,062,500,000,000+ năm (3,906,250,000x tăng)
- **Thời gian tu luyện**: Từ hàng chục triệu năm đến hàng chục nghìn tỷ năm
- **Quyền năng**: Từ điều khiển 1 thành phố đến sáng tạo và hủy diệt vũ trụ

### **Hệ thống Cấp số nhân mềm mại**
Hệ thống sử dụng **cấp số nhân mềm mại** để tạo cảm giác "breakthrough" vừa phải và phù hợp với tinh thần xianxia:

- **Phàm Trần Cảnh**: Tăng dần theo tỷ lệ 1x → 1.5x → 2.5x → 5x (mềm mại hơn)
- **Tiên Nhân Cảnh**: Mỗi tầng tăng dần theo cấp số nhân
- **Lợi ích**: Tạo động lực vừa phải, không quá khó khăn cho player mới

### **Realm Multipliers**
- **Luyện Khí**: 1x
- **Trúc Cơ**: 10x
- **Kim Đan**: 100x
- **Nguyên Anh**: 1,000x
- **Hóa Thần**: 10,000x
- **Luyện Hư**: 100,000x
- **Hợp Thể**: 1,000,000x
- **Đại Thừa**: 10,000,000x
- **Địa Tiên**: 100,000,000x
- **Thiên Tiên**: 500,000,000x
- **Huyền Tiên**: 1,000,000,000x
- **Thái Ất Tán Tiên**: 2,000,000,000x
- **Kim Tiên**: 5,000,000,000x
- **Đại La Kim Tiên**: 10,000,000,000x
- **Chuẩn Thánh**: 50,000,000,000x
- **Thánh Nhân**: 100,000,000,000x

### **Substage Multipliers**

#### **Phàm Trần Cảnh (4 tiểu cảnh giới) - Cấp số nhân mềm mại**
- **Sơ kỳ**: 1x (0-10% của cảnh giới)
- **Trung kỳ**: 1.5x (10-25% của cảnh giới)
- **Hậu kỳ**: 2.5x (25-50% của cảnh giới)
- **Viên mãn**: 5x (50-100% của cảnh giới)

#### **Tiên Nhân Cảnh (10 tiểu cảnh giới) - Cấp số nhân**
- **Tầng 1**: 1x (0-10% của cảnh giới)
- **Tầng 2**: 1.1x (10-12.5% của cảnh giới)
- **Tầng 3**: 1.25x (12.5-15% của cảnh giới)
- **Tầng 4**: 1.5x (15-20% của cảnh giới)
- **Tầng 5**: 2x (20-25% của cảnh giới)
- **Tầng 6**: 2.5x (25-30% của cảnh giới)
- **Tầng 7**: 3x (30-35% của cảnh giới)
- **Tầng 8**: 3.5x (35-40% của cảnh giới)
- **Tầng 9**: 4x (40-45% của cảnh giới)
- **Viên mãn**: 5x (45-50% của cảnh giới)

### **Quality Multipliers (Kim Đan)**
- **Hạ Phẩm**: 1x
- **Trung Phẩm**: 2x
- **Thượng Phẩm**: 5x
- **Cực Phẩm**: 10x

## 🎯 **Caps Range theo Cảnh Giới**

### **Luyện Khí (Tầng 1-9)**
```yaml
dantian_capacity: [100, 1000]
dantian_compression: [0.1, 0.5]
qi_purity: [0.05, 0.3]
shen_depth: [50, 200]
meridian_conductivity: [10, 100]
```

### **Trúc Cơ (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [1000, 10000]
dantian_compression: [0.5, 1.0]
qi_purity: [0.3, 0.6]
shen_depth: [200, 500]
meridian_conductivity: [100, 500]
```

### **Kim Đan (Hạ/Trung/Thượng/Viên Mãn + 4 Phẩm)**
```yaml
dantian_capacity: [10000, 100000]
dantian_compression: [1.0, 2.0]
qi_purity: [0.6, 0.9]
shen_depth: [500, 2000]
meridian_conductivity: [500, 2000]
```

### **Nguyên Anh (Tiểu/Trung/Đại/Viên Mãn)**
```yaml
dantian_capacity: [100000, 1000000]
dantian_compression: [2.0, 5.0]
qi_purity: [0.9, 0.99]
shen_depth: [2000, 10000]
meridian_conductivity: [2000, 10000]
```

### **Hóa Thần (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [1000000, 10000000]
dantian_compression: [5.0, 10.0]
qi_purity: [0.99, 0.999]
shen_depth: [10000, 100000]
meridian_conductivity: [10000, 100000]
```

### **Luyện Hư (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [10000000, 100000000]
dantian_compression: [10.0, 20.0]
qi_purity: [0.999, 0.9999]
shen_depth: [100000, 1000000]
meridian_conductivity: [100000, 1000000]
```

### **Hợp Thể (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [100000000, 1000000000]
dantian_compression: [20.0, 50.0]
qi_purity: [0.9999, 0.99999]
shen_depth: [1000000, 10000000]
meridian_conductivity: [1000000, 10000000]
```

### **Đại Thừa (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [1000000000, 10000000000]
dantian_compression: [50.0, 100.0]
qi_purity: [0.99999, 0.999999]
shen_depth: [10000000, 100000000]
meridian_conductivity: [10000000, 100000000]
```

### **Địa Tiên (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [10000000000, 50000000000]
dantian_compression: [100.0, 200.0]
qi_purity: [0.999999, 0.9999995]
shen_depth: [100000000, 500000000]
meridian_conductivity: [100000000, 500000000]
```

### **Thiên Tiên (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [50000000000, 100000000000]
dantian_compression: [200.0, 300.0]
qi_purity: [0.9999995, 0.9999998]
shen_depth: [500000000, 1000000000]
meridian_conductivity: [500000000, 1000000000]
```

### **Huyền Tiên (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [100000000000, 200000000000]
dantian_compression: [300.0, 400.0]
qi_purity: [0.9999998, 0.9999999]
shen_depth: [1000000000, 2000000000]
meridian_conductivity: [1000000000, 2000000000]
```

### **Thái Ất Tán Tiên (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [200000000000, 500000000000]
dantian_compression: [400.0, 500.0]
qi_purity: [0.9999999, 0.99999995]
shen_depth: [2000000000, 5000000000]
meridian_conductivity: [2000000000, 5000000000]
```

### **Kim Tiên (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [500000000000, 1000000000000]
dantian_compression: [500.0, 600.0]
qi_purity: [0.99999995, 0.99999998]
shen_depth: [5000000000, 10000000000]
meridian_conductivity: [5000000000, 10000000000]
```

### **Đại La Kim Tiên (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [1000000000000, 5000000000000]
dantian_compression: [600.0, 800.0]
qi_purity: [0.99999998, 0.99999999]
shen_depth: [10000000000, 50000000000]
meridian_conductivity: [10000000000, 50000000000]
```

### **Chuẩn Thánh (Sơ/Trung/Hậu/Viên Mãn)**
```yaml
dantian_capacity: [5000000000000, 10000000000000]
dantian_compression: [800.0, 1000.0]
qi_purity: [0.99999999, 0.999999995]
shen_depth: [50000000000, 100000000000]
meridian_conductivity: [50000000000, 100000000000]
```

### **Thánh Nhân (Địa Thánh/Thiên Thánh/Thái Ất Thánh)**
```yaml
dantian_capacity: [10000000000000, 100000000000000]
dantian_compression: [1000.0, 10000.0]
qi_purity: [0.999999995, 1.0]
shen_depth: [100000000000, 1000000000000]
meridian_conductivity: [100000000000, 1000000000000]
```

## ⚡ **Tribulation Events (Độ Kiếp)**

### **Major Tribulations**
- **Trúc Cơ → Kim Đan**: Thiên Kiếp (9 đạo lôi)
- **Kim Đan → Nguyên Anh**: Địa Kiếp (18 đạo lôi)
- **Nguyên Anh → Hóa Thần**: Nhân Kiếp (36 đạo lôi)
- **Hóa Thần → Luyện Hư**: Tâm Ma Kiếp (72 đạo lôi)
- **Luyện Hư → Hợp Thể**: Hư Ảo Kiếp (108 đạo lôi)
- **Hợp Thể → Đại Thừa**: Thiên Địa Kiếp (216 đạo lôi)
- **Đại Thừa → Địa Tiên**: Phi Thăng Kiếp (432 đạo lôi)
- **Địa Tiên → Thiên Tiên**: Thiên Tiên Kiếp (648 đạo lôi)
- **Thiên Tiên → Huyền Tiên**: Huyền Cơ Kiếp (864 đạo lôi)
- **Huyền Tiên → Thái Ất Tán Tiên**: Tán Tiên Kiếp (1296 đạo lôi)
- **Thái Ất Tán Tiên → Kim Tiên**: Kim Tiên Kiếp (1728 đạo lôi)
- **Kim Tiên → Đại La Kim Tiên**: Đại La Kiếp (2592 đạo lôi)
- **Đại La Kim Tiên → Chuẩn Thánh**: Chuẩn Thánh Kiếp (3456 đạo lôi)
- **Chuẩn Thánh → Thánh Nhân**: Thánh Kiếp (9999 đạo lôi)

### **Tribulation Requirements**
```yaml
tribulation_resist: [MIN_REQUIRED, MAX_POSSIBLE]
qi_purity: [MIN_REQUIRED, MAX_POSSIBLE]
dantian_stability: [MIN_REQUIRED, MAX_POSSIBLE]
meridian_toughness: [MIN_REQUIRED, MAX_POSSIBLE]
```

## 🔄 **Realm Progression Rules**

1. **Sequential Progression**: Phải hoàn thành cảnh giới trước mới tiến lên
2. **No Regression**: Không thể giảm cảnh giới (trừ khi bị phế công)
3. **Quality Preservation**: Phẩm chất đan có thể được giữ lại khi tiến cảnh
4. **Caps Enforcement**: Tất cả stats phải trong phạm vi caps của cảnh giới
5. **Tribulation Gates**: Một số cảnh giới yêu cầu vượt qua thiên kiếp

## 📈 **Power Scaling Examples**

### **Luyện Khí Tầng 1 → Kim Đan Thượng Phẩm**
- **Power Level**: 1 → 775-1,000 (775-1,000x tăng)
- **Tuổi thọ**: 100 → 700-800 năm (7-8x tăng)
- **Sức mạnh**: Có thể nâng 10kg → 5,000kg

### **Trúc Cơ Sơ kỳ → Trúc Cơ Viên mãn**
- **Power Level**: 10-20 → 80-100 (4-5x tăng)
- **Tuổi thọ**: 150-180 → 260-300 năm (1.4-1.7x tăng)
- **Sự khác biệt**: Cấp số nhân mềm mại tạo cảm giác tiến bộ ổn định

### **Kim Đan Sơ kỳ → Kim Đan Viên mãn**
- **Power Level**: 100-200 → 800-1,000 (4-5x tăng)
- **Tuổi thọ**: 300-400 → 700-800 năm (1.8-2.0x tăng)
- **Sự khác biệt**: Mỗi tiểu cảnh giới có sự tiến bộ rõ ràng nhưng không quá khó khăn

### **Địa Tiên Tầng 1 → Địa Tiên Viên mãn**
- **Power Level**: 100,000,000-110,000,000 → 450,000,000-500,000,000 (4-4.5x tăng)
- **Tuổi thọ**: 100,000-140,000 → 460,000-500,000 năm (3.3-3.6x tăng)
- **Sự khác biệt**: Cấp số nhân tạo động lực lớn để tiến bộ

### **Hóa Thần Sơ → Thánh Nhân Thái Ất**
- **Power Level**: 10,000 → 100,000,000,000+ (10,000,000x tăng)
- **Tuổi thọ**: 2,000 → Bất tử vĩnh viễn
- **Quyền năng**: Điều khiển 1 thành phố → Sáng tạo và hủy diệt vũ trụ

### **Đại Thừa Viên Mãn → Địa Tiên Viên Mãn**
- **Power Level**: 10,000,000 → 500,000,000 (50x tăng)
- **Tuổi thọ**: 100,000 → 500,000 năm (5x tăng)
- **Quyền năng**: Điều khiển 1 thế giới → Sống trong tiên giới

### **Kim Tiên Viên Mãn → Thánh Nhân Thái Ất**
- **Power Level**: 10,000,000,000 → 100,000,000,000+ (10x tăng)
- **Tuổi thọ**: 10,000,000 → Bất tử vĩnh viễn
- **Quyền năng**: Sáng tạo thế giới → Sáng tạo vũ trụ

## 🎮 **Game Balance Notes**

1. **Exponential Scaling**: Power level tăng theo cấp số nhân
2. **Caps Enforcement**: Mỗi cảnh giới có giới hạn rõ ràng
3. **Tribulation Gates**: Tạo điểm kiểm tra khó khăn
4. **Quality System**: Phẩm chất đan ảnh hưởng sức mạnh
5. **Lifespan Scaling**: Tuổi thọ tăng theo cảnh giới
6. **Resource Requirements**: Cảnh giới cao cần tài nguyên nhiều hơn

---

## 📋 **Tổng Kết Hệ Thống**

### **15 Cảnh Giới Chính:**

#### **Phàm Trần Cảnh (7 cảnh giới)**
1. **Luyện Khí** (Qi Condensation) - 9 tầng
2. **Trúc Cơ** (Foundation Establishment) - 4 tiểu cảnh giới (Sơ kỳ/Trung kỳ/Hậu kỳ/Viên mãn)
3. **Kim Đan** (Golden Core) - 4 tiểu cảnh giới + 4 phẩm đan
4. **Nguyên Anh** (Nascent Soul) - 4 tiểu cảnh giới
5. **Hóa Thần** (Spirit Transformation) - 4 tiểu cảnh giới
6. **Luyện Hư** (Void Refining) - 4 tiểu cảnh giới
7. **Hợp Thể** (Integration) - 4 tiểu cảnh giới
8. **Đại Thừa** (Great Ascension) - 4 tiểu cảnh giới

#### **Tiên Nhân Cảnh (8 cảnh giới)**
9. **Địa Tiên** (Earth Immortal) - 10 tiểu cảnh giới (Tầng 1-9 + Viên mãn)
10. **Thiên Tiên** (Heaven Immortal) - 10 tiểu cảnh giới
11. **Huyền Tiên** (Mystic Immortal) - 10 tiểu cảnh giới
12. **Thái Ất Tán Tiên** (Taiyi Scattered Immortal) - 10 tiểu cảnh giới
13. **Kim Tiên** (Golden Immortal) - 10 tiểu cảnh giới
14. **Đại La Kim Tiên** (Great Luo Golden Immortal) - 10 tiểu cảnh giới
15. **Chuẩn Thánh** (Quasi-Saint) - 10 tiểu cảnh giới
16. **Thánh Nhân** (Saint) - 10 tiểu cảnh giới

### **Power Scale Range:**
- **Luyện Khí**: 1-10
- **Thánh Nhân**: 100,000,000,000+

### **Tribulation System:**
- **14 đại kiếp** chính từ Trúc Cơ đến Thánh Nhân
- **Số đạo lôi**: 9 → 9999 đạo lôi

---

**Lưu ý**: Document này được thiết kế cho game xianxia với balance phù hợp. Có thể điều chỉnh các con số theo nhu cầu game cụ thể.
